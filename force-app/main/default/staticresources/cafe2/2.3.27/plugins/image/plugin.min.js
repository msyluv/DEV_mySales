/*! cafe note v2.3.27 | Copyright 2014, S-Core, Inc. All Right Reserved. */
cafe.pluginManager.add("image",[],function(a){function b(a){fa!==a&&(fa=a,l().element.val(c()))}function c(){var a;return a=fa.length>200?fa.substring(0,200):fa}function d(){return n().value()}function e(){return o().value()}function f(){return p().isChecked()}function g(){return q().value()}function h(){return r().value()}function i(){return a.getDialog(Ta)}function j(){return i().getWidget("fileInput")}function k(){return i().getWidget("fileRadio")}function l(){return i().getWidget("URLInput")}function m(){return i().getWidget("URLRadio")}function n(){return i().getWidget("widthInput")}function o(){return i().getWidget("heightInput")}function p(){return i().getWidget("keepRatioButton")}function q(){return i().getWidget("titleInput")}function r(){return i().getWidget("descriptionInput")}function s(){return i().getWidget("borderInput")}function t(){return i().getWidget("alignSelectMenu")}function u(){return i().getWidget("horizontalPaddingInput")}function v(){return i().getWidget("verticalPaddingInput")}function w(){return A(s().value())}function x(){return t().index()}function y(){return A(u().value())}function z(){return A(v().value())}function A(a){var b=parseInt(a,10);return isNaN(b)?0:b}function B(){return i().getWidget("cancelbutton").element.hasClass("cui-state-active")}function C(a){ha=a}function D(a){var b=new window.Image;na(b).load(function(){var c={};c.width=b.width||Wa.width,c.height=b.height||Wa.height,H(c),E(c),na(this).remove(),ga=null,pa=!0,p().option("checked",!0),Z(a)}).error(function(){$()});try{b.setAttribute("src",a)}catch(a){$()}}function E(a){a.width>0&&a.height>0&&(ia=a.width,ja=a.height,na(i().element).data("imageSize",a))}function F(){return na(i().element).data("imageSize")}function G(){return na(i().element).removeData("imageSize")}function H(b){var c;ia=b.width,ja=b.height,ga&&(d()||(ga.style.width=(ia||Wa.width)+"px"),e()||(ga.style.height=(ja||Wa.height)+"px"),c=ga.parentElement,c&&"cui-wrapper"===c.className&&(c.style.width=ga.style.width,c.style.height=ga.style.height,a.browser.ie&&na(c).css("background-size",ga.style.width+" "+ga.style.height))),n().element.val(b.width),o().element.val(b.height)}function I(){var a,b=d(),c=f(),e=F(),g=parseInt(b,10);isFinite(b)?c&&b&&g!==ia&&0!==e.width&&0!==e.height&&(a=parseInt(g*e.height/e.width,10),ia=g,ja=a,n().element.val(g),o().element.val(a)):(n().element.val(ia),o().element.val(ja))}function J(){var a,b=e(),c=f(),d=F(),g=parseInt(b,10);isFinite(b)?c&&b&&g!==ja&&0!==d.width&&0!==d.height&&(a=parseInt(g*d.width/d.height,10),ia=a,ja=g,n().element.val(a),o().element.val(g)):(n().element.val(ia),o().element.val(ja))}function K(){var a,b=F();b&&(b.height||(a={},a.height=e(),a.width=d(),E(a)),J())}function L(){var a,b=F();b&&(b.width||(a={},a.height=e(),a.width=d(),E(a)),I())}function M(a,b){b.checked&&E({width:d(),height:e()})}function N(b){var c=a.selectionManager.getRange();return!!b&&(a.pluginUtils.unselectAllTable(),a.contentUtils.insertElementByRange(b,c),!0)}function O(b,c){var f,i,j,k,l,m,n,o,p=a.pluginUtils,q=p.getSelectedItem("image")||c,r=a.constants.NoImageData;if(!fa)return!1;f=d(),i=e(),j=g(),k=h(),l=w(),m=x(),n=y(),o=z(),p.deselectItem(),ga=q||a.getDoc().createElement("img"),fa.length===r.length&&fa===r||"true"!==ga.getAttribute("data-cui-alt-image")||ga.removeAttribute("data-cui-alt-image");try{ga.setAttribute("src",fa)}catch(a){return!1}return ga.setAttribute("unselectable","on"),ga.setAttribute("data-cui-image","true"),ga.style.display="inline-block",ga.style.border="solid",ga.style["border-width"]=l+"px",m!==-1&&(ga.style.removeProperty?(ga.style.removeProperty("vertical-align"),ga.style.removeProperty("float")):(ga.style["vertical-align"]="",ga.style.float=""),0===m?ga.style["vertical-align"]="top":1===m?ga.style["vertical-align"]="middle":2===m?ga.style["vertical-align"]="bottom":3===m?ga.style.float="left":4===m?ga.style.float="right":5===m?ga.style["vertical-align"]="text-top":6===m&&(ga.style["vertical-align"]="text-bottom")),n!==A(ga.style.paddingLeft)&&(ga.style.paddingLeft=0===n?null:n+"px",ga.style.paddingRight=0===n?null:n+"px"),o!==A(ga.style.paddingTop)&&(ga.style.paddingTop=0===o?null:o+"px",ga.style.paddingBottom=0===o?null:o+"px"),j?ga.title=j:na(ga).removeAttr("title"),k?ga.alt=k:na(ga).removeAttr("alt"),ga.style.width=(f||Wa.width)+"px",ga.style.height=(i||Wa.height)+"px",!!q||N(ga)}function P(c,d,e,f){var g,h,i;f&&e&&d&&Ya.indexOf(e)>=0?(i=j().element[0].childNodes[2].files[0],a.configs.enable_image_size_alert&&i.size>3145728?$(null,!0):(g="data:"+e+";base64,"+f,b(g),D(g),h=a.pluginUtils.getSelectedItem("image"),h&&"true"===h.getAttribute("data-cui-alt-image")&&q().element.val(""))):$()}function Q(){if(!B())return Xa&&j().pathElement.val(""),fa=l().value(),a.pluginUtils.checkImageSource(fa)?void D(fa):void $(fa)}function R(){Xa&&(j().enable(),l().disable())}function S(){Xa&&(j().disable(),l().enable())}function T(){setTimeout(function(){pa?(a.execCommand("image.checkLock"),ha||a.execCommand("edit.image",a.pluginUtils.getSelectedItem("image")),i().close()):$()},0)}function U(b){var c=m(),d=!c||c.element.attr("checked"),e=(d?l().element:j().buttonElement)[0],f=d?ta:b?a.getText("image.notsupportfilesize"):sa;(f!==a.getText("image.notsupportfilesize")||a.configs.enable_image_size_alert)&&(a.alert(f),a.one("alertclose",function(){e.focus()}))}function V(){var b,d,e,f,g,h,w,x=a.pluginUtils,y=i(),z=j(),A=k(),B=l(),C=m(),D=n(),F=o(),G=p(),H=s(),I=t(),J=u(),M=v(),N=x.getSelectedItem("image");ga=null,oa&&(Xa&&z.element.on("change",P),B.element.on("change",Q),D.element.on("keyup",L),F.element.on("keyup",K),oa=!1),N?(b=na(N),fa=b.attr("src"),fa&&"undefined"!==fa&&(pa=!0,B.element.val(c()),Xa&&(/^data:image\//i.test(fa)?(A.enable().option("checked",!0),C.disable().option("checked",!1),z.enable(),B.disable()):(A.disable().option("checked",!1),C.enable().option("checked",!0),z.disable(),B.enable()))),Z(),q().element.val(b.attr("title")),r().element.val(b.attr("alt")),d=W(b,"width"),e=W(b,"height"),D.value(d),F.value(e),E({width:d,height:e}),G.option("checked",!0),y.option("title",wa),g=b.css("vertical-align"),"baseline"===g&&(g=b.css("float")),f=W(b,"border-top-width"),h=W(b,"padding-left"),w=W(b,"padding-top"),H.value(f),J.value(h),M.value(w),g&&("top"===g?I.index(0):"middle"===g?I.index(1):"bottom"===g?I.index(2):"left"===g?I.index(3):"right"===g?I.index(4):"text-top"===g?I.index(5):"text-bottom"===g?I.index(6):I.index(-1))):(D.element.val(""),F.element.val(""),Xa&&(A.option("checked",!0),z.enable(),C.option("checked",!1),B.disable()))}function W(a,b){return A(a[0].style[b]||a.css(b))}function X(a){a.wrap("<form>").closest("form").get(0).reset(),a.unwrap()}function Y(){Va.filename="",Va.urlname="",Va.url=""}function Z(a){Xa&&(Va.filename=j().value()),Va.urlname=l().value(),Va.url=a}function $(b,c){var d=j();b&&a.pluginUtils.isSupportImageData(b)>=0?a.alert(a.getText("image.notsupportfiletype")):U(c),Xa&&(d.pathElement.val(Va.filename),d.hiddenElement.wrap("<form>").closest("form").get(0).reset(),d.hiddenElement.unwrap()),l().element.val(Va.urlname)}function _(){var b;fa=null,ga=null,ia=0,ja=0,pa=!1,Xa&&(b=j(),b.pathElement.val(""),b.disable(),X(b.hiddenElement),k().enable().option("checked",!1),m().enable().option("checked",!1)),l().element.val(""),n().element.val(""),o().element.val(""),q().element.val(""),r().element.val(""),p().option("checked",!1),s().value(""),t().index(-1).option("label",""),u().value(""),v().value(""),i().option("title",va),a.pluginUtils.setItemButtonState(),G(),Y(),a.pluginUtils.deselectItem()}function aa(){a.pluginUtils.deselectItem()}function ba(b,c,d){a.pluginUtils.selectItem(d)}function ca(){var b=a.pluginUtils,c=b.getSelectedItem("media");c&&b.deselectItem(),a.dialog(Ta)}function da(){var b=a.getText("image.label.filenotsupport"),c=a.getResourcesUrl()+ra+"/images/info.png";return"<div style='margin: 0em 0em 0.5em 0em; padding: 5px 5px 5px 5px; border: 1px dashed rgb(204, 204, 204); font-size: 8pt; display: inline-flex;' ><img src='"+c+"' style='width: 12px; height: 12px; vertical-align: text-bottom'/><span style='color: rgb(170, 170, 170); position: relative;'>&nbsp;"+b+"</span></div>"}function ea(){var a,b=la.length,c=ma.length,d=ka.items[0].items;if(Xa)for(a=0;a<b;a++)d.unshift(la[a]);else for(a=0;a<c;a++)d.unshift(ma[a])}var fa,ga,ha,ia,ja,ka,la,ma,na=a.$,oa=!0,pa=!1,qa="image",ra="image",sa=a.getText("image.dialog.alert.notsupport"),ta=a.getText("image.dialog.alert.wrongurl"),ua=a.getText("image.toolbutton.inserttext"),va=a.getText("image.dialog.insert"),wa=a.getText("image.dialog.edit"),xa=a.getText("image.dialog.menu"),ya=a.getText("image.dialog.cmenu"),za=a.getText("image.label.url"),Aa=a.getText("image.label.title"),Ba=a.getText("image.label.description"),Ca=a.getText("image.label.width"),Da=a.getText("image.label.height"),Ea=a.getText("image.label.keepratio"),Fa=a.getText("ok"),Ga=a.getText("cancel"),Ha=a.getText("image.label.localfile"),Ia=a.getText("image.label.align"),Ja=a.getText("image.label.border"),Ka=a.getText("image.label.horizontal"),La=a.getText("image.label.vertical"),Ma=a.getText("align.top"),Na=a.getText("align.middle"),Oa=a.getText("align.bottom"),Pa=a.getText("align.left"),Qa=a.getText("align.right"),Ra=a.getText("image.label.align.texttop"),Sa=a.getText("image.label.align.textbottom"),Ta="image.dialog",Ua=a.constants.CommandTypes,Va={fileName:"",urlName:"",url:""},Wa=a.constants.DefaultImageSize,Xa=function(){return void 0!==na('<input type="file">').get(0).files}(),Ya=a.getSupportImageType();a.addCommand({command:"image.selectImage",type:Ua.SYSTEM_COMMAND,action:ba}),a.addCommand({command:"image.deselectImage",type:Ua.SYSTEM_COMMAND,action:aa}),a.addCommand({command:"edit.image",type:Ua.CUSTOM_COMMAND_RANGE,action:O}),a.addCommand({command:"image.checkLock",type:Ua.SYSTEM_COMMAND,action:C}),a.addButton(ra,{label:ua,tooltip:!0,icons:{primary:qa},togglable:!0,pressed:!1,iconOnly:!0,click:ca}),a.addMenuItem(ra,{icon:qa,text:xa+"...",click:ca}),a.addContextMenuItem(ra,{icon:qa,text:ya+"...",context:"image.selected",click:ca}),la=[{type:"columns",items:[{type:"radio",name:"URLRadio",proportion:"25%",align:"left",options:{label:za,click:S}},{type:"textbox",name:"URLInput",proportion:"75%",align:"left",options:{width:"98%",placeholder:"http://"}}]},{type:"columns",items:[{type:"radio",name:"fileRadio",proportion:"25%",align:"left",options:{label:Ha,click:R}},{type:"fileinput",name:"fileInput",proportion:"75%",align:"left",options:{accept:Ya,width:"98%"}}]}],ma=[{type:"columns",items:[{type:"label",proportion:"25%",align:"left",options:{label:za}},{type:"textbox",name:"URLInput",proportion:"75%",align:"left",options:{width:"98%",placeholder:"http://"}}]},{type:"columns",items:[{type:"label",proportion:"100%",align:"center",options:{label:da()}}]}],ka={title:va,modal:!0,resizable:!1,contentOverflow:!0,width:450,items:[{type:"container",items:[{type:"columns",items:[{type:"label",name:"titleLabel",proportion:"25%",align:"left",options:{label:Aa}},{type:"textbox",name:"titleInput",proportion:"75%",align:"left",options:{width:"98%"}}]},{type:"columns",items:[{type:"label",name:"desciptionLabel",proportion:"25%",align:"left",options:{label:Ba}},{type:"textbox",name:"descriptionInput",proportion:"75%",align:"left",options:{width:"98%"}}]},{type:"columns",items:[{type:"textbox",name:"widthInput",label:Ca,unit:"px",align:"left",options:{type:"integer",min:10,max:9999,maxlength:4}},{type:"textbox",name:"heightInput",label:Da,unit:"px",align:"left",options:{type:"integer",min:10,max:9999,maxlength:4}}]},{type:"checkbox",name:"keepRatioButton",options:{label:Ea,click:M}},{type:"columns",items:[{type:"selectmenu",name:"alignSelectMenu",label:Ia,align:"left",options:{maxHeight:100,autoCloseViaScroll:!1,menuItems:[{text:"<span>"+Ma+"</span>",click:function(){}},{text:"<span>"+Na+"</span>",click:function(){}},{text:"<span>"+Oa+"</span>",click:function(){}},{text:"<span>"+Pa+"</span>",click:function(){}},{text:"<span>"+Qa+"</span>",click:function(){}},{text:"<span>"+Ra+"</span>",click:function(){}},{text:"<span>"+Sa+"</span>",click:function(){}}]}},{type:"textbox",name:"borderInput",label:Ja,unit:"px",align:"left",options:{type:"integer",min:0,max:30,maxlength:2}}]},{type:"columns",items:[{type:"textbox",name:"horizontalPaddingInput",label:Ka,unit:"px",align:"left",options:{type:"integer",min:0,max:999,maxlength:3}},{type:"textbox",name:"verticalPaddingInput",label:La,unit:"px",align:"left",options:{type:"integer",min:0,max:999,maxlength:3}}]}]}],buttons:[{name:"okbutton",text:Fa,click:T},{name:"cancelbutton",text:Ga,click:function(){this.close()}}],open:V,close:_},ea(),a.addDialog(Ta,ka),a.one("editorinitialized",function(){var b=a.selectionManager;b.addParsingElemHandler("default_img",["ifr_handle","emb_handle","obj_handle","ado_handle","vdo_handle"],"img",function(b){for(var c,d=b.length;d--;)c=b[d],c.ownerDocument&&(c=na(c)),a.pluginUtils.isSupportImageData(c.getAttribute("src"))?(c.attr("unselectable","on"),c.attr("data-cui-image")||c.attr("data-cui-media")||c.attr("data-cui-pagebreak")||c.attr("data-cui-image","true"),c.css("border-top-width")||c.css("border-width","0px")):na(c).remove()}),na(a.getDoc()).on("click","map",function(b){var c=b.target;if(c.parentElement.name){var d=na("img[usemap='#"+c.parentElement.name+"']",c.ownerDocument);d&&d.length>0&&a.pluginUtils.selectItem(d[0])}return!1})}),a.one("editorcreate",function(){var b=a.pluginUtils;b.addInitialWidgetState(ra,!1,a.constants.ButtonTypes.TOGGLE)}),a.addFinalTask(function(){oa||(Xa&&j().element.off("change"),l().element.off("change"),n().element.off("keyup"),o().element.off("keyup")),ga&&na(ga).remove(),na=null,fa=null,ga=null,ha=null,ia=null,ja=null,oa=null,pa=null,qa=null,ra=null,sa=null,ta=null,ua=null,va=null,wa=null,xa=null,ya=null,za=null,Aa=null,Ba=null,Ca=null,Da=null,Ea=null,Fa=null,Ga=null,Ha=null,Ia=null,Ja=null,Ka=null,La=null,Ma=null,Na=null,Oa=null,Pa=null,Qa=null,Ra=null,Sa=null,Ta=null,Ua=null,ka=null,la=null,ma=null,Va=null,Wa=null,Xa=null,Ya=null})});