/*! cafe note v2.3.27 | Copyright 2014, S-Core, Inc. All Right Reserved. */
cafe.pluginManager.add("charcount",[],function(a){function b(a){var b,f=h.getElementById(k);f||(g||(g=d.find(".cui-state")),"undefined"==typeof a?b=c():(i+=a,b=i>0?i:0),b!==j&&(g.text(e+b),j=b))}function c(){function b(a){var c="";if(3===a.nodeType)return a.data;if(a=a.firstChild)do c+=b(a);while(a=a.nextSibling);return c}var c,d=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,e=/\u200B/gi;return a.isSpellcheckMode&&a.isSpellcheckMode()?i:(c=b(a.getBody()).replace(/\n/g,""),c.length?(e.test(c)&&(c=c.replace(/\u200B/g,"")),i=c.replace(d,"_").length):0)}var d,e,f,g,h,i=0,j=-1,k=a.constants.DUMY_PASTE_ELEM;f="charcount",e=a.getText(f)+": ",a.one("uicreate",function(){d=a.uiManager.getContainer().find(".cui-footer"),d.append('<div class="cui-state">'+e+"0</div>")}),a.one("editorinitialized",function(){h=a.getDoc(),a.$(a.getBody()).on("keyup",function(){b()})}),a.on("contentchanged historychanged historyadded",function(){b()}),a.on("tabsactivate",function(a,b){"edit"===b.newPanelName?d.find(".cui-state").css("display","block"):d.find(".cui-state").css("display","none")}),a.getCharCount=function(){if(!a.pluginUtils.isTextMode())return c()},a.modifyCharCount=function(c){a.pluginUtils.isTextMode()||b(c)},a.addFinalTask(function(){d=null,e=null,f=null,g=null,i=null,h=null,j=null,k=null}),"function"!=typeof cafe.getCharCount&&(cafe.getCharCount=function(a){var b;if(a&&(b=this.get(a),b&&b.isPluginLoaded("charcount")))return b.execCommand("codeview.updatecontent"),b.getCharCount()})});