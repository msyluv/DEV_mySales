/*! cafe note v2.3.28.1 | Copyright 2014, S-Core, Inc. All Right Reserved. */
!function(a,b){"use strict";function c(a,b){var c,d,f=a.length,g=[];for(c=0;c<f;c++){if(d=e[a[c]],!d)throw"Can not find a dependency module: "+a[c];g.push(d)}b.apply(null,g)}function d(a,b,d){if("string"!=typeof a)throw"invalid definition, module id must be defined";if("[object Array]"!==Object.prototype.toString.call(b))throw"Dependencies must be not null";if("[object Function]"!==Object.prototype.toString.call(d))throw"Implement function must be defined";c(b,function(){e[a]=d.apply(null,arguments)})}var e;a=a||window,e=a.Cafe&&a.Cafe.getModules?a.Cafe.getModules():{},d.amd=!0,d("plugins/table/BorderPreview",["jqueryCafe","ui/Core","ui/Widget","ui/Button"],function(a){return a.widget("ui.borderpreview",{options:{columns:2,rows:2,applied:{color:"#000000",style:"solid",width:"1px"},base:null,borders:{top:0,middle:0,bottom:0,left:0,center:0,right:0},labels:{top:"Top Border",middle:"Middle Border",bottom:"Bottom Border",left:"Left Border",center:"Center Border",right:"Right Border"}},_create:function(){var b,c,d=this,e="<table class='cui-menual-area'><tbody>",f="<div class='cui-left-top'></div><div class='cui-left-bottom'></div><div class='cui-right-top'></div><div class='cui-right-bottom'></div>",g="<div class='multipleRow cui-left-top-mid'></div><div class='multipleRow cui-right-top-mid'></div><div class='multipleRow cui-left-bottom-mid'></div><div class='multipleRow cui-right-bottom-mid'></div>",h="<div class='multipleCol cui-left-top-center'></div><div class='multipleCol cui-left-bottom-center'></div><div class='multipleCol cui-right-top-center'></div><div class='multipleCol cui-right-bottom-center'></div>",i=function(b){return a.ui.makeHTML(d._buttons[b].getHTMLData())};this._defaultOptions=a.extend(!0,{},this.options),this._createButtons(),b="<ul class='cui-border-controls cui-vertical'><li>"+i("top")+"</li><li>"+i("middle")+"</li><li>"+i("bottom")+"</li></ul>",c="<ul class='cui-border-controls cui-horizontal'><li>"+i("left")+"</li><li>"+i("center")+"</li><li>"+i("right")+"</li></ul>",e+="<tr><td>"+b+"</td><td class='cui-table-area'>"+g+h+f+this._createPreviewTable()+"</td></tr><tr><td></td><td>"+c+"</td></tr></tbody></table>",this.htmlData={tag:"div",attr:{class:["cui-borderpreview"]},contents:[e]}},_init:function(){var b,c;this._previewTable=a(".cui-preview-table",this.element);for(b in this._buttons)c=this._buttons[b],c.init()},_preview:function(b,c,d){var e,f,g,h,i,j=this.options,k=j.base,l=this._buttons[b],m=this._previewTable,n=!l.option("pressed")||d,o=function(b,c){var d,e=a(b,m),f=e.length;for(d=0;d<f;d++)e[d].style.setProperty("border-"+c,i,"important")};switch(b){case"top":e="[data-row='0']",f="top";break;case"middle":e="[data-row='0']",f="bottom",g="[data-row='1']",h="top";break;case"bottom":e="[data-row='"+(j.rows-1)+"']",f="bottom";break;case"left":e="[data-column='0']",f="left";break;case"center":e="[data-column='0']",f="right",g="[data-column='1']",h="left";break;case"right":e="[data-column='"+(j.columns-1)+"']",f="right"}c=n?a.extend({},c||j.applied):k?a.extend({},k[b]):null,i=c&&c.color&&c.style&&c.width?c.color+" "+c.style+" "+c.width:"",j.borders[b]=c,o(e,f),g&&h&&o(g,h),d||l.option("pressed",n)},_createButtons:function(){var b,c=this,d=this.options,e=d.columns,f=d.rows,g=d.labels,h={top:function(){c._preview("top")},middle:function(){c._preview("middle")},bottom:function(){c._preview("bottom")},left:function(){c._preview("left")},center:function(){c._preview("center")},right:function(){c._preview("right")}};this._buttons={};for(b in d.borders)this._buttons[b]=a.ui.button({iconOnly:!0,icons:{primary:"border-"+b},label:g[b],click:h[b]});e<2&&this._buttons.center.htmlData.attr.class.push("cui-state-hidden"),f<2&&this._buttons.middle.htmlData.attr.class.push("cui-state-hidden")},_createPreviewTable:function(){var a,b,c=this.options,d=c.columns,e=c.rows,f="<table class='cui-preview-table'><tbody>";for(b=0;b<e;b++){for(f+="<tr data-row='"+b+"'>",a=0;a<d;a++)f+="<td data-column='"+a+"' data-row='"+b+"'></td>";f+="</tr>"}return f+="</tbody></table>"},_destroy:function(){for(var a,b=this;b._buttons.length;)a=b._buttons.pop(),a.destroy();b._previewTable=null,b._buttons=null,b._defaultOptions=null},_setOption:function(b,c){var d;if(this._super(b,c),"base"===b)for(d in c)this._preview(d,c[d],!0);else if("borders"===b)for(d in c)this._preview(d,c[d]);else"columns"===b?(a("td[data-column='1']",this.previewTable)[c<2?"hide":"show"](),this._buttons.center.element[c<2?"hide":"show"](),a(".multipleCol")[c<2?"hide":"show"]()):"rows"===b&&(a("tr[data-row='1']",this.previewTable)[c<2?"hide":"show"](),this._buttons.middle.element[c<2?"hide":"show"](),a(".multipleRow")[c<2?"hide":"show"]())},getStyle:function(a){var b,c=this.options.borders;return c?(b=c[a],b?b.color+" "+b.style+" "+b.width:null):null},reset:function(){var b,c=this._buttons;for(b in c)c[b].option("pressed",!1);return a("tr, td",this._previewTable).removeAttr("style"),this.options=a.extend(!0,{},this._defaultOptions),this}}),a.ui.borderpreview}),d("plugins/table/TableDialog",["plugins/table/BorderPreview"],function(){return function(a,b,c){function d(b){return"transparent"===a.colorUtils.toName(b)?"transparent":a.colorUtils.toHEXString(b)}function e(a){return ca[a]||"none"}function f(a){var b=I.inArray(a,ca);return b!==-1?b:ca.length}function g(a,b){var c=b?ba:aa;return c[a].value||""}function h(a,b){var c,d=b?ba:aa,e=d.length;for(c=0;c<e;c++)if(d[c].value===a)return c;return 0}function i(a){var b=["display:inline-block;width: 100%;","height: 0px;","border-color: #5d5d5d transparent transparent transparent;","border-width: 1px;","border-top-style: "+a+";","margin: .5em 0;"].join("");return"<hr style='"+b+"'>"}function j(){var a,b,c,d=[];for(a=0,b=ca.length;a<b;a++)c=i(e(a)),d.push({text:c,label:c});return d.push({text:S}),{label:i(F),menuItems:d,autoCloseViaScroll:!1,select:function(a,b){var c,d=b.index;d>ca.length||(F=e(d),E&&(c=E.option("applied"),c.style=F,E.option("applied",c)))}}}function k(d,e,f){return{color:d,noColorLabel:ga,moreLabel:fa,more:c?function(){var d=a.getDialog(b),f=d.getWidget(e);c.open(f.getColor()),c.beforeok(function(a,b){f.setColor(b.hex)})}:null,change:f}}function l(){var c=a.getDialog(b);ha&&"function"==typeof ha.beforeOpen&&ha.beforeOpen(c)}function m(){r=a.getDialog(b),s=r.getWidget("rowCountInput"),t=r.getWidget("columnCountInput"),u=r.getWidget("widthInput"),v=r.getWidget("heightInput"),w=r.getWidget("minWidthLabel"),x=r.getWidget("minHeightLabel"),z=r.getWidget("borderWidthInput"),C=r.getWidget("horizontalAlignSelectMenu"),D=r.getWidget("verticalAlignSelectMenu"),B=r.getWidget("borderStyleSelectMenu"),A=r.getWidget("borderColorInput"),y=r.getWidget("backgroundColorInput"),E=r.getWidget("borderPreview").reset(),a.blur(),ha&&"function"==typeof ha.open&&ha.open(r)}function n(){ha&&"function"==typeof ha.close&&ha.close(r),s.value(""),s.disable(),t.value(""),t.disable(),u.value(""),u.option("min",30),v.value(""),v.option("min",30),w.option("label",""),x.option("label",""),z.value(""),y.setColor("transparent"),A.setColor("000000"),C.index(0),D.index(0),s=null,t=null,u=null,v=null,y=null,z=null,B=null,A=null,C=null,D=null}function o(){var b,c,f,g;a.focus(),ha&&"function"==typeof ha.ok&&(b={x:t.value()||1,y:s.value()||1,borderStyle:e(B.index()),borderColor:d(A.getColor()),backgroundColor:d(y.getColor()),borders:E.option("borders"),horizontalAlign:G,verticalAlign:H},c=u.value(),f=v.value(),g=z.value(),I.isNumeric(c)&&(b.width=parseInt(c,10)),I.isNumeric(f)&&(b.height=parseInt(f,10)),I.isNumeric(g)&&(b.borderWidth=z.value()||0),ha.ok(r,b)),this.close()}function p(){ha&&"function"==typeof ha.cancel&&ha.cancel(r),this.close()}function q(a){ha=a}var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=a.$,J=a.getText("table.menu.inserttable"),K=a.getText("table.label.rowcount"),L=a.getText("table.label.columncount"),M=a.getText("table.label.width"),N=a.getText("table.label.height"),O=a.getText("table.label.horizontalalign"),P=a.getText("table.label.verticalalign"),Q=a.getText("table.label.backgroundcolor"),R=a.getText("table.label.borderstyle"),S=a.getText("table.label.borderstyle.none"),T=a.getText("table.label.bordercolor"),U=a.getText("table.label.borderwidth"),V=a.getText("table.label.borderapplyto"),W=a.getText("align.top"),X=a.getText("align.middle"),Y=a.getText("align.bottom"),Z=a.getText("align.left"),$=a.getText("align.right"),_=a.getText("align.center"),aa=[{text:"",value:""},{text:X,value:"middle"},{text:W,value:"top"},{text:Y,value:"bottom"}],ba=[{text:"",value:""},{text:Z,value:"left"},{text:_,value:"center"},{text:$,value:"right"}],ca=["solid","dotted","dashed"],da=a.getText("ok"),ea=a.getText("cancel"),fa=a.getText("more"),ga=a.getText("nocolor"),ha={};return F=e(0),a.addDialog(b,{title:J,modal:!0,resizable:!1,contentOverflow:!0,width:400,items:[{type:"columns",name:"test1",items:[{type:"textbox",name:"rowCountInput",label:K,options:{type:"integer",min:1,max:999,maxlength:2,disabled:!0},unit:" "},{type:"textbox",name:"columnCountInput",label:L,options:{type:"integer",min:1,max:999,maxlength:2,disabled:!0},unit:" "}]},{type:"columns",items:[{type:"textbox",name:"widthInput",label:M,options:{type:"integer",min:30,max:9999,maxlength:4},unit:"px"},{type:"textbox",name:"heightInput",label:N,options:{type:"integer",min:30,max:9999,maxlength:4},unit:"px"}]},{type:"columns",items:[{type:"label",name:"minWidthLabel",label:" "},{type:"label",name:"minHeightLabel",label:" "}]},{type:"columns",items:[{type:"selectmenu",name:"horizontalAlignSelectMenu",label:O,options:{label:Z,menuItems:ba,autoCloseViaScroll:!1,select:function(a,b){G=g(b.index,!0)}}},{type:"selectmenu",name:"verticalAlignSelectMenu",label:P,options:{label:X,menuItems:aa,autoCloseViaScroll:!1,select:function(a,b){H=g(b.index,!1)}}}]},{type:"columns",items:[{type:"colorinput",name:"backgroundColorInput",label:Q,options:k("transparent","backgroundColorInput")},{type:"html",contents:"<div class='cui-line'></div>"}]},{type:"html",contents:"<hr>"},{type:"columns",items:[{type:"selectmenu",name:"borderStyleSelectMenu",label:R,options:j()},{type:"colorinput",name:"borderColorInput",label:T,options:k("000000","borderColorInput",function(a,b){var c;E&&(c=E.option("applied"),c.color=d(b.color),E.option("applied",c))})}]},{type:"columns",items:[{type:"textbox",name:"borderWidthInput",label:U,options:{type:"integer",min:0,max:10,maxlength:2,change:function(a,b){var c;E&&(c=E.option("applied"),c.width=b.value+"px",E.option("applied",c))}},unit:"px"},{type:"html",contents:"<div class='cui-line'></div>"}]},{type:"borderpreview",name:"borderPreview",label:V}],buttons:[{text:da,click:o},{text:ea,click:p}],beforeOpen:l,open:m,close:n}),a.on("dialogcreate",function(a,b){var c=b.dialog;c.validateColor=d,c.getIndexByBorderStyle=f,c.getIndexByAlign=h,c.toggleTableSizeColumns=function(a){s&&s.element.closest(".cui-columns").toggle(a)},c.toggleAreaSizeColumns=function(a){u&&u.element.closest(".cui-columns").toggle(a)},c.toggleMinSizeColumns=function(a){w&&w.element.closest(".cui-columns").toggle(a)},c.toggleAlignColumns=function(a){C&&C.element.closest(".cui-columns").toggle(a)}}),{name:b,setCallback:q}}}),d("plugins/table/CellControl",["jqueryCafe"],function(a){var c=".cui-grid-control",d="td, th",e="> tr > th, > tr > td, > thead > tr > th, > thead > tr > td, > tbody > tr > th, > tbody > tr > td, > tfoot > tr > th, > tfoot > tr > td",f="> tr, > thead > tr, > tbody > tr, > tfoot > tr",g="> colgroup > col",h="data-cui-selected";return function(i){function j(b,c,d,e,f){function g(b){var c,d,e,f,h,i,j,k,l=!1;for(d=o;d<=r;d++)for(c=n;c<=p;c++)if(e=b[d]?b[d][c]:null,e&&!e.selected&&(e.selected=!0,f=e.cell,(1!==f.colSpan||1!==f.rowSpan)&&(h=a(f).data("cellLeft"),i=a(f).data("cellTop"),j=h+f.colSpan-1,k=i+f.rowSpan-1,n>h&&(n=h,l=!0),o>i&&(o=i,l=!0),p<j&&(p=j,l=!0),r<k&&(r=k,l=!0),l)))return void g(b)}var h,i,j,k,l,m=a(b),n=d.x,o=d.y,p=m.data("cellLeft"),r=m.data("cellTop");for(a(e).data("targetCoord",{x:p,y:r}),n>p&&(p=[n,n=p][0]),o>r&&(r=[o,o=r][0]),g(c),l={left:n,top:o,right:p,bottom:r},n>f.left&&(n=f.left),o>f.top&&(o=f.top),p<f.right&&(p=f.right),r<f.bottom&&(r=f.bottom),i=o;i<=r;i++)for(h=n;h<=p;h++)k=c[i]?c[i][h]:null,k&&(j=k.cell,j&&(k.selected?q(j):u(j),k.selected=!1));return l}function k(a){var b=a.data;O=j(a.currentTarget,b.matrix,b.coordinate,b.grid,O),a.data.last=a.currentTarget,a.preventDefault(),a.stopPropagation()}function l(b){var d=b.data,e=d.grid,f=J(d.last);f?i.selectionManager.setRange(f,0,f,0):(f=J(b.data.origin),i.selectionManager.setRange(f,0,f,0)),a(e).removeClass("cui-state-cell-selecting"),""===e.className&&e.removeAttribute("class"),a(e.ownerDocument).off(c),O=null,M(e)}function m(b){function d(){o.trigger("mouseup")}var e,f,g,h,j,m,o,p;b&&(f=a(b.table),e=f[0],g=b.startCell,e&&g&&(m=f.data("cui-matrix"),o=a(e.ownerDocument),m||(n(e),m=f.data("cui-matrix")),q(g),j=a(g),J(g)||j.append(i.createEmptyLine()),p={x:j.data("cellLeft"),y:j.data("cellTop")},h={grid:e,origin:g,last:g,coordinate:p,matrix:m},f.data("originCoord",p).data("targetCoord",p),O={left:h.coordinate.x,top:h.coordinate.y,right:h.coordinate.x,bottom:h.coordinate.y},a(e).addClass("cui-state-cell-selecting"),o.on("mousemove"+c,"table[data-cui-selected] > tr > th, table[data-cui-selected] > tr > td, table[data-cui-selected]> thead > tr > th, table[data-cui-selected] > thead > tr > td, table[data-cui-selected]> tbody > tr > th, table[data-cui-selected] > tbody > tr > td, table[data-cui-selected]> tfoot > tr > th, table[data-cui-selected] > tfoot > tr > td",h,k).on("mouseup"+c,h,l).on("mouseup"+c,function(){window.removeEventListener("mouseup",d)}),i.browser.ie&&o.on("keydown"+c,function(){o.trigger("mouseup")}),window.addEventListener("mouseup",d)))}function n(b){var c,d,e,g,h,i,j,k,l,m,n=[],o=function(a,b){var d,e=a[b],f=e.length;for(c=0;c<f;c++)e[c]&&(d=e[c].cell,d&&d.rowSpan>1&&(d.rowSpan=Math.max(b-e[c].top,1),1===d.rowSpan&&d.removeAttribute("rowspan")));return a.slice(0,b)};if(b){for(l=b.rows.length,m=a(f,b).length,d=0;d<l;d++)for(e=b.rows[d],k=e.cells.length,c=0;c<k;c++){for(g=e.cells[c],h=c;n[d]&&n[d][h];)++h;for(i=h;i<h+g.colSpan;++i)for(j=d;j<d+g.rowSpan;++j)n[j]||(n[j]=[]),n[j][i]={top:d,left:h,cell:g,selected:!1};a(g).data("cellLeft",h).data("cellTop",d)}n.length>m&&(n=o(n,m)),a(b).data("cui-matrix",n)}}function o(b){var c,d,e,f,g;if(b){for(f=b.rows.length,d=0;d<f;d++)for(e=b.rows[d],g=e.cells.length,c=0;c<g;c++)a(e.cells[c]).removeData(["cellLeft","cellTop"]);a(b).removeData("cui-matrix")}}function p(b){var c,d,e,f=0,g=b.rows.length;for(c=0;c<g;c++)d=b.rows[c],d.cells?f+=d.cells.length:a(d).remove();return f||(e=b.nextSibling,a(b).remove(),b=null,e&&i.selectionManager.setCursorPosition({node:e})),b}function q(b){var c;!b||(b instanceof a||a.isArray(b))&&!b.length||(c=a(b).attr(h,!0),P||(P=[]),P=a.unique(P.concat(c.toArray())))}function r(b){q(a(b).siblings().andSelf())}function s(b){var c,d,f,g,h,j=a(b),k=j.data("cellLeft");for(b=j[0],h=i.selectionManager.getClosest(b,"table"),g=a(e,h),d=g.length,c=0;c<d;c++)f=g.eq(c),f.data("cellLeft")===k&&q(f)}function t(b){q(a(e,b))}function u(b,c){var d;!b||(b instanceof a||a.isArray(b))&&!b.length||(d=a(b).removeAttr(h).toArray(),!c&&P&&(P=P.filter(function(b){return a.inArray(b,d)===-1}),P.length||(P=null)))}function v(c){if(P){if(!c){if(!P.length)return;c=i.selectionManager.getClosest(P[0],"table")}u(a(e,c),!0),P=b,a(c).removeData("originCoord targetCoord"),M(c,P)}}function w(){return P}function x(b,c){function e(a,b){a.append(b.clone().html(S).removeAttr("rowSpan"))}var f,g,h,j,k,l,m,o=9999,p=a(b),q=p.closest("tr"),r=q.clone().empty(),s=q.closest("table"),t=s[0],u=s.data("cui-matrix"),v=a("> colgroup > col",s).length,w=i.selectionManager.getRange().cloneRange();for(b=p[0],c=c||"up",m=p.data("cellTop")+("down"===c?b.rowSpan-1:0),f=0;f<v;f++){if(!u[m]||!u[m][f])return!1;j=u[m][f],g=j.cell,h=a(g),k!==g&&(k=g,o=Math.min(o,h.height()),g.rowSpan>1?m===h.data("cellTop")&&"up"===c||m===h.data("cellTop")+g.rowSpan-1&&"down"===c?e(r,h):g.rowSpan+=1:e(r,h))}if(a("> td, > th",r).height(o),"down"===c){for(l=b.rowSpan-1,f=0;f<l;f++)q=q.next();q.after(r)}else q.before(r);return t.style.height=Math.round(parseFloat(t.style.height)+o)+"px",i.trigger("rowinsert",{table:t,target:b,newCells:q.find(d)}),n(t),i.selectionManager.setRange(w.startContainer,w.startOffset,w.endContainer,w.endOffset),!0}function y(b,c){function d(a){var b=a.clone().html(S).removeAttr("colspan");a["left"===c?"before":"after"](b),t.push(b)}var e,f,h,j,k,l,m,o=a(b),p=o.closest("table"),q=p.data("cui-matrix"),r=p[0],s=r.rows.length,t=[];for(b=o[0],c=c||"left",m=a(b).data("cellLeft")+("right"===c?b.colSpan-1:0),j=a(g,r).eq(m),j["left"===c?"before":"after"](j.clone()),p.width(p.width()+parseFloat(j.css("width"))),e=0;e<s;e++)k=q[e][m],f=k.cell,h=a(f),l!==f&&(l=f,f.colSpan>1?m===h.data("cellLeft")&&"left"===c||m===h.data("cellLeft")+f.colSpan-1&&"right"===c?d(h):f.colSpan+=1:d(h));return i.trigger("columninsert",{table:r,target:b,newCells:t}),n(r),!0}function z(b){var c,d,g,h,i,j,k,l,m,o,p,q,r,s,t,u=99999,v=0,w=[],x=[],y=[],z=[];if(b&&b.length){for(c=a(b),d=c.closest("table"),p=d[0],d.data("cui-matrix")||n(p),q=d.data("cui-matrix"),m=0,o=c.length;m<o;m++)g=c.eq(m),s=g.data("cellTop"),t=s+g[0].rowSpan-1,u=Math.min(s,u),v=Math.max(t,v);for(m=u;m<=v;m++)w.push(m);for(i=a(f,p),j=parseFloat(d.css("height")),m=w.length-1;m>=0;--m)h=i.eq(w[m]),j-=h.height(),y.push(h[0]);for(c=a(e,p),m=0,o=c.length;m<o;m++)k=c[m],g=a(k),s=g.data("cellTop"),l=k.rowSpan,a.inArray(s,w)!==-1?l>1&&s+l-1>=v?z.push({cell:k,uniqueClass:a({}).uniqueId()[0].id}):x.push(k):l>1&&s<=v&&z.push({cell:k,uniqueClass:a({}).uniqueId()[0].id});return q[v+1]?r=u:q[u-1]&&(r=u-1),{rows:y,cells:x,splits:z,height:j,focusIndex:r}}}function A(b){var c,d,f,h,j,k,l,m,o,p,q,r,s,t,u=99999,v=0,w=0,x=[],y=[],z=[],A=[];if(b&&b.length){for(m=a(b),f=i.selectionManager.getClosest(m[0],"table"),p=a(f),p.data("cui-matrix")||n(f),s=p.data("cui-matrix"),c=0,d=m.length;c<d;c++)o=m.eq(c),k=o.data("cellLeft"),l=k+o[0].colSpan-1,u=Math.min(k,u),v=Math.max(l,v);for(c=u;c<=v;c++)A.push(c);for(r=a(g,f),w=parseFloat(p.css("width")),c=A.length-1;c>=0;--c)q=r.eq(A[c]),w-=parseFloat(q.css("width")),x.push(q[0]);for(m=a(e,f),c=0,d=m.length;c<d;c++)h=m[c],o=a(h),k=o.data("cellLeft"),j=h.colSpan,a.inArray(k,A)!==-1?j>1&&k+j-1>v?z.push({cell:h,colSpan:k+j-1-v}):y.push(h):j>1&&(k>u&&k<=v&&k+j-1>v?z.push({cell:h,colSpan:k+j-1-v}):k<u&&(k+j-1>=v?z.push({cell:h,colSpan:j-v+u-1}):k+j-1>=u&&k+j-1<v&&z.push({cell:h,colSpan:j-k-j+u})));return s[0]&&(t=s[0][v+1]||s[0][u-1]),{cols:x,cells:y,reduces:z,width:w,focus:t?t.cell:null}}}function B(b,c,d){var e=null,f=d?-1:1,g=a(c),h=a(b),i=h.data("cui-matrix"),j=g.data("cellLeft"),k=g.data("cellTop")+f,l=function(a,b){return i[a]?i[a][b]||null:null};return k>=0&&(e=l(k,j),!d&&e&&e.cell&&e.cell.rowSpan>1&&(k+=e.cell.rowSpan-1,e=l(k,j))),e?e.cell:null}function C(a,b,c){var d,e,f=i.selectionManager.getClosest,g=f(a,"tr"),h=g.rowIndex,j=a.cellIndex;if(c=c||f(g,"table"),d=c.rows.length,e=c.rows[h].cells.length,b&&0===j){for(h--;h>=0;){if(g=c.rows[h],g&&g.cells.length){j=g.cells.length-1;break}h--}if(h<0)return null}else if(b||j!==e-1)j+=b?-1:1;else{for(h++;h<=d-1;){if(g=c.rows[h],g&&g.cells.length){j=0;break}h++}if(h>=d)return null}return c.rows[h].cells[j]}function D(b,c){var d,e,h,j,k,l,m,o,p,q,r,s,t,u,w,x,y,z,A,B,C,D=i.selectionManager,E=[],F=c.length;if(!c||!F)return null;if(1===F)return c[0];if(i.browser.ie&&D.setCursorPosition({node:i.getBody()}),k=N(c),l=k.startX,o=k.startY,m=k.endX,p=k.endY,s=m-l+1,y=p-o+1,e=c.eq(0),t=a(g,b),r=t.length,z=a(f,b),q=z.length,s>1)if(y>=q&&t[l]){for(u=t[l],w=u.style.width?parseInt(u.style.width,10):"null",E.push(w),x=w,d=l+1;d<=m;d++){if(x){if(!t[d])continue;w=parseInt(t[d].style.width,10),E.push(w),x+=w}else E.push("null");a(t[d]).remove()}if(x){for(u.style.width=x+"px",d=0;d<s;d++)E[d]=E[d]/x;u.setAttribute("data-cafe-span",E.toString())}e.removeAttr("colSpan").attr("data-cafe-colspan",s)}else t[l].removeAttribute("data-cafe-span"),e.removeAttr("data-cafe-colspan").attr("colSpan",s);else t[l]&&t[l].removeAttribute("data-cafe-span"),e.removeAttr("colSpan data-cafe-colspan");if(y>1){if(e.attr("rowSpan",y),s>=r){for(A=z[o],h=a("> td, > th",A).filter("[data-cui-selected]").eq(0),h.length&&(B=parseFloat(h[0].style.height)+parseFloat(h.css("paddingTop")||0)+parseFloat(h.css("paddingBottom")||0)+parseFloat(h.css("marginTop")||0)+parseFloat(h.css("marginBottom")||0),C=B),d=o+1;d<=p;d++)h=a("> td, > th",z[d]).filter("[data-cui-selected]").eq(0),h.length&&(B=parseFloat(h[0].style.height)+parseFloat(h.css("borderBottomWidth")||0)+parseFloat(h.css("paddingTop")||0)+parseFloat(h.css("paddingBottom")||0)+parseFloat(h.css("marginTop")||0)+(d===p?0:parseFloat(h.css("marginBottom")||0)),C+=B);c[0].style.height=C+"px"}}else e.removeAttr("rowSpan");for(d=1;d<F;d++)h=c.eq(d),e.append(h.html()),h.remove();return j=L(e),j.length||j.push(S),e.empty().append(j),v(b),n(b),e[0]}function E(b,c,d,e){var f,g,h=[];if(c=a(c)[0],d=parseInt(d,10),e=parseInt(e,10),d>1&&(h=G(b,c,d)),e>1)for(H(b,c,e),f=0,g=h.length;f<g;f++)H(b,h[f],e);return v(b),i.selectionManager.setCursorPosition({node:J(a(c)),offset:0}),i.trigger("cellsplit",{table:b,target:c,newCells:h}),!0}function F(b,c){function d(b,c,e){var f;return c<=0||!b[e][c-1]?null:(f=b[e][c-1].cell,e>a(f).data("cellTop")?d(b,c-1,e):f)}var e,h,j,k,l,m,o,p,q,r,s,t,u,w,x,y,z,A=parseInt(c.getAttribute("data-cafe-colspan"),10)||c.colSpan,B=c.rowSpan;if(1===A&&1===B)return!1;if(w=a(c),s=w.data("cellLeft"),t=w.data("cellTop"),u=a(b).data("cui-matrix"),c.getAttribute("data-cafe-colspan")){if(m=a(g,b).eq(s),q=m[0],o=q.getAttribute("data-cafe-span"),!o)return!1;for(p=parseFloat(q.style.width),o=o.split(","),q.removeAttribute("data-cafe-span"),j=o.length,"null"!==o[0]&&(q.style.width=parseFloat(o[0])*p+"px"),e=1;e<j;e++)r=m.clone()[0],"null"!==o[e]&&(r.style.width=parseFloat(o[e])*p+"px"),a(q).after(r),q=r}for(l=w.height()/B,x=w.clone().html(S).removeAttr("colspan rowspan data-cafe-colspan").height(l),k=t+B,j=s+A,h=t;h<k;h++)for(e=s;e<j;e++)e===s&&h===t||(y=x.clone()[0],z=d(u,e,h),z?a(z).after(y):a(f,b).eq(h).prepend(y),u[h][e]||(u[h][e]={}),u[h][e].cell=y);return w.removeAttr("colSpan rowSpan data-cafe-colspan").height(l),i.selectionManager.setCursorPosition({node:J(w),offset:0}),v(b),n(b),x=null,!0}function G(b,c,d){var e,f,h,j,k=a(b),l=k.data("cui-matrix"),m=d-1,o=a(g,b).length,p=a(c),q=p.data("cellTop"),r=a(i.selectionManager.getClosest(c,"tr")),s=[];for(e=0;e<o;e++)f=l[q][e].cell,f!==c&&(1===f.colSpan?f.rowSpan+=m:f.colSpan>1&&f!==h&&(f.rowSpan+=m,h=f));for(e=0;e<m;e++)j=p.clone().html(S),r.after(r.clone().empty().append(j)),s.push(j[0]);return n(b),s}function H(b,c,d){var e,f,h,i=a(b),j=i.data("cui-matrix"),k=d-1,l=b.rows.length,m=a(c),o=m.data("cellLeft"),p=a(g,b).eq(o),q=p.width()/d;if(1===c.colSpan){for(p.width(q),e=0;e<k;e++)p.after(p.clone());for(e=0;e<l;e++)f=j[e][o].cell,f!==c&&(1===f.rowSpan?f.colSpan+=k:f.rowSpan>1&&f!==h&&(f.colSpan+=k,h=f))}else c.colSpan=1;for(e=0;e<k;e++)m.after(m.clone().html(S));n(b)}function I(b,c,d){function e(a){return a?a.color+" "+a.style+" "+a.width:null}function f(b,c,d,e,f){var g,h,i,j,k="left"===b||"left"===c,l=k?d+f:e+f;if(y[c])for(g=0;g<f;g++)i=k?d+g:d,j=k?e:e+g,q[i]&&q[i][j]&&(h=q[i][j].cell,(k?l>=i+h.rowSpan:l>=j+h.colSpan)&&a(h).css("border-"+b,y[c]))}function g(a,b,c){return a.style["border"+c]||b["border"+c+"Color"]+" "+b["border"+c+"Style"]+" "+b["border"+c+"Width"]}var h,i,j,k,l,m,n,o,p=a(b),q=p.data("cui-matrix"),r=a(c),s=r.length,t=N(r),u=t.startX,v=t.endX,w=t.startY,x=t.endY,y={top:e(d.top),middle:e(d.middle),bottom:e(d.bottom),left:e(d.left),center:e(d.center),right:e(d.right)};for(h=0;h<s;h++)i=r.eq(h),j=i[0],k=i.data("cellLeft"),l=i.data("cellTop"),m=j.colSpan,n=j.rowSpan,o=window.getComputedStyle?window.getComputedStyle(j):j.currentStyle,i.css({"border-top":(l===w?y.top:y.middle)||g(j,o,"Top"),"border-right":(k+m-1===v?y.right:y.center)||g(j,o,"Right"),"border-bottom":(l+n-1===x?y.bottom:y.middle)||g(j,o,"Bottom"),"border-left":(k===u?y.left:y.center)||g(j,o,"Left")}),l===w&&f("bottom","top",l-1,k,m),k===v&&f("left","right",l,k+1,n),l===x&&f("top","bottom",l+1,k,m),k===u&&f("right","left",l,k-1,n)}function J(b){var c,d=a(b),e="P, H1, H2, H3, H4, H5, H6, DIV, UL, OL";return c=d.children(e).first(),c||(c=d.find(R.join(",")).first()),i.contentUtils.isEmptyLine(c[0])?c[0]:K(c[0])||c[0]}function K(a){for(var b,c=a,d=i.contentUtils;c;){if(b=c.childNodes[0],!b)return c;if(3===b.nodeType)return b;if(1===b.nodeType&&d.isContentElementInLine(b)||d.isPagebreak(b))return c;c=b}}function L(a){var b,c,d=a.children(),e=[d[0]],f=d.length,g=i.contentUtils;for(b=1;b<f;b++)c=d[b],g.isFormattedEmptyLine(c)||e.push(c);return e[1]&&g.isFormattedEmptyLine(e[0])&&e.shift(),e}function M(a,b){a&&(b=b||w(),i.trigger("tablestatechange",{table:a,cells:b}))}function N(a){var b,c,d,e,f,g,h,i,j,k;for(j=a.eq(0),d=j.data("cellLeft"),e=j[0].colSpan?d+j[0].colSpan-1:d,f=j.data("cellTop"),g=j[0].rowSpan?f+j[0].rowSpan-1:f,i=a.length,h=1;h<i;h++)k=a.eq(h),b=k.data("cellLeft")+k[0].colSpan-1,c=k.data("cellTop")+k[0].rowSpan-1,d=d<b?d:b,e=e>b?e:b,f=f<c?f:c,g=g>c?g:c;return{startX:d,startY:f,endX:e,endY:g}}var O,P,Q=i.editorManager.editorConstants,R=Q.keys(Q.LineBlockElements),S=i.createEmptyLine(!0);return{dynamicSelect:m,scanTable:n,clearTable:o,getSelected:w,select:q,selectRow:r,selectColumn:s,selectAll:t,selectRecursivly:j,unselect:u,unselectAll:v,insertRow:x,insertColumn:y,getDeletableRow:z,getDeletableColumn:A,getUpOrDownCell:B,getNeighbor:C,getFirstTextNode:J,merge:D,split:E,splitMerged:F,changeBorder:I,cleaning:p,tableStateChange:M,getSelectedCellsStartEndPosition:N}}}),d("plugins/table/TableControl",["jqueryCafe","utilities/UnitConverter"],function(a,b){var c="> tr, > thead > tr, > tbody > tr, > tfoot > tr",d="> tr > th, > tr > td, > thead > tr > th, > thead > tr > td, > tbody > tr > th, > tbody > tr > td, > tfoot > tr > th, > tfoot > tr > td";return function(e){function f(){return E}function g(b){var c="TABLE"===b.nodeType?b:e.selectionManager.getClosest(b,"table"),d=a(c);c!==E&&(a("table[data-cui-selected]",e.getBody()).removeAttr("data-cui-selected"),e.trigger("tablebeforeselect",{table:c}),d.attr("data-cui-selected","true"),E=c,e.trigger("tableselect",{table:c}))}function h(b){var c=a(b||f());c&&c.removeAttr("data-cui-selected").removeData("originCoord targetCoord"),E=null,e.trigger("tableunselect",{table:c})}function i(b,c){function f(a){return a?a.color+" "+a.style+" "+a.width+";":"#000 solid 1px;"}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w={width:"1px",style:"solid",color:"black"},x=e.getBody(),y=b.x||1,z=b.y||1;for(u=b.borders||{top:w,middle:w,bottom:w,left:w,center:w,right:w},t=a(e.getDoc()).height()<=a(e.uiManager.getEditArea()).height()?a.ui.getScrollbarWidth():0,p=a.isNumeric(b.width)?b.width:a(c).innerWidth()-t,q=a.isNumeric(b.width)?b.widthUnit||"px":"px",r=Math.round(p/y),v='<table style="display:none;'+a.map(C,function(a,b){return b+":"+a+";"}).join("")+"width: "+p+q+";border: 0px none;",b.backgroundColor&&(v+="background-color:"+b.backgroundColor+";"),v+='"><colgroup>',g=0;g<y;g++)v+='<col style="width:'+r+q+';"/>';for(v+="</colgroup><tbody>",h=0;h<z;h++){for(v+="<tr>",l="border-top:"+f(0===h?u.top:u.middle),m="border-bottom:"+f(h===z-1?u.bottom:u.middle),g=0;g<y;g++)n="border-left:"+f(0===g?u.left:u.center),o="border-right:"+f(g===y-1?u.right:u.center),v+="<td style='"+l+o+m+n+"'>"+D+"</td>";v+="</tr>"}return v+="</tbody></table>",i=a(v).appendTo(x),j=a(d,i),s=Math.round((b.height-parseFloat(u.top.width)-parseFloat(u.middle.width)*(b.y-1)-parseFloat(u.bottom.width))/b.y),i.height(b.height),j.height(s),k=i.clone().css("display",""),i.remove(),i=null,k[0]}function j(a){var b,c,d,f,g=e.contentUtils,h=e.selectionManager,j=h.getCursorPosition(!1);return!(!j||!a)&&(f=j.lineElement,b=a.nodeName&&"TABLE"===a.nodeName?a:i(a,f),c=/P|H1|H2|H3|H4|H5|H6/.test(f.tagName),c?0===j.col||g.isEmptyLine(f)?f.parentNode.insertBefore(b,f):(d=g.splitLine(j.node,j.offset,function(a,b){b.children.length||"​"!==b.innerText||(b.innerText="")},j.isRightside),d.parentNode.insertBefore(b,d)):g.insertElement(b),e.trigger("tableinsert",{table:b}),!0)}function k(b){var c,d={},g=b||f();return!!g&&(c=g.nextSibling,a(g).remove(),g=null,c&&(d.node=c,e.selectionManager.setCursorPosition(d)),e.trigger("tableremove"),!0)}function l(a,c,d,f,g,h){var i,j,k,l="border"+(f||""),m=g?g:c[l+"Width"],n=c[l+"Style"],o=h?h:c[l+"Color"];m?/px$/i.test(b.toPX(m))||(m+="px"):m=d.width,n||(n="none"),i=m||d.width,j="none"===n?d.style:n,k=o||d.color,e.browser.ie&&d.hasTableBorder&&"0.5px"===m&&"none"===n&&"rgb(0, 0, 0)"===o&&(i=d.width,j=d.style,k=d.color),a.style[l]=i+" "+j+" "+k}function m(c,d){var e=c.style[d]||(F[d]?F[d].exec(c.getAttribute("style")):null)||c.getAttribute(d);return a.isArray(e)&&(e=e[1]),G.test(e)?e=b.toPX(e)+"px":H.test(e)&&(e+="px"),e||null}function n(a){return!!a.style.width}function o(a){return a.replace(/(\d+(?:\.?\d*))(?:pt|in(?:ch)?|cm)/i,function(a){return b.toPX(a)+"px"})}function p(a,b){return Math.round(a)===Math.round(b)}function q(a){var b,c,d,e=[],f=a.length;for(b=0;b<f;b++)c=a.eq(b),e.push(c.width());for(d=c.parent(),d.empty(),b=0;b<f;b++)d.append('<col style="width: '+e[b]+'px;">')}function r(a,b,c,d){var e,f,g,h="fixed"===d,i=0,j=c.length;if(h||a)for(b?i=h&&b>a?1:a/b:g=a/j,e=0;e<j;e++)f=c.eq(e),c[e].style.width=(i?f.width()*i:g)+"px;"}function s(b,c){var d=c?' style="width:'+c+'"':"";a(b).append("<col"+d+">")}function t(a,c){var d,e,f,g,h=a.length;for(d=0;d<h;d++)e=a[d][c].cell,f=m(e,"width"),!f||b.isRelativeLengthUnit(f)||e.hasAttribute("colspan")||("undefined"==typeof g&&(g=0),f=parseFloat(f),g=f>g?f:g);return g}function u(a,b){var c,d,e,f=0;for(e=0;e<a.length;e++)c=a[e],d=parseFloat(c.style.width||c.getAttribute("width"))||0,f+=d;return p(b,f)}function v(c,d,f,g){var h,i,j,k,l,n,o,s,v,w,x,y=0,z=0;if(f[0]&&(g=a("> colgroup > col",c),x=g.length,l=f[0].length)){for(;l<x;)i=g.eq(--x)[0],i.parentNode.removeChild(i);for(;l>x;)g.last().after("<col>"),x++;for(g=a("> colgroup > col",c),x=g.length,h=0;h<x;h++)if(j=g.eq(h),i=j[0],i.getAttribute("width")||i.style.width){if(k=m(i,"width")){if(b.isRelativeLengthUnit(k))n=!0;else if(k=b.toPX(k),k="number"==typeof k?k+="px":k,o=f[0][h].cell,s=o.style.width,s&&(k=b.toPX(s),v=parseInt(o.getAttribute("colspan"))||0)){if(0===h&&x===v&&u(g,parseFloat(k))){z=x,y=parseFloat(k);break}w=t(f,h),"undefined"!=typeof w?k=w:(k=parseFloat(k)/parseInt(o.getAttribute("colspan"),10),k=k+="px")}i.style.width=k,z++,y+=parseFloat(k)}i.removeAttribute("width")}z!==x||p(d,y)||n||(e.browser.safari?q(g):r(d,y,g,c.style.tableLayout))}}function w(c,d,f,g){var h,i,j,k,l,o,q,t,u,w,x,y=0,z=0;if(g&&g.length)return void v(c,d,f,g);if(f&&f.length){for(t=a(c),w=a("<colgroup></colgroup>"),j=f.length,u=f[0],k=u.length,h=0;h<k;h++)if(l=u[h].cell,o=l.colSpan,q=m(l,"width"),e.isMSOfficeContent&&e.isMSOfficeContent.word&&!n(l)&&(q=b.convertPTToPX(q,!0)+"px"),q&&b.isRelativeLengthUnit(q)&&(x=!0),o>1){for(q=null,i=1;i<j;i++)if(f[i][h]&&(l=f[i][h].cell,1===l.colSpan)){q=m(l,"width"),e.isMSOfficeContent&&e.isMSOfficeContent.word&&!n(l)&&(q=b.convertPTToPX(q,!0)+"px");break}s(w,q&&i!==j?q:null),z+=o,y+=parseFloat(q)}else{if("100%"===q&&k>1||isNaN(parseInt(q,10))){s(w);continue}s(w,q),z++,y+=parseFloat(q)}z!==k||p(d,y)||x||r(d,y,w.children(),c.style.tableLayout),t.prepend(w)}}function x(a){var b,c,d=a.length;if(d)for(b=0;b<d;b++)c=a[b],c.style.height="",c.removeAttribute("height")}function y(a){a.getAttribute("style")&&!e.browser.ie&&a.setAttribute("style",a.getAttribute("style").replace(/\"/gm,"'"))}function z(a,b){var c,d,f,g,h,i,j,k,n,p,q,r=a.length,s="0px none rgb(0, 0, 0)";if(r)for(c=0;c<r;c++){for(f=a[c],g=m(f,"height"),g||1!==f.rowSpan||(g=m(f.parentNode,"height")),i=f.getAttribute("valign"),k=parseInt(f.getAttribute("border"),10)||(b.border?1:null),n=f.getAttribute("bordercolor")||b.bordercolor,h={hasTableBorder:!!b.border,width:(k||"0")+"px",style:"solid",color:n||"grey"},
p=f.getAttribute("background"),g&&(f.style.height=g),i&&!f.style.verticalAlign&&(f.style.verticalAlign=i),j=window.getComputedStyle(f),j.border&&j.border!==s?I.test(j.border)?f.style.border=o(j.border):f.style.border=j.border:j.border===s?f.style.border=h.width+" "+h.style+" "+h.color:(k||n)&&(j.borderLeft||l(f,j,h,"Left",k,n),j.borderTop||l(f,j,h,"Top",k,n),j.borderRight||l(f,j,h,"Right",k,n),j.borderBottom||l(f,j,h,"Bottom",k,n)),p&&!j.backgroundImage&&(f.style.backgroundImage="url("+p+")"),d=0;d<f.classList.length;d++)q=e.getDisplayValueByClass("."+f.classList[d]),q&&(f.style.display=q);f.classList.contains("cui-real-td")&&(f.style.width="",f.removeAttribute("border"),f.removeAttribute("bordercolor"),f.removeAttribute("width"),f.removeAttribute("height"),f.removeAttribute("background"),f.removeAttribute("valign")),f.getAttribute("style")||f.removeAttribute("style"),y(f)}}function A(b){var c,d,e,f=b.length;for(c=0;c<f;c++)d=b[c],e=d.style.width,/[0-9]*\.?[0-9]+%/.test(e)&&(d.style.width=a(d).outerWidth()+"px")}function B(f){var g,h,i,j,k,l,n,o,p,q,r,s,t={},u={},v=a(f),B=a(c,f),C=a(d,f),D=C.length,E=function(a){var b="",c=a.parentNode,d=c.rowIndex,e=a.cellIndex;return d===f.rows.length-1&&(b+="Bottom "),0===d&&(b+="Top "),e===c.cells.length-1&&(b+="Right "),0===e&&(b+="Left "),b=b.substring(0,b.length-1),b&&b.split(" ")};if(f&&(i=v.data("cui-matrix"))){for(f=v[0],p=f.style.width||m(f,"width"),p&&(p=b.toPX(p),p="number"==typeof p?p+="px":p),p&&"0px"!==p&&(f.style.width=p),q=f.style.height||m(f,"height"),q&&(f.style.height=q),u.border=parseInt(f.getAttribute("border"),10),u.bordercolor=f.getAttribute("bordercolor")?f.getAttribute("bordercolor"):f.style.borderColor,t.borderTop=f.style.borderTop,t.borderRight=f.style.borderRight,t.borderBottom=f.style.borderBottom,t.borderLeft=f.style.borderLeft,j=f.getAttribute("background"),j&&!f.style.backgroundImage&&(f.style.backgroundImage='url("'+j+'")'),r=f.getAttribute("cellpadding"),s=/^\d+/.exec(f.style.borderSpacing)||f.getAttribute("cellspacing"),"0"===s||!s&&"separate"!==f.style.borderCollapse?(f.style.borderCollapse="collapse",f.style.borderSpacing=""):s&&(f.style.borderSpacing=s+"px"),w(f,parseFloat(p),i,a("> colgroup > col",f)),z(C,u),x(B),f.style.border="",y(f),f.removeAttribute("border"),f.removeAttribute("bordercolor"),f.removeAttribute("cellpadding"),f.removeAttribute("cellspacing"),f.removeAttribute("width"),f.removeAttribute("height"),f.removeAttribute("background"),g=0;g<D;g++)if(h=C[g],k=E(h))for(o=k.length,l=0;l<o;l++)n="border"+k[l],h.style[n+"Style"]&&"none"!==h.style[n+"Style"]||(h.style[n]=t[n]),y(h);if(r)for(r=parseInt(r,10)+"px",g=0;g<D;g++)h=C[g],h.style.padding||(h.style.paddingLeft||(h.style.paddingLeft=r),h.style.paddingTop||(h.style.paddingTop=r),h.style.paddingRight||(h.style.paddingRight=r),h.style.paddingBottom||(h.style.paddingBottom=r),y(h));e.browser.webkit&&A(a("> colgroup > col",f))}}var C={"border-collapse":"collapse","word-break":"break-all"},D=e.createEmptyLine(!0),E=null,F={width:/[^\-]\;*width\s*\:\s*((?:\d*\.?\d+)(?:\w*))\;*/i,height:/[^\-]\;*height\s*\:\s*((?:\d*\.?\d+)(?:\w*))\;*/i},G=/^\d*\.?\d+(?:pt|in(?:ch)?|cm+)$/i,H=/^\d*\.?\d+$/,I=/(?:pt|in(?:ch)?|cm)/gi;return{getSelected:f,select:g,unselect:h,insert:j,remove:k,enhance:B}}}),d("plugins/table/CellResizing",[],function(){return function(a,c){function d(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=L(b),D=L(a.selectionManager.getClosest(y[0],"table"));a.isSpellcheckMode&&a.isSpellcheckMode()||D.hasClass("cui-div")||(e=y.offset(),f=c?e.top:e.left,g=c?y.outerHeight():y.outerWidth(),h=B.offset(),i=c?h.left:h.top,j=c?h.top:h.left,k=c?B.width():B.height(),l=c?C.scrollLeft():C.scrollTop(),m=c?C.scrollTop():C.scrollLeft(),n=c?F.scrollLeft():F.scrollTop(),o=c?F.scrollTop():F.scrollLeft(),p=A.offset(),q=c?p.left:p.top,r=D.offset(),s=c?r.left:r.top,t=c?D.outerWidth():D.outerHeight(),u=c&&z.height()>B.height()||!c&&z.width()>B.width()?L.ui.getScrollbarWidth():0,v=Math.min(k+(l<q?-q:0)-u,t,s+t-l,k-s+l-u),i-=n,w=Math.max(i,i-l+s),x=j-m-o+f+g-R/2,d=c?y.data("cellTop")+b.rowSpan-1:y.data("cellLeft")+b.colSpan-1,H.removeClass(c?"cui-w-resize":"cui-h-resize").addClass(c?"cui-h-resize":"cui-w-resize").css({width:c?v:R,height:c?R:v,left:c?w:x,top:c?x:w}).attr("data-cui-cell-index",d).data("targetCell",y))}function e(a){var c;!a&&L.isEmptyObject(T)&&L.isEmptyObject(S)||(L(window).off(U),z&&z.off(U),H&&H.length&&(c=H[0],c.style.width="0px",c.style.height="0px",c.removeAttribute("data-cui-cell-index"),H.removeData("targetCell")),A&&A.length&&(c=A[0],A.removeClass("cui-w-resize cui-h-resize"),""===c.getAttribute("class")&&c.removeAttribute("class")),G=b,T={},S={})}function f(a){var b;G||K||(b=a.currentTarget,K=setTimeout(function(){var c=L(b),e=c.offset(),f=c.outerWidth(),g=c.outerHeight(),h=[e.left+f-R,e.top+g-R];a.pageX>h[0]?d(b,!1):a.pageY>h[1]&&d(b,!0),K=null},80))}function g(a){var b;"w"===G?(b=a.pageX-S.x,S.objs.each(function(){var a=this.originWidth+b,c=T.originWidth-b,d=I.minWidth,e=this.originWidth+T.originWidth-d;a<d?(a=d,c=e):T.obj&&c<d&&(c=d,a=e),this.style.width=a+"px",T.obj?T.obj.style.width=c+"px":(c=a===d?T.originWidth-this.originWidth+I.realMinWidth:T.originWidth+b,S.table.style.width=c+"px")})):"h"===G&&(b=a.pageY-S.y,S.objs.each(function(){var a,c=I.minHeight,d=this.originHeight+b;d<c&&(d=c),this.style.height=d+"px",a=d===c?T.originHeight-this.originHeight+I.minHeight:T.originHeight+b,S.table.style.height=a+"px"}))}function h(){k()}function i(a,b){for(var c,d,e=0;a[e];)if(d=a[e][b]){if(c=a[e][b].cell,1===c.colSpan)break;e++}else e++;return L(c).outerWidth()+"px"}function j(b,d,f,g,h){var j,k,l,m,n=h+1,p=[],q=b.data("cui-matrix"),r=function(a){var b,c,d,e=a.length;for(b=0;b<e;b++)c=a[b],d=c.style.width,d&&!/[0-9]*\.?[0-9]+%/.test(d)||(c.style.width=i(q,b))};if(G=d.hasClass("cui-w-resize")?"w":d.hasClass("cui-h-resize")?"h":"all",S.cell=d.data("targetCell")[0],S.x=f,S.y=g,S.table=b[0],c.unselectAll(b),"w"!==G&&o(S.table),"w"===G)j=L(O,b),r(j),S.objs=j.eq(h).each(function(){this.originWidth=parseFloat(this.style.width)}),T.obj=j.eq(n)[0],T.obj?T.originWidth=parseInt(T.obj.style.width,10):T.originWidth=b.width();else{for(G=G||"h",n-=1,m=q[n].length,k=0;k<m;k++)l=q[n][k].cell,l.originHeight=parseFloat(l.style.height||L(l).height()),l.originHeight<I.minHeight&&(l.originHeight=I.minHeight),p.push(l);S.objs=L(p),T.originHeight=b.height()}return S.objs.length?(a.trigger("cellresizestart",{table:S.table,cell:S.cell}),!0):(e(),!1)}function k(){G&&(e(),a.trigger("cellresizestop",{table:S.table,cell:S.cell}))}function l(a){var b={borderWidth:parseFloat(a.css("border-width"))||0,paddingLeft:parseFloat(a.css("padding-left"))||0,paddingRight:parseFloat(a.css("padding-right"))||0,paddingTop:parseFloat(a.css("padding-top"))||0,paddingBottom:parseFloat(a.css("padding-bottom"))||0,minWidth:parseFloat(a.css("min-width"))||t(),minHeight:parseFloat(a.css("min-height"))||t()};return b.spaceWidth=b.paddingLeft+b.paddingRight+b.borderWidth,b.spaceHeight=b.paddingTop+b.paddingBottom+b.borderWidth,b.realMinWidth=b.minWidth+b.spaceWidth,b.realMinHeight=b.minHeight+b.spaceHeight,b}function m(){function b(a){return a-d.left+C.scrollLeft()}function c(a){return a-d.top+C.scrollTop()-A.offset().top+I.spaceHeight/2}var d,i=a.uiManager;z=L(a.getDoc()),A=L(a.getBody()),B=L(i.getEditArea()),C=B.contents(),D=L(i.getContainer()),E=B[0].ownerDocument,F=L(E.defaultView||E.parentWindow),H=L("<div class='cui-resize-cell'></div>").on("mousedown",function(f){var k,m,n,o,p=f.currentTarget,q=L(p),r=q.data("targetCell");if(r){if(K&&(clearTimeout(K),K=null),3===f.which)return e(!0),void(a.browser.ie||setTimeout(function(){a.focus()}));if(k=L(a.selectionManager.getClosest(r[0],"table")),!k.hasClass("cui-div")){if(d=B.offset(),o=parseFloat(q.attr("data-cui-cell-index")),!k.length||isNaN(o))return!1;i.closeContextMenu(),I=l(r),m=b(f.pageX),n=c(f.pageY),j(k,q,m,n,o)&&(A.addClass(q.hasClass("cui-w-resize")?"cui-w-resize":q.hasClass("cui-h-resize")?"cui-h-resize":""),q.css({width:"",height:"",top:0,left:0,bottom:0,right:0}),z.on("mousemove"+U,g).on("mouseup"+U,h),window.addEventListener("mouseup",h),f.stopPropagation(),f.preventDefault())}}}).on("mousemove",function(a){G&&(z.trigger(L.Event(a.type,{pageX:b(a.pageX),pageY:c(a.pageY)})),a.stopPropagation(),a.preventDefault())}).on("mouseup",function(a){z.trigger("mouseup"),k(),a.stopPropagation(),a.preventDefault()}).on("mousewheel dommousescroll",function(){G||(S.objs=null,T.objs=null,e(!0))}).appendTo(D),a.on(["selectionchange","contentchanged","documentchanged","historychanged","tabsbeforeactivate","executionfailed","spellcheckcommand"].join(" "),function(){e(!0)}),A.on("mousedown"+U,N,function(){K&&(clearTimeout(K),K=null)}).on("mousemove"+U,"table > tr > th, table > tr > td, table > thead > tr > th, table > thead > tr > td, table > tbody > tr > th, table > tbody > tr > td, table > tfoot > tr > th, table > tfoot > tr > td",f),L(E).on("mousewheel"+U+" dommousescroll"+U,function(){S.objs=null,T.objs=null,e(!0)})}function n(){H&&(H.off(),H=null),A&&A.off(U),z&&z.off(U),window.removeEventListener("mouseup",h),L(E).off(U),U=null}function o(b){var c,d,e,f,g,h,i,j=[],k=function(a,b){var c=L(a),d=c.data("cellLeft"),e=c.data("cellTop");return b?0===e?0:window.getComputedStyle(i[e-1][d].cell).borderBottomWidth:e===i.length-1?0:window.getComputedStyle(i[e+1][d].cell).borderTopWidth};if(b){for(e=L(P,b),f=e.length,i=L(b).data("cui-matrix"),c=0;c<f;c++)d=e[c],h=window.getComputedStyle(d,null),g=a.browser.webkit?h.getPropertyValue("height"):d.getBoundingClientRect().height-parseFloat(h.paddingTop)-parseFloat(h.paddingBottom)-(parseFloat(h.borderTopWidth)||parseFloat(k(d,!0)))/2-(parseFloat(h.borderBottomWidth)||parseFloat(k(d,!1)))/2+"px",j.push(g);for(c=0;c<f;c++)e[c].style.height=j[c]}}function p(a,b){var c,d,e,f=!1,g=!1;if(!a||a.length<2)return!1;for(f="all"===b||"width"===b,g="all"===b||"height"===b,c=0,d=a.length;c<d;c++)if(e=a[c],f&&e.colSpan>1||g&&e.rowSpan>1)return!1;return!0}function q(b){var c,d,e,f,g,h,i,j=b.length,k=b.eq(0),l=k.outerWidth(!0),m=k.data("cellTop"),n=a.selectionManager.getClosest(k[0],"table");for(c=1;c<j&&(d=b.eq(c),d.data("cellTop")===m);c++)f=d,l+=d.outerWidth(!0);if(!f)return!0;for(h=k.data("cellLeft"),i=f.data("cellLeft"),e=l/(i-h+1),g=L(O,n),c=h;c<=i;c++)g.eq(c).css("width",e+"px");return!0}function r(b){function c(a){return parseFloat(a.style.height)||0}var d,e,f,g,h,i,j,k=b.length,l=b.eq(0),m=c(l[0]),n=l.data("cellLeft"),o=a.selectionManager.getClosest(l[0],"table");for(d=1;d<k;d++)e=b.eq(d),e.data("cellLeft")===n&&(g=e,m+=c(e[0]));if(!g)return!0;for(i=l.data("cellTop"),j=g.data("cellTop"),f=m/(j-i+1),h=L(Q,o),d=i;d<=j;d++)h.eq(d).find("> th, > td").css("height",f+"px");return!0}function s(b){J=Math.max(b,Math.round(1.618*parseFloat(L(a.getBody()).css("fontSize"))))}function t(){return J||s(0),J}function u(a,b){var c,d,e,f=0,g=L(a);if(b)f=L(O,g).length;else for(c=L(Q,g),e=c.length,d=0;d<e;d++)L("> td, > th",c[d]).length&&f++;return f}function v(a,b,c){var d,e,f,g,h,i,j,k=L(a);return c=c||u(a,b),d=L(P,k),e=d.eq(0),f=parseFloat(e.css("borderTopWidth")||0),g=parseFloat(d.last().css("borderBottomWidth")||0),h=parseFloat(e.css("borderBottomWidth")||0),i=parseFloat(e.css("padding"+(b?"Left":"Top"))||0)+parseFloat(e.css("padding"+(b?"Right":"Bottom"))||0),j=parseFloat(e.css("margin"+(b?"Left":"Top"))||0)+parseFloat(e.css("margin"+(b?"Right":"Bottom"))||0),(i+j)*c+h*(c-1)+f+g}function w(a,b){var c,d,e=u(a,b),f=L(a);return f.length?(c=v(a,b,e),d=t(),d*e+c):0}function x(a){return w(a,!0)}function y(a){return w(a,!1)}var z,A,B,C,D,E,F,G,H,I,J,K,L=a.$,M=a.editorManager.editorConstants,N=M.keys(M.LineBlockElements).join(","),O="> colgroup > col",P="> tr > th, > tr > td, > thead > tr > th, > thead > tr > td, > tbody > tr > th, > tbody > tr > td, > tfoot > tr > th, > tfoot > tr > td",Q="> tr, > thead > tr, > tbody > tr, > tfoot > tr",R=6,S={},T={},U="."+a.getUniqueId();return a.on("editorcreate",function(){m()}),{unregister:n,validateResizable:p,makeSameWidth:q,makeSameHeight:r,refreshCellHeight:o,setMinCellSize:s,getMinCellSize:t,getExtraSize:v,getMinTableWidth:x,getMinTableHeight:y}}}),d("plugins/table/SelectableGrid",["jqueryCafe","ui/Core","ui/Widget"],function(a){return a.widget("ui.selectablegrid",{options:{columns:10,rows:10,cellWidth:10,cellHeight:10,cellMargin:1,selecting:null,unselecting:null,change:null,select:null},_create:function(){var a,b,c=this.options,d=c.columns,e=c.rows,f=c.cellMargin,g=c.cellWidth,h=c.cellHeight,i=d*e,j={tag:"ol",attr:{class:["cui-grid"]},contents:[]},k={tag:"label",attr:{class:["cui-guide"]},contents:[]};for(c.disabled&&j.attr.class.push("cui-selectablegrid-disabled"),a=0;a<i;a++)b={tag:"li",attr:{class:["cui-selectee cui-state-default"],style:"min-width:"+g+"px;min-height:"+h+"px;margin: "+f+"px;"},contents:[]},a%d===0&&b.attr.class.push("cui-selectee-first"),j.contents.push(b);this.htmlData={tag:"div",attr:{class:["cui-selectablegrid"]},contents:[j,k]}},_init:function(){this.grid=a("ol",this.element),this.selectees=a("li",this.element),this.guide=a("label",this.element),this._registerData(),this.reset()},_destroy:function(){var a=this;a.grid.off("."+a.getID()),a._unregisterData(),this.grid=null,this.selectees=null,this.guide=null,this.opos=null},_registerData:function(){var b,c,d,e,f=this.selectees,g=f.length;for(b=0;b<g;b++)c=f.eq(b),d=c[0],e=c.offset(),a.data(d,"selectable-item",{element:d,$element:c,left:e.left,top:e.top,right:e.left+c.outerWidth(),bottom:e.top+c.outerHeight(),selecting:!1})},_unregisterData:function(){var b,c,d=this.selectees,e=d.length;for(b=0;b<e;b++)c=d[b],a.removeData(c,"selectable-item")},_mouseMove:function(b){var c,d,e,f,g,h,i,j,k,l,m;if(!this.options.disabled){for(d=this.selectees,i=this.opos[0],j=this.opos[1],k=b.pageX,l=b.pageY,e=d.length,i>k&&(h=k,k=i,i=h),j>l&&(h=l,l=j,j=h),c=0;c<e;c++){if(f=a.data(d[c],"selectable-item"),!f)return;g=!(f.left>k||f.right<i||f.top>l||f.bottom<j),g?f.selecting||(f.$element.addClass("cui-state-highlight"),f.selecting=!0,this._trigger("selecting",b,{selecting:f.element})):f.selecting&&(f.$element.removeClass("cui-state-highlight"),f.selecting=!1,this._trigger("unselecting",b,{unselecting:f.element}))}return m=this._getSelectionInfo(),this._refreshGuide(m),this._trigger("change",b,m),!1}},_mouseUp:function(a){1===a.which&&(this._trigger("select",a,this._getSelectionInfo()),this.reset())},_refreshGuide:function(a){this.guide.text(a.x+" X "+a.y)},_getSelectionInfo:function(){var b,c,d=this.options,e=parseInt(d.columns,10),f=0,g=a(".cui-selectee-first.cui-state-highlight",this.grid).length;for(b=0;b<=e;b++){if(c=a.data(this.selectees[b],"selectable-item"),!c.selecting){f=b;break}b===e&&(f=b)}return{x:f,y:g}},reset:function(b){function c(a){return l._mouseMove(a)}function d(a){return l._mouseUp(a)}var e,f,g,h,i,j,k,l=this,m=0;if(!this.options.disabled){for(e=this.selectees,i=e.eq(0),j=i.offset(),this.opos=[j.left+i.outerWidth()/2,j.top+i.outerHeight()/2],k="."+this.getID(),e.removeClass("cui-state-highlight"),g=this.options.columns,f=0;f<g;f++)m+=e.eq(f).outerWidth();if(this.grid.css("min-width",m),b)this._unregisterData(),this._registerData();else for(g=e.length,f=1;f<g;f++)h=a.data(e[f],"selectable-item"),h.selecting=!1;h=a.data(i[0],"selectable-item"),h.$element.addClass("cui-state-highlight"),h.selecting=!0,this.grid.off(k).on("mousemove"+k,c).on("mouseup"+k,d),this._refreshGuide(this._getSelectionInfo())}}}),a.ui.selectablegrid}),d("plugins/table/Plugin",["utilities/NodeTracker","utilities/UnitConverter","plugins/table/TableDialog","plugins/table/CellControl","plugins/table/TableControl","plugins/table/CellResizing","plugins/table/SelectableGrid"],function(a,c,d,e,f,g){function h(h,H){function I(a,b){var c=h.getToolButton(a);c&&c.option("disabled",b),h.disableMenuItem(a,b)}function J(){var a=0,b=h.getBody().firstChild;h.contentUtils.isEmptyLine(b)&&(a=ya(b).height()),Ia.setMinCellSize(a)}function K(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=ya(a),q=p.length,r=!0,s=!0,t=!0,u=!0,v=!1,w=!1;if(q<=1)return!1;for(e=p.eq(0),f=g=e.data("cellLeft"),k=l=e.data("cellTop"),i=e[0].getAttribute("data-cafe-colspan")||e[0].colSpan,n=e[0].rowSpan,b=1;b<q;b++)d=p.eq(b),c=d[0],h=d.data("cellLeft"),m=d.data("cellTop"),t&&(t=h===f),u&&(u=m===k),v||(v=m-l>n,l=m),w||(w=h-g>i,g=h),r&&(j=c.getAttribute("data-cafe-colspan")||c.colSpan,r=i===j,i=j),s&&(o=c.rowSpan,s=n===o,n=o);return!!(!t&&!u||t&&r&&!v||u&&s&&!w)}function L(){var a,c,d,e,f=0,g=Ga.getSelected(),i=!1,j=!1;if(!_()){g&&(i=!0,e=ya(Ha.getSelected()),f=e.length,Ha.tableStateChange(g));for(a in ub)c=ub[a],d=c.cellLength,c.table&&(j=j||i),d!==b&&(j=!1,/empty/.test(d)&&(j=j||0===f),/single/.test(d)&&(j=j||1===f),/multi/.test(d)&&(j=j||f>1),j=j&&i),c.mergeable&&f>1&&(j=j&&K(e)),"function"==typeof c&&(j=c()),/nesttable|overwritecells/.test(a)&&(j=j&&h.hasTableClipboard),I(a,!j);g&&g.style&&g.style.marginLeft&&!/0$|^0px$|^0%$/.test(g.style.marginLeft)?I("tableoutdent",!1):I("tableoutdent",!0),I("pastetable",i||!h.hasTableClipboard)}}function M(a,b,c,d){"menu"===a?(h.addMenuItem(b,c),h.addContextMenuItem(b,c)):h.addButton(b,c),d&&(ub[b]=d)}function N(a,b,c){var d;return Da.test(a.nodeName)?a:(d=c?ya(a).children(Fa):ya(Fa,a),d[b?"first":"last"]()[0])}function O(a){var b,c,d,e,f=0;if(a){if(d=a.childNodes,e=d.length,!e)return 3===a.nodeType?a.length:0;if(1===e&&/^br$/i.test(d[0].nodeName))return 0;for(b=0;b<e;b++)c=d[b],3===c.nodeType?f+=c.length:/^hr|img$/i.test(c.nodeName)?f++:f+=ya(c).text().length;return f}}function P(a){var b,c,d;if(!a){if(b=pa.getRange(),!b.collapsed||!b.startContainer)return;if(a=pa.getClosest(b.startContainer,Fa),!a)return}c=pa.getClosest(a,"table"),c&&(d=Ga.getSelected(),c!==d&&(Ha.unselectAll(d),Ga.unselect(),Ga.select(c)))}function Q(a,b){var c;a&&(c=O(a),b=c>=b?b:c,pa.setCursorPosition({lineElement:a,col:b}),P(a))}function R(a){var b,c;return(!nb||!sa.hasLockedStyleWithParent(a))&&(b=ya(Ga.getSelected()),c=ya(a),pa.setCursorPosition({node:Ha.getFirstTextNode(a),offset:0}),Ha.select(a),Ha.tableStateChange(b[0]),void X(b,c,c))}function S(a){var b,c,d,e,f,g=pa.getRange(),h=a?g.startContainer:g.endContainer,i=pa.getClosest(h,k);if(!i)return!1;if(b=pa.getClosest(i,"table"),Ha.getSelected()&&Ha.unselectAll(b),d=pa.getClosest(h,Fa),e=ya(d)[a?"prevAll":"nextAll"]("table"),e.length)return c=ya(l,e)[a?"last":"first"]()[0],c&&(d=N(c,!a),Q(d,a?O(d):0)),!0;if(c=Ha.getNeighbor(i,a,b))return d=N(c,!a),Q(d,a?O(d):0),!0;if(i=pa.getClosest(b,k),!i)return!0;if(f=ya(b)[a?"prevAll":"nextAll"](Fa+", table")[0])"TABLE"===f.nodeName?(c=ya(l,f)[a?"last":"first"]()[0],c&&(d=N(c,!a),Q(d,a?O(d):0))):Da.test(f.nodeName)&&Q(f,a?O(f):0);else{if(b=pa.getClosest(i,"table"),c=Ha.getNeighbor(i,a,b),!c)for(;!c&&b;){if(f=ya(b)[a?"prevAll":"nextAll"](Fa+", table")[0],f&&Da.test(f.nodeName)){if(pa.isDummyLine(f))return!0;Q(f,a?O(f):0);break}if(!f)return!0;i=pa.getClosest(b,k),b=pa.getClosest(i,"table"),c=Ha.getNeighbor(i,a,b)}c&&(d=N(c,!a),Q(d,a?O(d):0))}return!0}function T(a,b,c){var d,e,f,g,h,i,j,k,l;if(a&&b&&("TD"===a.nodeName||"TH"===a.nodeName))return c=c||("up"===b||"left"===b?0:9999),d=ya(a),j=d.data("cellLeft"),k=d.data("cellTop"),e=ya(pa.getClosest(a,"table")),l=e.data("cui-matrix"),f=("up"===b||"down"===b)&&b,g=("left"===b||"right"===b)&&b,f?(k+="up"===f?-1:1,!(!l[k]||!l[k][j])&&(!!(i=l[k][j].cell)&&(h=N(i,"down"===f),Q(h,c),!0))):g?(j+="left"===g?-1:1,!(!l[k]||!l[k][j])&&(!!(i=l[k][j].cell)&&(h=N(i,"right"===g),Q(h,c),!0))):void 0}function U(b){var c,d,e,f,g,i,j,l,n,o,p,q=pa.getRange(),r=b?q.startContainer:q.endContainer;if(j=pa.getClosest(r,k),!j)return l=pa.getClosest(r,Fa),!!l&&(b&&l.previousSibling&&"TABLE"===l.previousSibling.nodeName?(o=ya(l.previousSibling).data("cui-matrix"),l=N(o[o.length-1][0].cell,!1),Q(l,O(l)),!0):!(b||!l.nextSibling||"TABLE"!==l.nextSibling.nodeName)&&(o=ya(l.nextSibling).data("cui-matrix"),l=N(o[0][0].cell,!0),Q(l,0),!0));if(h.browser.webkit){if(l=pa.getClosest(r,Fa),n=pa.getCurrentCol(r,b?q.startOffset:q.endOffset,l),r.nodeType===za.NodeTypes.ELEM_NODE?f=b?pa.getLeafNode(r.childNodes[q.startOffset],!0):pa.getLeafNode(r.childNodes[q.endOffset],!1):r.nodeType===za.NodeTypes.TEXT_NODE&&(f=r),l&&(e=new a(f,l)),b){for(;f;)if(f=e.prev(),f&&f.nodeName===za.NodeNames.BR)return!1}else{for(p=0;f;){if(f&&f.nodeName===za.NodeNames.BR&&p++,p>1)return!1;g=f,f=e.next()}if(1===p&&g.nodeName!==za.NodeNames.BR)return!1}if(l&&(d=l[b?"previousSibling":"nextSibling"]),d){if(Da.test(d.nodeName))return!1;if("TABLE"===d.nodeName&&(qa.fillEmptyCellsWithLineInTable(d),r=ya(m,d)[b?"last":"first"]().find("> td, > th").first()[0]))return l=N(r,!b),Q(l,n),!0}if(c=ya(pa.getClosest(j,"table")),i=Ha.getUpOrDownCell(c,j,b))return l=N(i,!b),Q(l,n),!0;for(r=c[0],d=r[b?"previousSibling":"nextSibling"];;){for(;!d;){if(d=r.parentNode,"BODY"===d.nodeName)return!0;if(Ea.test(d.nodeName)&&T(d,b?"up":"down",n))return!0;r=d,d=d[b?"previousSibling":"nextSibling"]}if(pa.isDummyLine(d))return!0;if("TABLE"===d.nodeName){if(qa.fillEmptyCellsWithLineInTable(d),r=ya(m,d)[b?"last":"first"]().find("> td, > th").first()[0]){l=N(r,!b),Q(l,n);break}}else if(Da.test(d.nodeName)){Q(d,n);break}r=d,d=d[b?"previousSibling":"nextSibling"]}return!0}return!1}function V(a){var b,c,d,e,f,g,i,j,l,m=pa.getRange(),n=m.startContainer,o=function(c,d){var e;if(!h.browser.webkit)return!1;if(c=c||pa.getClosest(n,Fa),d=d||pa.getCurrentCol(n,m.startOffset,c),e=ya(c),i=e.prev()[0],j=e.next()[0],a&&i&&"TABLE"===i.nodeName&&0===d){if(b=ya(i.rows[i.rows.length-1]).children().last(),b.length)return c=N(b[0],!1),d=O(c),Q(c,d),!0}else if(!a&&j&&"TABLE"===j.nodeName&&d===O(c)&&(b=ya(j.rows[0]).children().first(),b.length))return c=N(b[0],!0),Q(c,0),!0;return!1};if(m.collapsed){if(d=pa.getClosest(n,k),!d)return o();if(b=ya(d),c=ya(pa.getClosest(d,"table")),e=pa.getClosest(n,Fa),g=pa.getCurrentCol(n,m.startOffset,e),a&&0===g){if(e===N(d,!0))for(;b.length>0&&c.length>0;){if(l=c[0],!b.is(ya(l.rows[0]).children().first()))return b=b.prev().length>0?b.prev():b.parent().prev().children().last(),!(!b.length||!Ea.test(b[0].nodeName))&&(e=N(b[0],!1),g=O(e),Q(e,g),!0);if(f=c.prev()[0],pa.isDummyLine(f))return!0;if(f)return e=N(f,!1),g=O(e),Q(e,g),!0;if(!Ea.test(l.parentNode.nodeName))return!0;if(g=O(e),T(l.parentNode,"left",g))return!0;b=ya(pa.getClosest(l.parentNode,k)),c=ya(pa.getClosest(b[0],"table"))}else if(e&&e.previousSibling&&"TABLE"===e.previousSibling.tagName)return o(e,g)}else if(!a&&g===O(e))if(e===N(d,!1))for(;b.length>0&&c.length>0;){if(l=c[0],!b.is(ya(l.rows[l.rows.length-1]).children().last()))return b=b.next().length>0?b.next():b.parent().next().find(k).first(),!(!b.length||!Ea.test(b[0].nodeName))&&(e=N(b[0],!0),Q(e,0),!0);if(f=c.next()[0])return e=N(f,!0),Q(e,0),!0;if(Ea.test(l.parentNode.nodeName)&&T(l.parentNode,"right",g))return!0;b=ya(pa.getClosest(l.parentNode,k)),c=ya(pa.getClosest(b[0],"table"))}else if(e&&e.nextSibling&&"TABLE"===e.nextSibling.tagName)return o(e,g);return!1}}function W(a){var b,c,d,e,f,g,i,j,l,m=Ga.getSelected(),n=pa.getCursorPosition(),o=n.range;if(!o.collapsed)return i=o.startContainer,j=o.endContainer,void(h.browser.ie&&(1===i.nodeType&&Ea.test(j.nodeName)&&1===j.children.length?(l=pa.getLeafNode(i,!1),pa.setRange(i,0,l,l.textContent.length)):3===i.nodeType&&Ea.test(j.nodeName)&&1===j.children.length&&pa.setRange(i,0,i,i.textContent.length)));if(f=pa.getClosest(o.startContainer,k),f&&f.getAttribute("data-cui-selected")){if(g=ya(Ha.getSelected()),ya("[data-cui-lock]",g).length)return Ha.unselectAll(m),!0;if(nb)for(c=g.length,b=0;b<c;b++)if(sa.hasLockedStyleWithParent(g[b]))return Ha.unselectAll(m),!0;h.execCommand(E,{node:Ha.getFirstTextNode(f)}),g.empty().append(h.createEmptyLine()),pa.setCursorPosition({node:Ha.getFirstTextNode(g.eq(0)),offset:0}),Ha.unselectAll(m)}else{if(d=pa.getClosest(o.startContainer,Fa),!d)return!1;if(nb&&sa.hasLockedStyleWithParent(d))return!1;if(a&&0===o.startOffset&&(e=d.previousSibling),!a&&n.col===O(d)){for(;d&&!d.nextSibling&&"BODY"!==d.nodeName&&(d.nodeName.match(Da)||"UL"===d.nodeName||"OL"===d.nodeName);)d=d.parentNode;e=d?d.nextSibling:null}if(e&&"TABLE"===e.tagName)return pa.selectElement(e),Ha.unselectAll(m),!0}}function X(a,b,c){var d;a&&a.length&&(b||c||(d=ya(Ha.getSelected())),b=b||d.first(),c=c||d.last(),a.data("originCoord",{x:b.data("cellLeft"),y:b.data("cellTop")}).data("targetCoord",{x:c.data("cellLeft"),y:c.data("cellTop")}))}function Y(a,b,c){var d,e,f,g,h,i,j,k,l,m=ya(b),n=m.data("cui-matrix"),o=m.data("originCoord"),p=m.data("targetCoord"),q=function(a,b){return!(b<0||a<0||!n[b]||!n[b][a])};if(!o||!p)return!1;switch(d=n[o.y][o.x].cell,i=c.left,k=c.top,j=c.right,l=c.bottom,a){case Aa.UP:h=(p.y>=o.y&&p.y<=o.y+d.rowSpan-1?o.y:p.y)-1,g=p.x;break;case Aa.DOWN:h=(p.y>=o.y&&p.y<=o.y+d.rowSpan-1?o.y+d.rowSpan-1:p.y)+1,g=p.x;break;case Aa.LEFT:g=(p.x>=o.x&&p.x<=o.x+d.colSpan-1?o.x:p.x)-1,h=p.y;break;case Aa.RIGHT:g=(p.x>=o.x&&p.x<=o.x+d.colSpan-1?o.x+d.colSpan-1:p.x)+1,h=p.y}return q(g,h)?(f=n[h][g].cell,e=Ha.selectRecursivly(f,n,o,b,{left:i,top:k,right:j,bottom:l}),m.data("targetCoord",{x:g,y:h}),e.left===c.left&&e.top===c.top&&e.right===c.right&&e.bottom===c.bottom?Y(a,b,e):(ra.contentChanged(),!0)):(ra.contentChanged(),!0)}function Z(a,b){var c,d,e,f,g,i,j,l,m,n,o,p,q=ya(Ha.getSelected()),r=q.length,s=function(a,b){var c=a.parentNode,d=b?"firstChild":"lastChild";do{if(c[d]!==a)return!1;a=c,c=a.parentNode}while(!Ea.test(a.nodeName));return!0};if(a!==Aa.UP&&a!==Aa.DOWN&&a!==Aa.LEFT&&a!==Aa.RIGHT)return!1;if(r){if(nb&&sa.hasLockedCell(q))return!1;for(g=99999,i=0,j=99999,l=0,c=0;c<r;c++)m=q.eq(c),d=m[0],e=m.data("cellLeft"),f=m.data("cellTop"),g=Math.min(g,e),i=Math.max(i,e+d.colSpan-1),j=Math.min(j,f),l=Math.max(l,f+d.rowSpan-1);return Y(a,b,{left:g,top:j,right:i,bottom:l})}if(n=pa.getRange(),o=n.commonAncestorContainer.nodeName,"TR"!==o)switch(a){case Aa.UP:if(p=pa.getClosest(n.startContainer,Fa),ya(p).prev().length)return!1;break;case Aa.DOWN:if(p=pa.getClosest(n.endContainer,Fa),ya(p).next().length)return!1;break;case Aa.LEFT:if(p=pa.getClosest(n.startContainer,Fa),!(h.contentUtils.isEmptyLine(p)||0===n.startOffset&&s(n.startContainer,!0)))return!1;break;case Aa.RIGHT:if(p=pa.getClosest(n.endContainer,Fa),!(h.contentUtils.isEmptyLine(p)||n.endOffset===(3===n.endContainer.nodeType?ya(n.endContainer).text().length:n.endContainer.childNodes.length)&&s(n.startContainer,!1)))return!1}return d=pa.getClosest(n.startContainer,k),(!nb||!sa.hasLockedStyleWithParent(d))&&(X(ya(b),ya(d),ya(d)),d&&(Ha.select(d),pa.setCursorPosition({node:N(d,!0),offset:0})),!0)}function $(a){var b,c;for(a=a||ya(Ha.getSelected()),c=a.length,b=0;b<c;b++)if(sa.hasLockedStyleWithParent(a[b]))return!0;return!1}function _(){var a,b,c=Ga.getSelected(),d=!1,e=!1;if(!nb||!qa)return!1;if(c&&(d=!0,b=ya(Ha.getSelected()),e=sa.hasLockedStyleWithParent(c)),d&&!e&&(e=b.length?$(b):sa.hasLockedStyleWithParent(qa.getCurrentCell())),e)for(a in ub)I(a,!0);return I("inserttable",e),oa[e?"disable":"enable"](),e}function aa(){var a=h.uiManager.getContext();return"table.single-cell.selected"===a||"table.multi-cell.selected"===a?Ha.getSelected():qa.getCurrentCell()}function ba(){var a=ya(aa());va=pa.getCursorPosition(),a.length&&(xa=ya(Ga.getSelected()),wa=a,xa.length&&!/^table$/.test(xa[0].tagName)||(xa=wa.closest("table"),Ga.select(xa)))}function ca(){wa=null,xa=null,va=null}function da(a){var b=h.browser;!a||!b.ie||b.version>10||(a.oncontrolselect=function(){return!1})}function ea(){var a,b;a=pa.getCurrentNode(),b=pa.getClosest(a,"TABLE"),b?Ga.select(b):Ga.unselect(),L()}function fa(a,c){var d,e,f,g,h,i,j,k,l,m,n=0,o=0,p=0,q=0,r=[];if(c===b){for(o=a.length,n=a[0].length,f=0;f<o;f++){for(h=[],g=0;g<n;g++)a[f][g]&&h.push(a[f][g].cell);h.length&&r.push(h)}return r}for(m=c.length,f=0;f<m;f++)i=c[f],j=i.parentNode.rowIndex,k=i.rowSpan,0===f&&(p=j,q=j+k-1,o+=k),j===p&&(n+=i.colSpan),j>q&&(q=j+k-1,o+=k);for(l=ya(c[0]),d=l.data("cellLeft"),e=l.data("cellTop"),f=0;f<o;f++){for(h=[],g=0;g<n;g++)a[e+f][d+g]&&h.push(a[e+f][d+g].cell);h.length&&r.push(h)}return r}function ga(a,b){var c={color:b["border"+a+"Color"],width:b["border"+a+"Width"],style:b["border"+a+"Style"]};return c}function ha(a){function d(a){switch(a){case"solid":return 0;case"dotted":return 1;case"dashed":return 2;case"none":case"hidden":return 3}return 0}var e,f,g,h=!1,i=!1,j=!1;for(e in a)g=a[e],"number"!=typeof g&&(f===b?f={color:g.color,style:g.style,width:g.width}:(f.color!==g.color&&(h=!0),f.style!==g.style&&(i=!0),f.width!==g.width&&(j=!0)),(g.colorUnMatched||g.widthUnMatched||g.styleUnMatched)&&(g.color=null,g.width=null,g.style=null));h?a.color=null:a.color="transparent"===tb.toName(f.color)?"transparent":tb.toHEX(f.color),a.width=j?null:c.toPX(f.width),a.style=i?null:d(f.style);for(e in a)a[e]&&(g=a[e],g.colorUnMatched&&delete g.colorUnMatched,g.widthUnMatched&&delete g.widthUnMatched,g.styleUnMatched&&delete g.styleUnMatched);return a}function ia(a,c){return a===b?a=c:(a.color!==c.color&&(a.color="",a.colorUnMatched=!0),a.style!==c.style&&(a.style="",a.styleUnMatched=!0),a.width!==c.width&&(a.width="",a.widthUnMatched=!0),a)}function ja(a,b,c){var d,e,f=function(a){switch(a){case"hidden":return 0;case"double":return 1;case"solid":return 2;case"dashed":return 3;case"dotted":return 4;case"ridge":return 5;case"outset":return 6;case"groove":return 7;case"inset":return 8;case"none":return 9;default:return 10}};return d=f(a.style),e=f(b.style),d<e?a:d>e?b:a.width>b.width?a:a.width<b.width?b:"Top"===c||"Right"===c?a:b}function ka(a,b,c){var d,e,f,g,h,i=Ga.getSelected(),j=ya(i).data("cui-matrix"),k=b.rowSpan,l=b.colSpan;switch(d=ya(b),e=d.data("cellLeft"),f=d.data("cellTop"),a){case"Left":0===e?h=ga("Left",c):(g=j[f][e-1].cell,h=ja(ga("Left",c),ga("Right",window.getComputedStyle(g)),"Left"));break;case"Right":e+l>=j[0].length?h=ga("Right",c):(g=j[f][e+l].cell,h=ja(ga("Right",c),ga("Left",window.getComputedStyle(g)),"Right"));break;case"Top":0===f?h=ga("Top",c):(g=j[f-1][e].cell,h=ja(ga("Top",c),ga("Bottom",window.getComputedStyle(g)),"Top"));break;case"Bottom":f+k>=j.length?h=ga("Bottom",c):(g=j[f+k][e].cell,h=ja(ga("Bottom",c),ga("Top",window.getComputedStyle(g)),"Bottom"))}return h}function la(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=a[0].length,r=a.length;for(d=0;d<r;d++)for(c=0;c<q;c++)if(e=a[d][c])if(f=e.rowSpan,g=e.colSpan,h=window.getComputedStyle(e),1===f&&1===g)1===q?(k=ia(k,ka("Left",e,h)),l=ia(l,ka("Right",e,h))):0===c?(k=ia(k,ka("Left",e,h)),p=ia(p,ka("Right",e,h))):c===q-1?(l=ia(l,ka("Right",e,h)),p=ia(p,ka("Left",e,h))):(p=ia(p,ka("Left",e,h)),p=ia(p,ka("Right",e,h))),1===r?(m=ia(m,ka("Top",e,h)),n=ia(n,ka("Bottom",e,h))):0===d?(m=ia(m,ka("Top",e,h)),o=ia(o,ka("Bottom",e,h))):d===r-1?(n=ia(n,ka("Bottom",e,h)),o=ia(o,ka("Top",e,h))):(o=ia(o,ka("Top",e,h)),o=ia(o,ka("Bottom",e,h)));else for(j=0;j<f;j++)for(i=0;i<g;i++)j||i?a[d+j]&&a[d+j][c+i]&&(a[d+j][c+i]=null):(1===q?(k=ia(k,ka("Left",e,h)),l=ia(l,ka("Right",e,h))):(0===c?k=ia(k,ka("Left",e,h)):p=ia(p,ka("Left",e,h)),c+g===q?l=ia(l,ka("Right",e,h)):p=ia(p,ka("Right",e,h))),1===r?(m=ia(m,ka("Top",e,h)),n=ia(n,ka("Bottom",e,h))):(0===d?m=ia(m,ka("Top",e,h)):o=ia(o,ka("Top",e,h)),d+f===r?n=ia(n,ka("Bottom",e,h)):o=ia(o,ka("Bottom",e,h))));return{left:k,right:l,top:m,bottom:n,mid:o||n,center:p||l,rows:1===r||o===b?1:2,columns:1===q||p===b?1:2}}function ma(a,b){var c,d,e={},f=fa(a,b);return b&&1===b.length?(d=b[0],c=window.getComputedStyle(d),e={top:ka("Top",d,c),bottom:ka("Bottom",d,c),left:ka("Left",d,c),right:ka("Right",d,c),mid:ka("Bottom",d,c),center:ka("Right",d,c)},e=ha(e),e.columns=e.rows=1):(e=la(f),e=ha(e)),e}function na(){var a,b,c,d,e,f=pa.getRange(),g=f.startContainer;if(!f.collapsed||f.startOffset>1)return!1;if(1===f.startOffset&&g.nodeType===za.NodeTypes.TEXT_NODE&&g.parentNode.innerText!==za.UNICODE_CHAR_CODE.ZERO_WIDTH_SPACE)return!1;if(a=pa.getClosest(g,k),!a)return!1;for(e=g;e&&e!==a;){if(e.previousSibling)return!1;e=e.parentNode}return b=pa.getClosest(a,"tr"),!(a.previousSibling||!b||b.previousSibling)&&(c=pa.getClosest(b,"table"),
!(!c||c.previousSibling&&za.LineBlockElements[c.previousSibling.nodeName])&&(d=h.createEmptyLine(),c.parentNode.insertBefore(d,c),pa.setRange(c.previousSibling,0,c.previousSibling,0),!0))}var oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya=h.$,za=h.editorManager.editorConstants,Aa=ya.ui.keyCode,Ba=za.keys(za.LineBlockElements),Ca=za.CommandTypes.CUSTOM_COMMAND_RANGE,Da=new RegExp("^"+Ba.join("|")+"$","i"),Ea=/^(td|th)$/i,Fa=Ba.join(","),Ga=f(h),Ha=e(h),Ia=g(h,Ha),Ja=h.getText("table"),Ka=h.getText("table.menu.inserttable"),La=h.getText("table.menu.deletetable"),Ma=h.getText("table.menu.selecttable"),Na=h.getText("table.menu.tableproperties"),Oa=h.getText("table.menu.tableselection"),Pa=h.getText("table.menu.tableselection.cell"),Qa=h.getText("table.menu.tableselection.row"),Ra=h.getText("table.menu.tableselection.column"),Sa=h.getText("table.menu.insertcell"),Ta=h.getText("table.menu.insertcell.insertrowabove"),Ua=h.getText("table.menu.insertcell.insertrowbelow"),Va=h.getText("table.menu.insertcell.insertcolumnleft"),Wa=h.getText("table.menu.insertcell.insertcolumnright"),Xa=h.getText("table.menu.deletecells"),Ya=h.getText("table.menu.deletecells.deletecolumn"),Za=h.getText("table.menu.deletecells.deleterow"),$a=h.getText("table.menu.splitcell"),_a=h.getText("table.menu.mergecells"),ab=h.getText("table.label.rowcount"),bb=h.getText("table.label.columncount"),cb=h.getText("table.menu.cellsize"),db=h.getText("table.menu.cellsize.makesamewidth"),eb=h.getText("table.menu.cellsize.makesameheight"),fb=h.getText("table.menu.cellsize.makesame"),gb=h.getText("table.dialog.alert.resize"),hb=h.getText("table.menu.cellproperties"),ib=h.getText("table.menu.tableindent"),jb=h.getText("table.menu.tableoutdent"),kb=h.getText("table.label.minium")+": ",lb=h.getText("ok"),mb=h.getText("cancel"),nb=!1,ob=h.browser,pb=ob.ie&&ob.version<=10,qb={},rb={},sb={},tb=h.colorUtils,ub={},vb=parseInt(za.INDENT_MARGIN,10);return this.resizing=!1,oa=ya.ui.selectablegrid({select:function(a,b){qa.deselectItem(),va=pa.getCursorPosition(),h.execCommand(q,b),va=null}}),qb={beforeOpen:ba,close:ca,open:function(a){var b=a.getWidget("rowCountInput"),c=a.getWidget("columnCountInput"),d=a.getWidget("borderStyleSelectMenu"),e=a.getWidget("borderColorInput"),f=a.getWidget("borderWidthInput"),g=a.getWidget("widthInput"),h=a.getWidget("heightInput"),i=a.getWidget("minWidthLabel"),j=a.getWidget("minHeightLabel"),k=a.getWidget("backgroundColorInput"),l=a.getWidget("borderPreview"),m={color:"#000000",style:"solid",width:"1px"},n=5,o=2,p=Ia.getMinCellSize(),q=Ia.getMinCellSize(),r=function(a){var b=g.value();""!==b&&b<a&&g.value(a),g.option("min",a),i.option("label",'<span style="color: gray">'+kb+a+"px</span>")},s=function(a){var b=h.value();""!==b&&b<a&&h.value(a),h.option("min",a),j.option("label",'<span style="color: gray">'+kb+a+"px</span>")};a.toggleTableSizeColumns(!0),a.toggleAreaSizeColumns(!0),a.toggleMinSizeColumns(!1),a.toggleAlignColumns(!1),a.option("title",Ka),b.option("max",30),b.value(n+""),b.enable(),b.element.on("textboxchange",function(a,b){var c=parseInt(b.value,10),d=l.option("borders"),e=parseFloat(d.top.width),f=parseFloat(d.bottom.width),g=parseFloat(d.middle.width);s(q*c+g*(c-1)+e+f)}),c.option("max",30),c.value(o+""),c.enable(),c.element.on("textboxchange",function(a,b){var c=parseInt(b.value,10),d=l.option("borders"),e=parseFloat(d.left.width),f=parseFloat(d.right.width),g=parseFloat(d.center.width);r(p*c+g*(c-1)+e+f)}),r(p*o+o+1),s(q*n+n+1),k.setColor("transparent"),d.index(0),e.setColor("000000"),f.value("1"),l.option({base:{top:m,middle:m,bottom:m,left:m,center:m,right:m},columns:2,rows:2})},ok:function(a,b){h.execCommand(q,b)}},rb={beforeOpen:ba,close:ca,open:function(a){var b,c,d,e,f,g,h,i=xa,j=a.getWidget("rowCountInput"),k=a.getWidget("columnCountInput"),l=a.getWidget("widthInput"),n=a.getWidget("heightInput"),o=a.getWidget("minWidthLabel"),p=a.getWidget("minHeightLabel"),q=a.getWidget("borderStyleSelectMenu"),r=a.getWidget("borderPreview"),s=a.getWidget("borderColorInput"),t=a.getWidget("borderWidthInput"),u=a.getWidget("backgroundColorInput"),v=function(a,b){return Math.round(parseFloat(window.getComputedStyle(a,null).getPropertyValue(b)))},w=function(a){var b,c,d;for(b=0,c=a.length,d=0;b<c;b++)a[b].children.length&&d++;return d},x=function(a){var b,c,d,e,f=a[0].length,g=a.length,h=new Array(f);for(c=0;c<g;c++)for(b=0,f=a[0].length;b<f;b++)e=a[c][b],!h[b]&&e&&e.left===b&&(h[b]=!0);for(b=0,d=0;b<f;b++)h[b]&&d++;return d};i&&i.length&&(h=i.data("cui-matrix"),c=ma(h),a.toggleTableSizeColumns(!0),a.toggleAreaSizeColumns(!0),a.toggleMinSizeColumns(!1),a.toggleAlignColumns(!1),b=a.validateColor(i.css("background-color")).replace("#",""),e=v(i[0],"width"),d=v(i[0],"height"),f=parseFloat(i[0].style.width||0),g=parseFloat(i[0].style.height||0),Math.abs(f-e)>Ia.getMinCellSize()&&(f=e,i[0].style.width=f+"px"),Math.abs(g-d)>Ia.getMinCellSize()&&(g=d,i[0].style.height=g+"px"),ua={width:f,height:g,minWidth:Ia.getMinTableWidth(i),minHeight:Ia.getMinTableHeight(i)},a.option("title",Na),j.option("max",999),j.value(w(ya(m,i))),k.option("max",999),k.value(x(h)),l.option("min",ua.minWidth),n.option("min",ua.minHeight),l.value(ua.width),n.value(ua.height),o.option("label",'<span style="color: gray">'+kb+ua.minWidth+"px</span>"),p.option("label",'<span style="color: gray">'+kb+ua.minHeight+"px</span>"),u.setColor(b),null===c.style?q.index(0):q.index(c.style),c.color?s.setColor(c.color):s.setColor("rgb(0, 0, 0)"),null===c.width?t.value(1):t.value(c.width),r.option({base:{top:c.top,middle:c.mid,bottom:c.bottom,left:c.left,center:c.center,right:c.right},columns:c.columns,rows:c.rows}))},ok:function(a,b){h.execCommand(C,{dialog:a,info:b})}},sb={beforeOpen:ba,close:ca,open:function(a){var c,d,e,f,g=wa,h=xa,i=a.getWidget("horizontalAlignSelectMenu"),j=a.getWidget("verticalAlignSelectMenu"),k=a.getWidget("borderStyleSelectMenu"),l=a.getWidget("borderPreview"),m=a.getWidget("borderColorInput"),n=a.getWidget("borderWidthInput"),o=a.getWidget("backgroundColorInput"),q=o.element,r=function(c){var d,e,f,g=c.length;for(d=0;d<g;d++)if(e=c[d].style.backgroundColor||"transparent",f!==b){if(f!==e)return p}else f=e;return a.validateColor(e).replace("#","")},s=function(a,c){var d,e,f,g=c?"text-align":"vertical-align",h=a.length;for(d=0;d<h;d++)if(e=a[d].style[g],f!==b){if(f!==e)return""}else f=e;return e};g.length&&(f=ma(h.data("cui-matrix"),g),a.toggleTableSizeColumns(!1),a.toggleAreaSizeColumns(!1),a.toggleMinSizeColumns(!1),a.toggleAlignColumns(!0),d=s(g,!0),i.index(a.getIndexByAlign(d,!0)),e=s(g,!1),j.index(a.getIndexByAlign(e,!1)),a.option("title",hb),c=r(g),c!==p?o.setColor(c):q.attr(p,!0).on("colorinputchange."+p,function(){q.removeAttr(p),q.off("."+p)}),null===f.style?k.index(0):k.index(f.style),f.color?m.setColor(f.color):m.setColor("rgb(0, 0, 0)"),null===f.width?n.value(1):n.value(f.width),l.option({base:{top:f.top,middle:f.mid,bottom:f.bottom,left:f.left,center:f.center,right:f.right},columns:f.columns,rows:f.rows}))},ok:function(a,b){h.execCommand(D,{dialog:a,info:b})}},M("menu","selectablegrid",{text:oa.getHTMLData(),unselectable:!0}),M("menu","inserttable",{icon:"insert-table",text:Ka,click:function(){qa.deselectItem(),ta.setCallback(qb),h.dialog(j)}}),M("menu","cellproperties",{icon:"cell-properties",text:hb+"...",disabled:!0,context:"table",click:function(){ta.setCallback(sb),h.dialog(j)}},{table:!0}),M("menu","deletetable",{icon:"delete-table",disabled:!0,context:"table",text:La,click:function(){h.execCommand(r)}},{table:!0}),M("menu","selecttable",{icon:"select-table",disabled:!0,text:Ma,context:"table.empty-cell.selected",click:function(){var a=ya(qa.getCurrentCell()).closest("table");Ha.selectAll(a),X(a),L(),ra.contentChanged()}},{table:!0,cellLength:"empty"}),M("menu","tableproperties",{icon:"table-properties",disabled:!0,text:Na+"...",context:"table",click:function(){ta.setCallback(rb),h.dialog(j)}},{table:!0,cellLength:"empty single multi"}),M("menu","tableselection",{disabled:!0,context:"table.empty-cell.selected",text:Oa,menuItems:["tableselectioncell","tableselectionrow","tableselectioncolumn"]},{table:!0,cellLength:"empty"}),M("menu","tableselectioncell",{icon:"select-cell",text:Pa,click:function(){var a=ya(qa.getCurrentCell()),b=a.closest("table");Ha.select(qa.getCurrentCell()),X(b,a,a),L(),ra.contentChanged()}}),M("menu","tableselectionrow",{icon:"select-row",text:Qa,click:function(){var a=ya(qa.getCurrentCell()),b=a.closest("table");Ha.selectRow(a),X(b),L(),ra.contentChanged()}}),M("menu","tableselectioncolumn",{icon:"select-column",text:Ra,click:function(){var a=ya(qa.getCurrentCell()),b=a.closest("table");Ha.selectColumn(a),X(b),L(),ra.contentChanged()}}),M("menu","insertcell",{disabled:!0,text:Sa,context:"table.empty-cell.selected table.single-cell.selected table.multi-cell.selected",menuItems:["insertrowabove","insertrowbelow","insertcolumnleft","insertcolumnright"]},{table:!0,cellLength:"empty"}),M("menu","insertrowabove",{icon:"insert-row-up",text:Ta,click:function(){h.execCommand(s,{cell:qa.getCurrentCell(),direction:"up"})}}),M("menu","insertrowbelow",{icon:"insert-row-down",text:Ua,click:function(){h.execCommand(s,{cell:qa.getCurrentCell(),direction:"down"})}}),M("menu","insertcolumnleft",{icon:"insert-column-left",text:Va,click:function(){h.execCommand(t,{cell:qa.getCurrentCell(),direction:"left"})}}),M("menu","insertcolumnright",{icon:"insert-column-right",text:Wa,click:function(){h.execCommand(t,{cell:qa.getCurrentCell(),direction:"right"})}}),M("menu","deletecells",{disabled:!0,text:Xa,context:"table",menuItems:["deleterow","deletecolumn"]},{table:!0}),M("menu","deleterow",{icon:"delete-row",text:Za,click:function(){var a=ya(Ha.getSelected());a.length||(a=qa.getCurrentCell()),h.execCommand(u,{cells:a})}}),M("menu","deletecolumn",{icon:"delete-column",text:Ya,click:function(){var a=ya(Ha.getSelected());a.length||(a=qa.getCurrentCell()),h.execCommand(v,{cells:a})}}),M("button",i,{widgetType:"selectmenu",label:Ja,icons:{primary:"insert-table"},fixedLabel:!0,iconOnly:!0,tooltip:Ja,menuItems:["selectablegrid","inserttable"],autoCloseViaScroll:!1,open:function(){oa&&oa.reset(!0)},close:function(){oa&&oa.reset(!0)}}),M("menu","splitcell",{disabled:!0,icon:"split-cells",context:"table.empty-cell.selected table.single-cell.selected",text:$a,click:function(){var a=ya(aa())[0];a.colSpan>1||a.rowSpan>1||a.getAttribute("data-cafe-colspan")>1?h.execCommand(w,{table:Ga.getSelected(),cell:a}):h.dialog(o)}},{table:!0,cellLength:"empty single"}),M("menu","mergecells",{disabled:!0,icon:"merge-cells",context:"table.multi-cell.selected",text:_a,click:function(){var a=Ga.getSelected();h.execCommand(y,{table:a,cells:ya(Ha.getSelected())})}},{table:!0,cellLength:"multi",mergeable:!0}),M("menu","makeSameWidth",{disabled:!0,icon:"make-same-width",context:"table.multi-cell.selected",text:db,click:function(){var a=ya(Ha.getSelected());return Ia.validateResizable(a,"width")?(h.execCommand(z,{cells:a}),void Ha.scanTable(Ga.getSelected())):void h.alert(gb)}},{table:!0,cellLength:"multi"}),M("menu","makeSameHeight",{disabled:!0,icon:"make-same-height",context:"table.multi-cell.selected",text:eb,click:function(){var a=ya(Ha.getSelected());return Ia.validateResizable(a,"height")?(h.execCommand(A,{cells:a}),void Ha.scanTable(Ga.getSelected())):void h.alert(gb)}},{table:!0,cellLength:"multi"}),M("menu","makeSame",{disabled:!0,icon:"make-same-width-height",context:"table.multi-cell.selected",text:fb,click:function(){var a=ya(Ha.getSelected());return Ia.validateResizable(a,"all")?(h.execCommand(B,{cells:a}),void Ha.scanTable(Ga.getSelected())):void h.alert(gb)}},{table:!0,cellLength:"multi"}),M("menu","cellsize",{disabled:!0,context:"table.multi-cell.selected",text:cb,menuItems:["makeSameWidth","makeSameHeight","makeSame"]},{table:!0,cellLength:"multi"}),M("menu","tableindent",{disabled:!0,icon:"table-indent",context:"table",text:ib,click:function(){h.execCommand(F)}},{table:!0}),M("menu","tableoutdent",{disabled:!0,icon:"table-outdent",context:"table",text:jb,click:function(){h.execCommand(G)}},{table:!0}),ta=d(h,j,H),h.addDialog(o,{title:$a,modal:!0,resizable:!1,width:200,items:[{type:"columns",items:[{type:"textbox",name:"rowCountInput",label:ab,options:{type:"integer",min:1,max:30,maxlength:2}}]},{type:"columns",items:[{type:"textbox",name:"columnCountInput",label:bb,options:{type:"integer",min:1,max:30,maxlength:2}}]}],buttons:[{text:lb,click:function(){var a,b,c,d,e=this,f=this.getWidget("rowCountInput"),g=this.getWidget("columnCountInput");h.focus(),a=f.value(),b=g.value(),c=Ga.getSelected(),d=wa,h.execCommand(x,{table:c,cell:d,rows:a,columns:b}),e.close()}},{text:mb,click:function(){this.close()}}],beforeOpen:ba,close:ca,open:function(a,b){function c(){var a=parseInt(this.value,10),b=1,c=17;return isNaN(a)?void(this.value=""):void(this.value=Math.min(Math.max(a,b),c))}var d=b.dialog,e=d.getWidget("rowCountInput"),f=d.getWidget("columnCountInput");e.value("2"),f.value("1"),b.element.on("keyup."+o,"input[role=textbox]",c)},beforeClose:function(a,b){var c=b.dialog,d=c.getWidget("rowCountInput"),e=c.getWidget("columnCountInput");d.value(""),e.value(""),b.element.off("keyup."+o)}}),h.one("uicreate",function(){oa.init()}),h.one("editorinitialized",function(){var a=ya(h.getDoc());pa=h.selectionManager,qa=h.pluginUtils,ra=h.selectionChange,sa=h.lockUtils,nb=!!h.editorManager.pluginManager.get("lock"),qa.getSelectedCells=Ha.getSelected,qa.unselectCells=Ha.unselect,qa.unselectTable=Ga.unselect,J(),pa.getDefaultFilter(!0).addFilter(function(a,b){var c,d,e,f,g;if("public"===b){for(d=a.find(k),e=d.length,f=a.find("col"),g=f.length;e--;)c=d[e],c.getAttribute("data-cafe-colspan")&&c.removeAttribute("data-cafe-colspan");for(;g--;)c=f[g],c.getAttribute("data-cafe-span")&&c.removeAttribute("data-cafe-span")}}),pa.addSetFilter("trimRowspan",null,function(a){var b,c,d,e,f,g,h,i,j,k=a[0].getElementsByTagName("table"),l=k.length;for(d=0;d<l;d++)if(b=k[d],c=pa.getClosest(b.parentNode,"table"),!c)for(g=b.querySelectorAll("[rowspan]"),h=g.length,e=0;e<h;e++)i=g[e],b=pa.getClosest(i,"table"),f=b.rows.length,j=f-i.parentNode.rowIndex,j<i.rowSpan&&(i.rowSpan=j),1===i.rowSpan&&i.removeAttribute("rowspan")}),pa.addSetFilter("removeEmptyTr",null,function(a){var b,c,d,e,f=a[0].getElementsByTagName("table"),g=f.length;for(d=0;d<g;d++)if(b=f[d],e=b.querySelectorAll(k),0!==e.length&&(c=b.rows,c.length))for(;c.length>0&&0===c[0].children.length;)b.deleteRow(0)}),a.on("mousedown","table",function(b){var c,d,e,f,g=ya(b.target),i=b.currentTarget,j="table[data-cui-selected] td, table[data-cui-selected] th";return h.isSpellcheckMode&&h.isSpellcheckMode()||g.hasClass("cui-resizable-handle")||g.hasClass("cui-wrapper")||"IMG"===b.target.nodeName?void(Ha.getSelected()&&Ha.unselectAll(i)):(b.target.nodeName===h.constants.NodeNames.IMG&&h.pluginUtils.isItemWrapper(b.target)||!h.pluginUtils.getSelectedItem()||h.pluginUtils.deselectItem(),b.stopPropagation(),d=pa.getClosest(b.target,k),c=ya(d),3===b.which?void(Ga.getSelected()!==i?(Ha.unselectAll(Ga.getSelected()),Ga.unselect(),Ga.select(i)):c.attr("data-cui-selected")||Ha.unselectAll(i)):(Ha.unselectAll(Ga.getSelected()),Ga.getSelected()!==i&&Ga.select(i),b.shiftKey||(f=pa.getLeafNode(b.target,!0),pa.setRange(f,0,f,0,!0),ra.refreshLastRange(),ra.contentChanged()),d?(e=!0,void a.on("mousemove.cui-table",function(a){return e&&!ya.contains(i,a.target)&&(Ha.dynamicSelect({table:Ga.getSelected(),startCell:d}),e=!1,a.preventDefault(),a.stopPropagation()),e}).on("mousemove.cui-table",j,function(a){var b=ya(a.currentTarget);!b.is(c)&&ya.contains(i,b[0])&&(e?(Ha.dynamicSelect({table:Ga.getSelected(),startCell:d}),e=!1):pa.setRange(d,0,d,0),a.preventDefault(),a.stopPropagation())}).on("mouseup.cui-table",j,function(a){var b=ya(a.currentTarget);b.is(c)?Ha.unselectAll(i):pa.setRange(d,0,d,0)}).on("mouseup.cui-table",function(){L(),a.off(".cui-table")})):void b.preventDefault()))}).on("mouseup","table",function(){var a,b,c=pa.getRange();c.collapsed||(a=pa.getClosest(c.startContainer,"table"),b=pa.getClosest(c.endContainer,"table"),a&&!b?pa.getSel().collapseToStart():!a&&b&&pa.getSel().collapseToEnd())}).on("dblclick",k,function(a){var b=pa.getRange(),c=b.endContainer,d=ra.getSelectedTextNodes(b),e=a.currentTarget;(Ea.test(c.nodeName)||!d.length||1===d.length&&3===d[0].nodeType&&""===d[0].textContent||pa.getClosest(c,k)!==e)&&(R(e),a.stopPropagation())}).on("keydown",function(a){var b,c,d,e,f,g,i,j,l,m=a.keyCode;if(!a.shiftKey||m!==Aa.UP&&m!==Aa.DOWN&&m!==Aa.LEFT&&m!==Aa.RIGHT){if(h.browser.webkit&&!(a.altKey||a.shiftKey||a.metaKey||a.ctrlKey)&&(e=pa.getRange(),f=e.commonAncestorContainer,c=pa.getClosest(e.startContainer,k),c&&c.parentNode&&ya(c.parentNode).index(f)!==-1))return a.keyCode!==Aa.DELETE&&a.keyCode!==Aa.BACKSPACE||(g=e.startContainer,g.parentNode.removeChild(g),g=e.startContainer,Ea.test(g.nodeName)&&0===g.childNodes.length?g.appendChild(h.createEmptyLine(!1)):za.LineBlockElements[g.nodeName]&&0===g.childNodes.length&&g.previousSibling&&g.parentNode.removeChild(g)),pa.setCursorPosition({node:e.startContainer,offset:e.startOffset}),!1}else{if(e=pa.getRange(),m===Aa.UP||m===Aa.LEFT){if(b=pa.getClosest(e.startContainer,Fa),!b)return;if(c=b.previousSibling,m===Aa.UP&&c&&"TABLE"===c.nodeName||m===Aa.LEFT&&c&&"TABLE"===c.nodeName&&(0===e.startOffset||h.contentUtils.isEmptyLine(b)))return d=ya(c).data("cui-matrix"),b=N(d[d.length-1][0].cell,!1),Q(b,O(b)),!1;if(b=pa.getClosest(e.endContainer,Fa),m===Aa.UP&&b&&b.previousSibling||m===Aa.LEFT&&b&&b.previousSibling&&(0===e.startOffset||h.contentUtils.isEmptyLine(b)))c=b.previousSibling;else if(1===e.endContainer.nodeType){if(i=e.endContainer.childNodes,!i.length)return;c=i[e.endOffset-1]}else c=null;if(!c||"TABLE"!==c.nodeName||!c.previousSibling){if(Ga.getSelected())return;return c=pa.getClosest(b,"table"),void(c&&(Ha.unselectAll(Ga.getSelected()),Ga.unselect(),Ga.select(c)))}return Da.test(c.previousSibling.nodeName)?(b=c.previousSibling,j=h.contentUtils.isEmptyLine(b)?b:b.childNodes[b.childNodes.length-1],l=h.contentUtils.isEmptyLine(b)?0:3===j.nodeType?ya(j).text().length:1):(j=c.parentNode,l=ya.inArray(c,c.parentNode.childNodes)),pa.setRange(e.startContainer,e.startOffset,j,l),!1}if((m===Aa.DOWN||m===Aa.RIGHT)&&(b=pa.getClosest(e.endContainer,Fa),c=b?b.nextSibling:e.endContainer.childNodes[e.endOffset],m===Aa.DOWN&&c&&"TABLE"===c.nodeName||m===Aa.RIGHT&&c&&"TABLE"===c.nodeName&&(e.endOffset===O(b)||h.contentUtils.isEmptyLine(b))))return pa.setRange(e.startContainer,e.startOffset,c.parentNode,ya.inArray(c,c.parentNode.childNodes)+1),!1}}).on("mousedown",function(a){var b,c,d,e,f,g,i,j,l,m,n,o=5,p=h.getDoc(),q=h.getBody();if(ob.webkit){if("HTML"!==a.target.nodeName&&a.target!==q)return;if(b=pa.getRangeFromEvent(a),!b)return;if(b.collapsed&&b.commonAncestorContainer===q&&b.startContainer===q){if(c=b.startContainer.childNodes[b.startOffset],!c)return;if("TABLE"===c.nodeName?(d=ya(c),e=!1):c.previousSibling&&"TABLE"===c.previousSibling.nodeName&&(d=ya(c.previousSibling),e=!0),!d)return;f=a.pageX,g=a.pageY,f>=d.offset().left&&f<d.offset().left+d.outerWidth()?(g=d.offset().top+o,f=f<=d.offset().left+o?d.offset().left+o:f>=d.offset().left+d.outerWidth()-o?d.offset().left+d.outerWidth()-o:f,e=!1):g>=d.offset().top&&g<d.offset().top+d.outerHeight()?(f=e?d.offset().left+d.outerWidth()-o:d.offset().left+o,g=g<=d.offset().top+o?d.offset().top+o:g>=d.offset().top+d.outerHeight()-o?d.offset().top+d.outerHeight()-o:g):d[0].parentNode===q&&g<d.offset().top&&(g=d.offset().top+o,f<=d.offset().left?f=d.offset().left+o:f>=d.offset().left+d.outerWidth()&&(f=d.offset().left+d.outerWidth()-o)),i=ya(p.elementFromPoint(f-q.scrollLeft,g-q.scrollTop)).closest(k),i.length&&(a.preventDefault(),a.stopImmediatePropagation(),h.isFocused()||h.focus(),j=N(i,!e),l=e?O(j):0,pa.setCursorPosition({lineElement:j,col:l}))}}else if(ob.ie){if("HTML"!==a.target.nodeName&&a.target!==q)return;if(b=pa.getRangeFromEvent(a),!b||!b.collapsed||b.startContainer!==b.endContainer)return;if(j=pa.getClosest(b.startContainer,Fa),!j)return;if(d=ya(pa.getClosest(j,"table")),!d.length)return;if(f=a.pageX,g=a.pageY,e=a.pageX>=d.offset().left,m=p.documentElement&&p.documentElement.scrollTop||q.scrollTop,n=p.documentElement&&p.documentElement.scrollLeft||q.scrollLeft,f>=d.offset().left&&f<d.offset().left+d.outerWidth()){if(g>=d.offset().top+d.outerHeight())return;g=d.offset().top+o,f=f<=d.offset().left+o?d.offset().left+o:f>=d.offset().left+d.outerWidth()-o?d.offset().left+d.outerWidth()-o:f,e=!1}else g>=d.offset().top&&g<d.offset().top+d.outerHeight()?(f=e?d.offset().left+d.outerWidth()-o:d.offset().left+o,g=g<=d.offset().top+o?d.offset().top+o:g>=d.offset().top+d.outerHeight()-o?d.offset().top+d.outerHeight()-o:g):d[0].parentNode===q&&g<=d.offset().top&&(g=d.offset().top+o,f<=d.offset().left?f=d.offset().left+o:f>=d.offset().left+d.outerWidth()&&(f=d.offset().left+d.outerWidth()-o),e=!1);i=ya(p.elementFromPoint(f-n,g-m)).closest(k),i.length&&(a.preventDefault(),a.stopImmediatePropagation(),j=N(i,!e),l=e?O(j):0,pa.setCursorPosition({lineElement:j,col:l}))}}),ob.ie&&a.on("keydown keyup",function(a){var b,c,d,e=a.keyCode;if(a.shiftKey&&e===Aa.END){if(b=pa.getRange(),c=pa.getClosest(b.startContainer,Fa),!c)return;if(d=pa.getClosest(c,l))return!1}}).on("keyup",function(a){var b=a.keyCode;b!==Aa.UP&&b!==Aa.DOWN&&b!==Aa.LEFT&&b!==Aa.RIGHT||P()}),ya(h.getBody()).on("keydown.cui-table",function(a){var b,c,d=Ga.getSelected(),e=a.keyCode,f=h.getBody(),g=function(a,b){a.preventDefault(),b?a.stopImmediatePropagation():a.stopPropagation()};if(!a.ctrlKey&&(e>47&&e<58||32===e||13===e||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223||229===e))return Aa.ENTER===e&&na()?void a.preventDefault():void(d&&(Ha.unselectAll(d),h.selectionChange.refreshLastRange(),h.selectionChange.contentChanged()));if(Aa.TAB===e)return void(S(a.shiftKey)&&a.preventDefault());if(ob.safari)if(Aa.UP===e){if(pa.isFirstLeafNodeInSafari())g(a);else if(a.metaKey){if(d)return void g(a);b=pa.getRange(),c=h.contentUtils.isLineNode(f.children[1])?f.children[1]:ya(Fa,f.children[1])[0].firstChild,b.setStart(c,0),a.shiftKey||b.setEnd(c,0),pa.setSingleRange(b),g(a)}}else if(Aa.DOWN===e&&d&&a.metaKey)return void g(a);return a.shiftKey?void(d&&Z(e,d)&&(L(),a.preventDefault())):(Aa.UP!==e&&Aa.DOWN!==e||U(Aa.UP===e)&&a.preventDefault(),Aa.LEFT!==e&&Aa.RIGHT!==e||V(Aa.LEFT===e)&&a.preventDefault(),Aa.BACKSPACE!==e&&Aa.DELETE!==e||W(Aa.BACKSPACE===e)&&g(a,!0),void(d&&Ha.unselectAll(d)))}).on("contextmenu.cui-table","table",function(a){var b,c,d,e;if(nb&&(e=ya(Ha.getSelected()),e.length&&$(e))){for(d=h.uiManager.getWidget(/\w+_contextmenu/),c=d.length,b=0;b<c;b++)d[b].close();return a.preventDefault(),a.stopImmediatePropagation(),!1}})}),h.on("selectionchange",function(a,b){var c,d,e,f,g,h=Ga.getSelected(),i=null;if(!qa.isCharKeyCode(b.keyCode)){for(g=b.node,e=b.parents,d=e.length,c=0;c<d;c++)if(f=e[c],/table/i.test(f.tagName)){Ga.getSelected()||Ga.select(f),i=f;break}i&&h===i||(Ha.unselectAll(h),Ga.unselect()),i&&h!==i&&Ga.select(i),L()}}),h.on("historychanged executionfailed",function(){var a,b,c,d=ya("table",h.getDoc()),e=d.length;for(Ha.unselectAll(Ga.getSelected()),Ga.unselect(),a=0;a<e;a++)b=d.eq(a),c=b[0],ya("> tr > th[data-cui-selected], > tr > td[data-cui-selected], > thead > tr > th[data-cui-selected], > thead > tr > td[data-cui-selected], > tbody > tr > th[data-cui-selected], > tbody > tr > td[data-cui-selected], > tfoot > tr > th[data-cui-selected], > tfoot > tr > td[data-cui-selected]",c).removeAttr("data-cui-selected"),Ha.scanTable(c),da(c),b.attr("data-cui-selected")&&Ga.select(c);L()}),h.on("editorupdated contentchanged htmlpasted inserthtmlatcursorcommand",function(){var a,b=h.uiManager,c=b.getCurrentTabName(),d=function(b){var c,d=b.length;for(a=0;a<d;a++)c=b[a],ya(c).data("cui-matrix")||(Ha.scanTable(c),Ga.enhance(c),da(c))};"preview"===c&&d(ya("table",b.getWidget("panel_preview").element[0].contentDocument.body)),d(ya("table",h.getBody()))}),h.on(["emoticonbeforecommand","edit.imagebeforecommand","edit.mediabeforecommand","inserthtmlatcursorbeforecommand","table.mergecellsbeforecommand"].join(" "),function(){var a=pa.getRange(),b=a.commonAncestorContainer,c=pa.getClosest(b,"table");c&&Ia.refreshCellHeight(c)}),h.on("tabsbeforeactivate",function(a,b){var c;"edit"===b.oldPanelName&&(c=Ga.getSelected(),c&&(Ha.unselectAll(c),Ga.unselect(c),h.on("tabsactivate.cui-table",function(a,b){"edit"===b.newPanelName&&(ya(h.getBody()).find(c).length&&Ga.select(c),h.off("tabsactivate.cui-table"))})))}),h.on("cellresizestop",function(){h.trigger("documentchanged")}),h.on("spellcheckcommand",function(){var a=Ga.getSelected();Ha.unselectAll(a),Ga.unselect(a)}),h.addCommand({command:q,type:Ca,action:function(a,b){var c,d,e,f=b.borders||{top:{width:"1px"},middle:{width:"1px"},bottom:{width:"1px"},left:{width:"1px"},center:{width:"1px"},right:{width:"1px"}},g=b.x,i=b.y,j=Ia.getMinCellSize(),l=ya.extend(!0,{},va);return Ha.unselectAll(),Ga.unselect(),c=j*g+parseFloat(f.center.width)*(g-1)+parseFloat(f.left.width)+parseFloat(f.right.width),d=j*i+parseFloat(f.middle.width)*(i-1)+parseFloat(f.top.width)+parseFloat(f.bottom.width),h.focus(),pa.setCursorPosition(l),l=pa.getCursorPosition(),b.width?b.width=Math.max(c,b.width):(e=ya(h.getDoc()).height()<=ya(h.uiManager.getEditArea()).height()?ya.ui.getScrollbarWidth():0,b.width=Math.max(c,ya(l.lineElement).innerWidth()-e)),b.height?b.height=Math.max(d,b.height):b.height=d,h.one("tableinsert",function(a,b){var c=b.table;Ha.scanTable(c),da(c),l.node=Ha.getFirstTextNode(ya(k,c).eq(0)),l.offset=0,pa.setCursorPosition(l),Ga.select(c),ra.refreshLastRange(),ra.contentChanged()}),Ga.insert(b)}}),h.addCommand({command:r,type:Ca,action:function(){return Ha.unselectAll(Ga.getSelected()),Ga.remove(),ea(),!0}}),h.addCommand({command:s,type:Ca,action:function(a,b){return Ha.insertRow(b.cell,b.direction)}}),h.addCommand({command:t,type:Ca,action:function(a,b){var c,d=Ha.insertColumn(b.cell,b.direction);return pb&&d&&(c=ya(b.cell).closest("table").css("visibility","hidden"),setTimeout(function(){c.css("visibility","")})),d}}),h.addCommand({command:u,type:Ca,action:function(a,b){var c,d,e,f,g,i,j,k,l,n,o,p,q,r,s,t,u,v,w,x,y,z=ya(b.cells),A=h.createEmptyLine(!0),B=pa.getClosest(z[0],"table"),C=Ha.getDeletableRow(z);if(!C)return!1;if(v=C.cells,w=C.rows,y=C.splits,x=C.focusIndex,nb&&$(v))return!1;for(ya(B).data("cui-matrix")||Ha.scanTable(B),B.style.height="",k=ya(m,B),c=0,d=y.length;c<d;c++){for(f=ya(B).data("cui-matrix"),j=ya(y[c].cell),o=j[0].rowSpan,q=j.data("cellLeft"),r=j.data("cellTop"),j.css("height","").addClass(y[c].uniqueClass).removeAttr("rowspan"),e=1;e<o;e++){for(t=q-1,u=r+e;t>=0&&(p=f[u][t].cell,ya(p).data("cellTop")!==u);)t--;n=j.clone().html(A),p&&t>=0?ya(p).after(n):k.eq(u).prepend(n)}Ha.scanTable(B)}for(c=w.length-1;c>=0;c--)ya(w[c]).remove();for(Ha.scanTable(B),c=0,d=y.length;c<d;c++)s=y[c].uniqueClass,l=ya("."+s,B),l.length&&(g=Ha.merge(B,l),g&&(ya(g).removeClass(s),""===g.getAttribute("class")&&g.removeAttribute("class")));return x>=0&&(Ha.scanTable(B),f=ya(B).data("cui-matrix"),i=f[x]&&f[x][0]&&f[x][0].cell?f[x][0].cell:f[0]&&f[0][0]&&f[0][0].cell?f[0][0].cell:null,i&&pa.setCursorPosition({node:Ha.getFirstTextNode(i),offset:0})),B.style.height=C.height+"px",Ia.refreshCellHeight(B),B=Ha.cleaning(B),Ha.unselectAll(B),ea(),h.trigger("rowdelete",{table:B}),Ha.scanTable(B),!0}}),h.addCommand({command:v,type:Ca,action:function(a,b){var c,d,e,f,g,i,j=ya(b.cells),k=pa.getClosest(j[0],"table"),l=Ha.getDeletableColumn(j);if(!l)return!1;if(e=l.cells,f=l.cols,i=l.reduces,g=l.focus,nb&&$(e))return!1;for(g&&pa.setCursorPosition({node:Ha.getFirstTextNode(g),offset:0}),c=f.length-1;c>=0;c--)ya(f[c]).remove();for(c=e.length-1;c>=0;c--)ya(e[c]).remove();for(c=0,d=i.length;c<d;c++)i[c].cell.colSpan=i[c].colSpan;return k.style.width=l.width+"px",k=Ha.cleaning(k),Ha.unselectAll(k),ea(),h.trigger("columndelete",{table:k}),Ha.scanTable(k),!0}}),h.addCommand({command:w,type:Ca,action:function(a,b){return!!Ha.splitMerged(b.table,b.cell)&&(L(),!0)}}),h.addCommand({command:y,type:Ca,action:function(a,b){var c=Ha.merge(b.table,b.cells);return!!c&&(pa.setCursorPosition({node:Ha.getFirstTextNode(c),offset:0}),L(),!0)}}),h.addCommand({command:z,type:Ca,action:function(a,b){return Ia.makeSameWidth(b.cells)}}),h.addCommand({command:A,type:Ca,action:function(a,b){return Ia.makeSameHeight(b.cells)}}),h.addCommand({command:B,type:Ca,action:function(a,b){var c=b.cells;return Ia.makeSameWidth(c)&&Ia.makeSameHeight(c)}}),h.addCommand({command:x,type:Ca,action:function(a,b){return!!Ha.split(b.table,b.cell,b.rows,b.columns)&&(L(),!0)}}),h.addCommand({command:C,type:Ca,action:function(a,b){var c=b.dialog,d=b.info,e=xa,f=ya(l,e),g=c.getWidget("backgroundColorInput"),h=function(a){var b,c,g,h,i=function(a,b,c){var d,e=a.length,f=[];for(d=0;d<e;d++)f.push(Math.round(a.eq(d)[b]()*c));return f},j=function(a,b,c){var d,e=a.length;for(d=0;d<e;d++)a.eq(d)[b](c[d])};a=a.toLowerCase(),b="min"+a.charAt(0).toUpperCase()+a.slice(1),d[a]===ua[a]&&d[a]>=ua[b]||(c="width"===a?ya(n,e):f,g=d[a]>ua[b]?d[a]:ua[b],h=i(c,a,g/ua[a]),e.css(a,g),j(c,a,h))};return!!e.length&&(Ha.changeBorder(e[0],f,d.borders),ua.minWidth=Ia.getMinTableWidth(e),ua.minHeight=Ia.getMinTableHeight(e),h("width"),h("height"),e.css({"background-color":c.validateColor(g.getColor())}),!0)}}),h.addCommand({command:D,type:Ca,action:function(a,b){var c=b.dialog,d=b.info,e=wa,f=xa,g=c.getWidget("backgroundColorInput"),h=g.element,i=d.horizontalAlign,j=d.verticalAlign;return!(!e||!e.length)&&(h.off("."+p),h.attr(p)?h.removeAttr(p):e.css("background-color",c.validateColor(g.getColor())),i&&e.css("text-align",d.horizontalAlign),j&&e.css("vertical-align",d.verticalAlign),Ha.changeBorder(f[0],e,d.borders),!0)}}),h.addCommand({command:E,type:Ca,action:function(a,b){return pa.setCursorPosition({node:b.node,offset:0}),!0}}),h.addCommand({command:F,type:za.CommandTypes.CUSTOM_COMMAND,action:function(){var a=ya(Ga.getSelected()),b=parseInt(a.css("margin-left"),10)+vb;return a.css("margin-left",b),b!==vb&&0!==b||L(),!0}}),h.addCommand({command:G,type:za.CommandTypes.CUSTOM_COMMAND,action:function(){var a=ya(Ga.getSelected()),b=a.css("margin-left");return parseInt(b,10)<=vb?(a.css("margin-left",""),L()):a.css("margin-left","-="+vb),!0}}),h.addFinalTask(function(){var a,b,c=h.getBody(),d=ya("table",c),e=Ga.getSelected(),f=d.length;for(Ia.unregister(),e&&(Ha.unselect(Ga.getSelected()),Ga.unselect()),a=0;a<f;a++)b=d[a],Ha.clearTable(b),ya(b).removeData();ya(c).off(".cui-table"),oa&&(oa.destroy(),oa=null),qb=null,rb=null,sb=null,ub=null,pa=null,qa=null,ra=null,sa=null,ta=null,ua=null,va=null,wa=null,xa=null,Ga=null,Ha=null,Ia=null,ya=null,za=null,Aa=null,Ba=null,Ca=null,Da=null,Ea=null,Fa=null,Ja=null,Ka=null,La=null,Ma=null,Na=null,Oa=null,Pa=null,Qa=null,Ra=null,Sa=null,Ta=null,Ua=null,Va=null,Wa=null,Xa=null,Ya=null,Za=null,$a=null,_a=null,ab=null,bb=null,cb=null,db=null,eb=null,fb=null,gb=null,hb=null,ib=null,jb=null,kb=null,lb=null,mb=null,nb=null,ob=null,pb=null,tb=null,vb=null}),{cellControl:Ha,tableControl:Ga,addUI:M,changeUIState:L,disableResizeControlInOldIE:da}}var i="table",j="table.dialog",k="td, th",l="> tr > th, > tr > td, > thead > tr > th, > thead > tr > td, > tbody > tr > th, > tbody > tr > td, > tfoot > tr > th, > tfoot > tr > td",m="> tr, > thead > tr, > tbody > tr, > tfoot > tr",n="> colgroup > col",o="splitcell.table.dialog",p="data-several-color",q=i+".insertTable",r=i+".removeTable",s=i+".insertRow",t=i+".insertColumn",u=i+".deleteRow",v=i+".deleteColumn",w=i+".splitMerged",x=i+".splitCell",y=i+".mergeCells",z=i+".makeSameWidth",A=i+".makeSameHeight",B=i+".makeSame",C=i+".tableProperties",D=i+".cellProperties",E=i+".setCursorInCell",F=i+".indentTable",G=i+".outdentTable";cafe.pluginManager.add("table",["colorpicker"],h)}),a.Cafe&&!a.Cafe.getModules&&(a.Cafe.getModules=function(){return e})}(this);