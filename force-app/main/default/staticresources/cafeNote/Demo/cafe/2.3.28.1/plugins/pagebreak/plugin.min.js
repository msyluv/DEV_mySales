/*! cafe note v2.3.28.1 | Copyright 2014, S-Core, Inc. All Right Reserved. */
cafe.pluginManager.add("pagebreak",[],function(a){function b(){var b=a.getDoc().createElement("span");return b.style.border="1px dotted",b.style.height="2px",b.style.width="99%",b.style.display="block",b.style.position="relative",b.style.top="50%",b.style.transform="translateY(-50%)",b.style.pageBreakBefore="always",b.setAttribute("unselectable","on"),b.setAttribute("data-cui-pagebreak",!0),b.setAttribute("data-cafe-filter","pagebreak"),b.contentEditable=!1,b.tabIndex="-1",b.innerHTML="&#65279;",b}function c(a){o(a).append("<br>").append(b())}function d(){var b,d,e,f,g,h=a.contentUtils,i=a.selectionManager,j=a.pluginUtils;return a.isFocused()&&a.focus(),a.pluginUtils.unselectAllTable(),b=i.getRange(),f=j.getSelectedItem(),b.collapsed||(f?(j.deselectItem(),o(f).remove()):a.getDoc().execCommand("Delete",!1,null),b=i.getRange()),h.splitLineByRange(b,function(a,b){d=a,e=b}),d&&(h.isEmptyLine(d)&&(g=d.lastChild,g&&o(g).remove()),c(d)),e&&i.setRange(e,0,e,0),!0}function e(b){var c,d;b&&(c=b.nextSibling,c&&(a.contentUtils.isEmptyLine(c)&&o(c).remove(),b.lastChild&&"BR"===b.lastChild.nodeName&&(d=b.childNodes.length-1,a.selectionManager.setRange(b,d,b,d))))}function f(a){return!(!a||"SPAN"!==a.nodeName||!a.getAttribute("data-cui-pagebreak"))}function g(b,c){var d,g,h;if(3===b.nodeType&&a.zwsUtils.isZeroWidthSpaceChar(b.nodeValue)&&(b=b.parentNode),"P"===b.nodeName&&c===o.ui.keyCode.BACKSPACE&&(b=b.lastChild),d=o(b),f(b))return c===o.ui.keyCode.BACKSPACE&&(h=b.previousSibling,h&&"BR"===h.nodeName&&o(h).remove()),g=b.parentNode,d.remove(),e(g),!0}function h(b){var c;a.browser.ie&&b.which&&(c=a.selectionManager.getRange(),c&&c.collapsed&&c.startContainer&&f(c.startContainer.parentNode)&&b.preventDefault())}function i(b){var c,d=a.selectionManager;!a.browser.ie||b.keyCode!==o.ui.keyCode.BACKSPACE&&b.keyCode!==o.ui.keyCode.DELETE||(c=d.getRange(),c.collapsed&&g(c.startContainer,b.keyCode)&&a.trigger("documentchanged"))}function j(b){var c,d,e;if(b.table&&"TABLE"===b.table.nodeName)return void a.disableMenuItem(m,!0);for(e=b.parents,d=e.length,c=0;c<d;c++)if("TD"===e[c].nodeName||"TR"===e[c].nodeName||"TABLE"===e[c].nodeName)return void a.disableMenuItem(m,!0);a.disableMenuItem(m,!1)}function k(a,b){var c;c=o(a).find("span[data-cui-pagebreak]"),c.each(function(){"codeview"===q&&o(this).attr("data-cafe-filter",null),"public"!==b&&"preview"!==q||o(this).css("visibility","hidden")})}function l(a,b){var c;"public"===b&&(c=o(a).find("span[data-cui-pagebreak]"),c.each(function(){o(this).css("visibility","")}))}var m="pagebreak",n="page-break",o=a.$,p=a.getText(m),q="edit";a.on("tabsbeforeactivate",function(a,b){q=b.newPanelName}),a.one("editorcreate",function(){a.selectionManager.addGetFilter("pagebreak",null,k),a.selectionManager.addSetFilter("pagebreak",null,l),o(a.getBody()).on("keyup.cafe",i).on("keypress.cafe",h)}),a.on("selectionchange",function(b,c){a.pluginUtils.isCharKeyCode(c.keyCode)||j(c)}),a.on("tableinsert",function(a,b){j(b)}),a.addButton(m,{label:p,icons:{primary:n},iconOnly:!0,click:function(){a.pluginUtils.deselectItem(),a.execCommand(m)}}),a.addMenuItem(m,{icon:n,text:p,click:function(){a.pluginUtils.deselectItem(),a.execCommand(m)}}),a.addCommand({command:m,type:cafe.editorConstants.CommandTypes.CUSTOM_COMMAND_BLOCK,tag:"p",action:d}),a.addFinalTask(function(){m=null,n=null,o=null,p=null,q=null})});