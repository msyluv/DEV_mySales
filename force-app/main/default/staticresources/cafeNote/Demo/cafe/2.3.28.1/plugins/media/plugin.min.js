/*! cafe note v2.3.28.1 | Copyright 2014, S-Core, Inc. All Right Reserved. */
cafe.pluginManager.add("media",[],function(a){function b(){return a.getDialog(Da)}function c(){return b().getWidget("inputTypeUrlRadio")}function d(){return b().getWidget("inputTypeEmbedRadio")}function e(){return b().getWidget("URLInput")}function f(){return b().getWidget("embedLabel")}function g(){return b().getWidget("embedTextArea")}function h(){return b().getWidget("URLInputs")}function i(){return b().getWidget("widthInput")}function j(){return b().getWidget("heightInput")}function k(){return b().getWidget("constrainButton")}function l(){return b().getWidget("mediaTypeSelectMenu")}function m(){return b().getWidget("mediaTypeSelectMenus")}function n(){return d().isChecked()?Xa:c().isChecked()?Wa:void 0}function o(){var a=l().index();return n()===Xa?"embed":a>-1?Ya[a].text:void 0}function p(a){return"video"===a?0:"audio"===a?1:void 0}function q(){return k().isChecked()}function r(){return i().value()}function s(){return j().value()}function t(){return g().value()}function u(){return e().value()}function v(){return n()===Xa?t():u()}function w(a,b){return b?a.replace(/&quot;/g,'"'):a.replace(/"/g,"&quot;")}function x(a,b){return a&&a.toLowerCase().lastIndexOf("."+b)===a.length-b.length-1}function y(a){var b,c,d;for(c=Za.length,b=0;b<c;b++)if(d=Za[b],x(a,d))return d;return null}function z(){ba(Wa)}function A(){ba(Xa)}function B(){var a={};a.width=Ua,a.height=Va,E(a),C(a)}function C(a){ta(b().element).data("mediaSize",a)}function D(){return ta(b().element).data("mediaSize")}function E(a){pa=a.width,qa=a.height,i().element.val(a.width),j().element.val(a.height)}function F(){var a,b=r(),c=q(),d=D();c&&b&&parseInt(b,10)!==pa&&0!==d.width&&0!==d.height&&(a=parseInt(b*d.height/d.width,10),pa=parseInt(b,10),qa=a,j().element.val(a))}function G(){var a,b=s(),c=q(),d=D();c&&b&&parseInt(b,10)!==qa&&0!==d.width&&0!==d.height&&(a=parseInt(b*d.width/d.height,10),pa=a,qa=parseInt(b,10),i().element.val(a))}function H(){D()||(B(),k().option("checked",!0))}function I(){var a=D();a&&!D().height&&C({width:r(),height:s()}),G()}function J(){var a=D();a&&!a.width&&C({width:r(),height:s()}),F()}function K(a,b){b.checked&&H()}function L(){var d,f,h,m,n,o=a.pluginUtils,q=b(),r=e(),s=g(),t=i(),u=j(),v=l(),x=k(),y=c(),z=o.getSelectedItem("media");z?(d=ta(z),n=d.attr("data-cui-media-youtubeurl"),f=n||d.attr("data-cui-media-source"),h=d.attr("data-cui-media-type"),f&&"undefined"!==f&&("embed"===h?(n?(m=ta(w(d.attr("data-cui-media-source"),!0)),r.value(f)):m=ta(w(f,!0)),m.attr("width",d.width()),m.attr("height",d.height()),s.value(m[0].outerHTML)):r.value(f)),t.value(d.width()),u.value(d.height()),x.option("checked",!0),q.option("title",Fa),v.index(p(d.attr("data-cui-media-type")))):C(null),wa&&(y.option("checked",!0),r.element.on("change",H),t.element.on("keyup",J),u.element.on("keyup",I),s.element.css("width","100%"),ba(Wa),v.index(0),wa=!1)}function M(){e().value(""),g().value(""),i().value(""),j().value(""),k().option("checked",!1),b().option("title",Ea),a.pluginUtils.setItemButtonState(),a.pluginUtils.deselectItem()}function N(){X(v(),o(),!1)&&(a.execCommand("media.checkLock"),oa||a.execCommand("edit.media",{selectedImg:a.pluginUtils.getSelectedItem("media")}),this.close())}function O(){var b=a.pluginUtils,c=b.getSelectedItem("image");c&&b.deselectItem(),a.dialog(Da)}function P(b){ra=document.activeElement,a.one("alertclose",function(){a.blur(),ra.focus(),ra=null}),a.alert(b)}function Q(a){return/^(?:http|https):\/\/[^\/]/i.test(a)}function R(a,b,c){var d=y(a);if(!Q(a)||!d)return P(Oa),!1;if("video"===b){if("mp4"===d||"webm"===d||"ogg"===d)return!0}else if("audio"===b&&("mp3"===d||"wav"===d||"ogg"===d))return!0;return c||P(Qa),!1}function S(a,b){var c,d,e,f=b.length;for(c=0;c<f;c++)if(d=b[c].toLowerCase(),e=new RegExp("<"+d,"gi"),e.test(a))return d;return!1}function T(a,b){var c,d,e,f=/\{0\}/;return c=ta.parseHTML(a),d=c[0],1===c.length&&d?sa&&sa.length>0&&(e=S(a,sa))?(b||P(Ra.replace(f,e)),!1):!!$a[d.nodeName]||(b||P(Pa),!1):(b||P(Pa),!1)}function U(a){return a.replace(/youtu.be/i,"www.youtube.com/embed").replace("watch?v=","embed/")}function V(a){var b=/^(?:http|https):\/\/youtu.be/i,c=/^(?:http|https):\/\/www.youtube.com/i;return b.test(a)||c.test(a)}function W(a,b,c){var d='<iframe allowfullscreen src="'+a+'" height="'+c+'" width="'+b+'" ></iframe>';return d}function X(a,b,c){if(V(a))return!0;if("embed"===b){if(a)return T(a,c);c||P(Pa)}else{if(a)return R(a,b,c);c||P(Oa)}return!1}function Y(b,c,d,e){return!!X(b,c,!0)&&(a.execCommand("media.checkLock"),oa?void 0:a.execCommand("edit.media",{url:b,mediaType:c,width:d,height:e,selectedImg:a.pluginUtils.getSelectedItem("media")}))}function Z(a,b){return b.url?$(b.url,b.mediaType,b.width,b.height,b.selectedImg):$(v(),o(),r(),s(),b.selectedImg)}function $(a,b,c,d,e){var f,g="";return V(a)&&(g=a,a=W(U(a),c,d),b="embed"),"embed"===b&&a&&(f=ta(a),c=f.attr("width"),d=f.attr("height"),a=w(a,!1)),c=c||Ua,d=d||Va,aa(a,b,c,d,e,g),!0}function _(b){var c=a.selectionManager.getRange();return b&&(a.pluginUtils.unselectAllTable(),a.contentUtils.insertElementByRange(b,c)),!0}function aa(b,c,d,e,f,g){var h,i,j,k=a.pluginUtils,l=k.getSelectedItem("media")||f;return k.deselectItem(),l?h=l:(h=a.getDoc().createElement("IMG"),_(h)),i=ta(h),da(i,b,d,e,c,g),j=i.closest("div"),l&&j&&j.hasClass("cui-wrapper")&&(j.css("width",d),j.css("height",e)),i[0]}function ba(a){var c=b().getWidget("sizeInputs"),d=k();a===Wa?(c.element.show(),d.element.show(),f().element.hide(),g().element.hide(),h().element.show(),m().element.show()):(c.element.hide(),d.element.hide(),f().element.show(),g().element.show(),h().element.hide(),m().element.hide())}function ca(a,b,c,d){var e,f;return a?(c=c||Ua,d=d||Va,"embed"===b?(a=w(a,!0),f=ta(a),f.attr("width",c),f.attr("height",d),f):(e=ta("<"+b+">"),e.attr("width",c),e.attr("height",d),e.attr("src",a),e.attr("controls","controls"),e)):null}function da(a,b,c,d,e,f){var g={src:xa,unselectable:"on","data-cui-media":!0,"data-cui-media-source":b,"data-cui-media-type":e};f&&(g["data-cui-media-youtubeurl"]=f),a&&a.attr(g).css("width",c).css("height",d)}function ea(a){var b,c,d;if(a)for(c=a.length,b=0;b<c;b++)if(d=a[b].getAttribute("src"))return d;return null}function fa(a,b){a&&b&&a.attr("data-cui-lock",b.attr("data-cui-lock"))}function ga(b){var c,d,e,f,g,h=a.getDoc().createElement("IMG");return c=ta(h),g=b[0].nodeName,"IFRAME"===g||"EMBED"===g||"OBJECT"===g?(f="embed",d=b[0].outerHTML,d=w(d,!1)):"VIDEO"!==g&&"AUDIO"!==g||(f=g.toLowerCase(),d=b.attr("src"),d||(e=b.find("source"),d=ea(e))),da(c,d,b.attr("width")||Ua,b.attr("height")||Va,f),c}function ha(b){var c,d,e=b.attributes,f=a.selectionManager.getDefaultRuleSet().getAttributeRule("object");for(c=e.length-1;c>=0;c--)d=e[c].name,f[d]||e.removeNamedItem(d)}function ia(b,c){var d,e,f=b.attributes,g=a.constants,h=a.configs.invalid_attributes||g.InvalidAttributes,i=g.toMap(h);for(d=f.length-1;d>=0;d--)e=f[d].name.toUpperCase(),i[e]&&(b.removeAttribute(e),c.hasInvalid=!0)}function ja(b,c,d){var e,f,g,h,i,j;for(j=a.getDoc().createElement("IMG"),j.setAttribute("src",xa),g=ta(b).find("video, audio, iframe, embed, object"),f=g.length,e=0;e<f;e++)h=ta(g[e]),a.configs.enable_object_contents||"OBJECT"!==g[e].nodeName||ha(g[e]),ia(h[0],d),i=ga(h),i&&(fa(i,h),h.replaceWith(i));ta(j).remove()}function ka(a){var b,c,d,e,f;for(f=ta(a).find("img[data-cui-media]"),c=f.length,b=0;b<c;b++)d=ta(f[b]),e=ca(d.attr("data-cui-media-source"),d.attr("data-cui-media-type"),d.css("width"),d.css("height")),e&&(fa(e,d),d.replaceWith(e))}function la(a){oa=a}function ma(a,b){var c,d,e,f,g=a.nodeName,h=b.createNode("IMG"),i=g.toLowerCase();return i=/^(?:IFRAME|EMBED|OBJECT)$/i.test(g)?"embed":i.toLowerCase(),"embed"===i?(c=a.toString(),c&&c.indexOf('"')!==-1&&(c=c.replace(/\"/gi,"&quot;"))):(f=a.getAttribute("src"),f||(f=a.getNodesByTagName("source"),c=ea(f))),h.attr("data-cui-media-source",c),h.attr("src",xa),h.attr("data-cui-media-type",i),h.attr("data-cui-media","true"),d=a.attr("width")||"480px",e=a.attr("height")||"300px",h.attr("style","width: "+d+"; height: "+e+";"),h}function na(a,b){for(var c,d,e=a.length;e--;)c=a[e],d=ma(c,b),c.replace(d)}var oa,pa,qa,ra,sa,ta=a.$,ua=a.editorManager,va="media",wa=!0,xa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAEsCAYAAAAb/mBaAAAABHNCSVQICAgIfAhkiAAABc9JREFUeJzt3DFOW2kYQFFAqRBFSuicHaSkoBlWMBUFXVhJdpANuLCo6GYJIYJ+GjdUiTsaSy6e66QJErLIjIaJfHnJOd17+i193dVvf/LubDb7ugMAbNVePQAA/I4EGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQeFUPAPyz29vbZ33u5OTkJ08C/ExuwDAC0+l0dz6fX//bufl8fj2dTne3MBLwP7kBwwgcHx9/nEwmbx+eh2FYHRwcvN489/3Mx60OBzyLGzCMwGKx+DQMw+rh+erq6s3Nzc1s89wwDKvFYvFpq8MBzyLAMALL5fJ6vV6vHr1a3d3dvbu8vPzj/v7+y8PL9Xq9Wi6X11sfEPjPdmez2dd6CODHnlrCevw7797e3uTs7Ozvza+kLWHBy+YGDCPwgyWs10dHR+8vLi4+P8TXEhaMhyUsGIHNJaz9/f0/T09PPxweHk4en7OEBePhBgwjsLmEdX5+/tdmfHd2LGHBmAgwjMATS1hPsoQF42EJC144/4QFvya/AcMLJ6Twa/IVNAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAgIMAAEBBgAAgIMAAEBBoCAAANAQIABICDAABAQYAAICDAABAQYAAICDAABAQaAgAADQECAASAgwAAQEGAACAgwAAQEGAACAgwAAQEGgIAAA0BAgAEgIMAAEBBgAAh8A7eTh5iv46D1AAAAAElFTkSuQmCC",ya="media",za=a.getText("media.toolbutton.inserttext"),Aa="video",Ba=a.getText("media.menu.text"),Ca=a.getText("media.menu.properties"),Da="media.dialog",Ea=a.getText("media.dialog.inserttitle"),Fa=a.getText("media.dialog.edittitle"),Ga=a.getText("media.dialog.label.mediatype"),Ha=a.getText("media.dialog.label.url"),Ia=a.getText("media.dialog.label.inputurl"),Ja=a.getText("media.dialog.label.inputembed"),Ka=a.getText("media.dialog.label.embed"),La=a.getText("media.dialog.label.width"),Ma=a.getText("media.dialog.label.height"),Na=a.getText("media.dialog.label.constrain"),Oa=a.getText("media.dialog.alert.inputurl"),Pa=a.getText("media.dialog.alert.inputembed"),Qa=a.getText("media.dialog.alert.selecttype"),Ra=a.getText("media.dialog.alert.invalidelement"),Sa=a.getText("ok"),Ta=a.getText("cancel"),Ua="480",Va="300",Wa="inputTypeUrl",Xa="inputTypeEmbed",Ya=[{text:"video"},{text:"audio"}],Za=["mp4","webm","ogg","mp3","wav"],$a={IFRAME:!0,EMBED:!0,OBJECT:!0,VIDEO:!0,AUDIO:!0},_a=/(?:\s|\,)+/,ab="script",bb=ta.trim;sa=bb(a.configs.invalid_elements||ab),sa=sa.split(_a),Ka=Ka.replace(new RegExp("("+sa.join("|").toLowerCase()+")/?","g"),""),a.insertMedia=Y,ua.insertMedia||(ua.insertMedia=function(a,b,c,d,e){var f,g;if(a&&(f=this.get(a),f&&f.isPluginLoaded("media"))){if(f.isSpellcheckMode&&f.isSpellcheckMode())return;if(g=f.pluginUtils,!g.isTextMode()&&g.isEditTab())return f.insertMedia(b,c,d,e)}}),a.one("editorinitialized",function(){var b=a.selectionManager;b.addGetFilter("media",null,ka),b.addSetFilter("media_setContent",null,ja)}),a.one("editorcreate",function(){var b=a.pluginUtils;b.addInitialWidgetState(va,!1,a.constants.ButtonTypes.TOGGLE)}),a.one("editorinitialized",function(){var b,c,d=a.selectionManager,e=!0;for(c=sa.length;c--;)if(b=sa[c],/iframe/i.test(b)){e=!1;break}e&&(d.addParsingElemHandler("ifr_handle",[],"iframe",na),d.addParsingElemHandler("emb_handle",[],"embed",na),d.addParsingElemHandler("obj_handle",[],"object",na),d.addParsingElemHandler("ado_handle",[],"audio",na),d.addParsingElemHandler("vdo_handle",[],"video",na))}),a.addCommand({command:"media.checkLock",type:a.constants.CommandTypes.SYSTEM_COMMAND,action:la}),a.addCommand({command:"edit.media",type:a.constants.CommandTypes.CUSTOM_COMMAND_RANGE,action:Z}),a.addMenuItem(va,{icon:Aa,text:Ba+"...",click:O}),a.addContextMenuItem(va,{icon:Aa,text:Ca+"...",context:"media.selected",click:O}),a.addButton(ya,{label:za,tooltip:!0,icons:{primary:Aa},togglable:!0,pressed:!1,iconOnly:!0,click:O}),a.addDialog(Da,{title:Ea,modal:!0,resizable:!1,width:350,items:[{type:"container",items:[{type:"columns",items:[{type:"radio",name:"inputTypeUrlRadio",align:"left",options:{label:Ia,click:z}},{type:"radio",name:"inputTypeEmbedRadio",align:"left",options:{label:Ja,click:A}}]},{type:"columns",name:"URLInputs",items:[{type:"label",proportion:"21%",align:"left",options:{label:Ha}},{type:"textbox",name:"URLInput",proportion:"79%",align:"left",options:{width:"247px",placeholder:"http://"}}]},{type:"label",name:"embedLabel",ialign:"left",options:{label:Ka}},{type:"textbox",name:"embedTextArea",align:"left",options:{multiline:!0}},{type:"columns",name:"mediaTypeSelectMenus",items:[{type:"label",proportion:"21%",align:"left",options:{label:Ga}},{type:"selectmenu",name:"mediaTypeSelectMenu",proportion:"79%",align:"left",options:{menuItems:Ya,width:"252px",autoCloseViaScroll:!1}}]},{type:"columns",name:"sizeInputs",items:[{type:"textbox",name:"widthInput",label:La,align:"left",options:{type:"integer",min:10,max:9999,maxlength:4},unit:"px"},{type:"textbox",name:"heightInput",label:Ma,options:{type:"integer",min:10,max:9999,maxlength:4},unit:"px"}]},{type:"checkbox",name:"constrainButton",options:{label:Na,click:K}}]}],buttons:[{text:Sa,click:N},{text:Ta,click:function(){this.close()}}],open:L,close:M}),a.addFinalTask(function(){ua=null,va=null,wa=null,xa=null,ya=null,za=null,Aa=null,Ba=null,Ca=null,Da=null,Ea=null,Fa=null,Ga=null,Ha=null,Ia=null,Ja=null,Ka=null,La=null,Ma=null,Na=null,Oa=null,Pa=null,Qa=null,Ra=null,Sa=null,Ta=null,Ua=null,Va=null,pa=null,qa=null,Wa=null,Xa=null,Ya=null,Za=null,$a=null,ra=null,_a=null,sa=null,ab=null,bb=null,oa=null,ta=null})});