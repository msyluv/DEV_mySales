/*! cafe note v2.3.28.1 | Copyright 2014, S-Core, Inc. All Right Reserved. */
cafe.pluginManager.add("readonly",["preview"],function(a,b){function c(a){if(n||a)return n.get(a)}function d(a){return k.getWidget(a)}function e(b){var c,e,f,g,h,i,j,n,o,q="textmode";if(c=m.panel||p('textarea[data-cui-title="'+q+'"]',l),c.length&&c.prop("readonly",b),e=m.toolButton||a.getToolButton(q),e&&e[b?"disable":"enable"](),a.configs.menubar)if(i=k.disableMenuItem(q,b),f=m.menus||[],f.length)for(g=0,h=f.length;g<h;g++)f[g].option("disabled",b);else for(j=i.closest("[aria-labelledby]").attr("aria-labelledby"),n=d(/menubar_menu_(?:\\.|[\w-]|[^\x00-\xa0])+/),g=0,h=n.length;g<h;g++)o=n[g],o.element.attr("id")===j&&(o.option("disabled",b),f.push(o));Object.keys(m).length||(m={panel:c,toolButton:e,menus:f})}function f(a){var b,c=k.activeDialogs,e=c.length;if(!o&&k.isDialogOpened())for(b=0;b<e;b++)d(c[b]).close();k.changeTab(a?"preview":"edit"),j[a?"hide":"show"]()}function g(b){return!!k&&(o!==b&&(a.pluginUtils.isTextMode()?e(b):f(b),l.toggleClass("cui-read-only",b),o=b,!0))}function h(){return o}function i(){a.isPluginLoaded("preview")&&b.loadContent()}var j,k,l,m={},n=a.editorManager,o=!1,p=a.$;b&&(a.on("editorinitialized",function(){k=a.uiManager,l=k.getContainer(),j=p(".cui-tabs-nav",l),a.previewAddedByReadonly&&p("[data-cui-name=preview]",j).hide(),a.configs.start_with_readonly&&g(!0)}),a.addFinalTask(function(){j=null,k=null,l=null,m=null,n=null,o=null,p=null}),a.setReadOnly=g,a.isReadOnly=h,a.updateReadOnly=i,"function"!=typeof n.setReadOnly&&(n.setReadOnly=function(b,d){var e=c(b);return e&&e.isPluginLoaded("readonly")&&"boolean"==typeof d?a.isSpellcheckMode&&a.isSpellcheckMode()?null:e.isReadOnly()!==d&&e.setReadOnly(d):null}),"function"!=typeof n.isReadOnly&&(n.isReadOnly=function(a){var b=c(a);return b&&b.isPluginLoaded("readonly")?b.isReadOnly():null}))});