/*! cafe note v2.3.28.2 | Copyright 2014, S-Core, Inc. All Right Reserved. */
!function(a,b){"use strict";function c(a,b){var c,d,f=a.length,g=[];for(c=0;c<f;c++){if(d=e[a[c]],!d)throw"Can not find a dependency module: "+a[c];g.push(d)}b.apply(null,g)}function d(a,b,d){if("string"!=typeof a)throw"invalid definition, module id must be defined";if("[object Array]"!==Object.prototype.toString.call(b))throw"Dependencies must be not null";if("[object Function]"!==Object.prototype.toString.call(d))throw"Implement function must be defined";c(b,function(){e[a]=d.apply(null,arguments)})}var e;a=a||window,e=a.Cafe&&a.Cafe.getModules?a.Cafe.getModules():{},d.amd=!0,cafe.pluginManager.add("newdocument",["commonformat"],function(a,b){function c(b,c){var d=a.getToolButton(b);d&&d.index(c)}function d(b,c){var d=a.getToolButton(b);d&&d.option("disabled",c),a.disableMenuItem(b,c)}function e(){for(var e,f,g,h=a.pluginUtils.getInitialWidgetState(),i=h?h.length:0,j=a.constants.ButtonTypes;i--;)switch(e=h[i],f=e.name,g=e.value,e.type){case j.TOGGLE:b.pressWidget(f,g);break;case j.MENU:c(f,g);break;case j.COLOR:b.setWidgetColor(f,null,g);break;case j.ENABLED:d(f,g)}}var f=a.$,g="newdocument",h="newdocument",i="newdocDialog",j=a.getText("newdocument.toolbar.title"),k=a.getText("newdocument.menu.title"),l=a.getText("newdocument.dialog.title"),m=a.getText("ok"),n=a.getText("cancel"),o=a.getText("newdocument.dialog.message"),p=function(a,b){var c,d;for(c=0,d=b.length;c<d;c++)a.removeChild(b[c])},q=function(){var b,c,d;return c=a.getHead(),b=f(c).contents().filter(function(a,b){var c=!1;return c=8===b.nodeType||b.getAttribute&&!/cui-content-default/i.test(b.getAttribute("class"))}),p(c,b),c=null,d=a.getBody(),f("table,th,td",d).removeData(),b=f(d).contents(),p(d,b),d=null,b=null,!0},r=function(){var b;return a.pluginUtils.unselectAllTable(),q(),a.browser.safari&&a.selectionManager.appendDummyLine(a.getBody()),b=a.insertEmptyLine(),a.selectionManager.setRange(b,0,b,0),a.selectionChange.contentChanged(),b=null,!0},s=function(){a.dialog(i)};a.addButton(g,{label:j,icons:{primary:"new-document"},text:!1,iconOnly:!0,tooltip:!0,click:s}),a.addMenuItem(g,{icon:"new-document",text:k,click:s}),a.addDialog(i,{title:l,width:400,resizable:!1,modal:!0,items:[{name:"messageContainer",type:"container",items:[{name:"messageText",type:"label",options:{label:o}}]}],buttons:[{text:m,click:function(){a.execCommand(h),this.close(),a.focus()}},{text:n,click:function(){this.close()}}]}),a.addCommand({command:h,type:cafe.editorConstants.CommandTypes.SYSTEM_COMMAND,action:r}),a.on("newdocumentcommand",function(){e()}),a.addFinalTask(function(){q(),f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null})}),cafe.pluginManager.add("fontfamily",["spanstyle","commonformat"],function(a,b,c){function d(){var b,c,d,e=a.configs.font_formats,f=[],g={},h=function(a){return a&&(a=a.replace(/[\"\']/g,"")),a};if(!e||0===(d=e.length))return l;for(c=0;c<d;c++)b=h(e[c]),g[b]||(g[b]=!0,f.push(b));return f}function e(a){var b,c,d=a?a.length:0,e=[];for(b=0;b<d;b++)c=a[b],e.push(f(c));return e}function f(b){var c=b;return{text:'<span style="font-family: '+c+';">'+c+"</span>",click:function(){var b,d,e=[];if(b=c.length-1,"'"!==c.charAt(0)&&"'"!==c.charAt(b)&&'"'!==c.charAt(0)&&'"'!==c.charAt(b)){for(e=c.split(/\s+/),d=e.length;d--&&!/^(--|-\d|\d)|([^\u00a0-\uFFFF\w\-]+)/.test(e[d]););d!==-1&&(c='"'+c+'"')}a.pluginUtils.deselectItem(),a.execCommand(k,c)}}}function g(a,c){return b.commandFormatStyle(c,"fontFamily")}var h,i,j="fontfamily",k="fontName",l=["Arial","Courier","sans-serif","맑은 고딕","굴림","바탕","궁서","돋움"],m=a.getText("fontfamily.toolbar.title");h=d(),i=e(h),a.one("editorcreate",function(){var b=c.getDefaultFontFamily(),d=h.indexOf(b);a.pluginUtils.addInitialWidgetState(j,d,a.constants.ButtonTypes.MENU)}),a.addButton(j,{widgetType:"selectmenu",label:m,menuItems:i,width:100,maxHeight:350,tooltip:m,autoCloseViaScroll:!1}),a.addCommand({command:k,type:a.constants.CommandTypes.CUSTOM_COMMAND_RANGE,action:g}),a.addFinalTask(function(){j=null,k=null,l=null,m=null,h=null,i=null})}),cafe.pluginManager.add("fontsize",["spanstyle","commonformat"],function(a,b,c){function d(a){var b,c,d=a?a.length:0,f=[];for(b=0;b<d;b++)c=a[b],f.push(e(c));return f}function e(b){var c=b;return/(:?px|pt|cm){1}$/i.test(c)||(c=parseInt(c,10)+i),{text:"<span>"+c+"</span>",click:function(){a.pluginUtils.deselectItem(),a.execCommand(n,c)}}}function f(a){return a.replace(/\s*/g,"")}function g(a){for(var b=a.length;b--;)a[b]=f(a[b])}function h(a,c,d){return b.commandFormatStyle(c,d)}var i,j,k,l=a.$,m="fontsize",n="fontSize",o=a.getText("fontsize.toolbar.title"),p=l.isArray,q=l.trim;i=a.configs.font_size_unit||"pt",j=a.configs.font_size_style_values,j=j||["10pt","12pt","14pt","16pt","20pt"],j=p(j)?j:q(j).split(/(?:,|\s){1,}/),g(j),k=d(j),a.one("editorcreate",function(){var b=c.getDefaultFontSize(),d=j.indexOf(b);a.pluginUtils.addInitialWidgetState(m,d,a.constants.ButtonTypes.MENU)}),a.addButton(m,{widgetType:"selectmenu",label:o,menuItems:k,maxHeight:350,width:100,tooltip:o,autoCloseViaScroll:!1}),a.addCommand({command:n,type:a.constants.CommandTypes.CUSTOM_COMMAND_RANGE,action:h}),a.addFinalTask(function(){m=null,n=null,i=null,j=null,k=null,o=null,p=null,q=null,l=null})}),cafe.pluginManager.add("fontcolor",["colorpicker","spanstyle","commonformat"],function(a,b,c,d){function e(b,c){a.pluginUtils.deselectItem(),a.execCommand(i,{evt:b,color:c,backupCursorInfo:h}),d.setWidgetColor(i,b,c),h=null}function f(a,b,d){return c.commandFormatStyle(b,d)}function g(){h=d.getBackupCursor(),a.browser.safari||a.blur()}var h,i="fontcolor",j=a.getText(i),k=a.getText("more"),l=a.getText("nocolor"),m="000000";a.addButton(i,{widgetType:"colorbutton",tooltip:!0,title:j,icon:"foreground-color",color:m,moreLabel:k,noColorLabel:l,showNoColorButton:!1,more:b?function(){var c=a.getToolButton(i);c&&(b.open(c.getColor()),b.beforeok(function(a,b){e(a,b.hex)}))}:null,click:e,beforeColorTableOpen:g}),a.addCommand({command:i,type:a.constants.CommandTypes.CUSTOM_COMMAND_RANGE,action:f}),a.one("editorcreate",function(){a.pluginUtils.addInitialWidgetState(i,m,a.constants.ButtonTypes.COLOR)}),a.addFinalTask(function(){i=null,h=null,j=null,l=null,m=null})}),cafe.pluginManager.add("fontbgcolor",["colorpicker","spanstyle","commonformat"],function(a,b,c,d){function e(b,c){a.pluginUtils.deselectItem(),a.execCommand(i,{evt:b,color:c,backupCursorInfo:h}),d.setWidgetColor(i,b,c),h=null}function f(a,b,d){return c.commandFormatStyle(b,d)}function g(){h=d.getBackupCursor(),a.browser.safari||a.blur()}var h,i="fontbgcolor",j=a.getText(i),k=a.getText("more"),l=a.getText("nocolor"),m="FFFFFF";a.addButton(i,{widgetType:"colorbutton",tooltip:!0,title:j,icon:"background-color",color:m,moreLabel:k,noColorLabel:l,showNoColorButton:!a.browser.ie,more:b?function(){var c=a.getToolButton(i);c&&(b.open(c.getColor()),b.beforeok(function(a,b){e(a,b.hex)}))}:null,click:e,beforeColorTableOpen:g}),a.addCommand({command:i,type:a.constants.CommandTypes.CUSTOM_COMMAND_RANGE,action:f}),a.one("editorcreate",function(){a.pluginUtils.addInitialWidgetState(i,m,a.constants.ButtonTypes.COLOR)}),a.addFinalTask(function(){i=null,h=null,j=null,l=null,m=null})}),cafe.pluginManager.add("italic",["commonformat"],function(a,b){function c(){return b.commandFormatStyle(d,{tag:"EM",style:"font-style: italic"})}var d="italic",e="italic",f=a.getText("italic.menu.title"),g=a.os.mac?"Command+I":"Ctrl+I",h=a.getText("italic.toolbar.tooltip");a.addButton(d,{label:h,icons:{primary:e},iconOnly:!0,tooltip:!0,togglable:!1,click:function(){a.pluginUtils.deselectItem(),a.execCommand(d)}}),a.addMenuItem(d,{icon:e,text:f,shortcut:g,click:function(){a.pluginUtils.deselectItem(),a.execCommand(d)}}),a.addCommand({command:d,tag:"span",type:a.constants.CommandTypes.CUSTOM_COMMAND_RANGE,shortcut:g,action:c}),a.one("editorcreate",function(){var b=a.pluginUtils;b.addInitialWidgetState(d,!1,a.constants.ButtonTypes.TOGGLE)}),a.addFinalTask(function(){d=null,e=null,f=null,g=null,h=null})}),cafe.pluginManager.add("bold",["commonformat"],function(a,b){function c(){return b.commandFormatStyle(e,{tag:"STRONG",style:"font-weight: bold"})}function d(){a.pluginUtils.deselectItem(),a.execCommand(e)}var e="bold",f=a.getText("bold.menu.title"),g=a.os.mac?"Command+B":"Ctrl+B",h=a.getText("bold.tooltip.title");a.addButton(e,{label:h,icons:{primary:e},iconOnly:!0,tooltip:!0,togglable:!1,click:d}),a.addMenuItem(e,{icon:"bold",text:f,shortcut:g,click:d}),a.addCommand({command:e,tag:"b",type:a.constants.CommandTypes.CUSTOM_COMMAND_RANGE,shortcut:g,action:c}),a.one("editorcreate",function(){a.pluginUtils.addInitialWidgetState(e,!1,a.constants.ButtonTypes.TOGGLE)}),a.addFinalTask(function(){e=null,f=null,g=null,h=null})}),cafe.pluginManager.add("underline",["commonformat"],function(a,b){function c(){return b.commandFormatStyle(d,{tag:"U",style:"underline"})}var d="underline",e="underline",f=a.getText("underline.menu.title"),g=a.os.mac?"Command+U":"Ctrl+U",h=a.getText("underline.toolbar.tooltip");a.addButton(d,{label:h,icons:{primary:e},iconOnly:!0,tooltip:!0,togglable:!1,click:function(){a.pluginUtils.deselectItem(),a.execCommand(d)}}),a.addMenuItem(d,{icon:e,text:f,shortcut:g,click:function(){a.pluginUtils.deselectItem(),a.execCommand(d)}}),a.addCommand({command:d,tag:"span",type:a.constants.CommandTypes.CUSTOM_COMMAND_RANGE,shortcut:g,action:c}),a.one("editorcreate",function(){var b=a.pluginUtils;b.addInitialWidgetState(d,!1,a.constants.ButtonTypes.TOGGLE)}),a.addFinalTask(function(){d=null,e=null,f=null,g=null,h=null})}),cafe.pluginManager.add("strikethrough",["commonformat"],function(a,b){function c(){return b.commandFormatStyle(d,{tag:"STRIKE",style:"line-through"})}var d="strikethrough",e="strikethrough",f=a.getText("strikethrough.menu.title"),g=a.getText("strikethrough.toolbar.tooltip");a.addButton(d,{label:g,icons:{primary:e},iconOnly:!0,tooltip:!0,togglable:!1,click:function(){a.pluginUtils.deselectItem(),a.execCommand(d)}}),a.addMenuItem(d,{icon:e,text:f,click:function(){a.pluginUtils.deselectItem(),a.execCommand(d)}}),a.addCommand({command:d,tag:"span",type:a.constants.CommandTypes.CUSTOM_COMMAND_RANGE,action:c}),a.one("editorcreate",function(){var b=a.pluginUtils;b.addInitialWidgetState(d,!1,a.constants.ButtonTypes.TOGGLE)}),a.addFinalTask(function(){d=null,e=null,f=null,g=null})}),cafe.pluginManager.add("information",[],function(a){function b(){var b;return b=a.getVerifyLog(!0),'<div style="position: static;" class="cui-helper-reset"><br><div style="position: static;" class="cui-helper-reset"><span> Company:</span><span>&nbsp'+k+'</span></div><div style="position: static;" class="cui-helper-reset"><span> Edition:</span><span>&nbsp'+i+"</span></div>"+("2024IM-T034-CNV23-PN33-GV38"!==d?'<div style="position: static;" class="cui-helper-reset"><span> License ID:</span><span>&nbsp2024IM-T034-CNV23-PN33-GV38</span></div>':"")+'<div style="position: static;" class="cui-helper-reset"><span> Version:</span><span>&nbsp'+j+"</span></div><br>"+(b?'<div style="position: static;" class="cui-helper-reset"><span>'+b.message+"</span></div><br>":"")+'<span style="position: static;"> '+l+"</span></div>"}var c="@@",d=c+"LICENSE_ID"+c,e="information",f="information.dialog",g=a.getText(e),h=a.getText("ok"),i=a.getEdition(),j=a.getVersion(),k="S-Core Co.",l="Copyright © "+k+", Ltd. All rights reserved.";a.addMenuItem(e,{icon:"information",text:g+"...",click:function(){a.dialog(f)}}),a.addDialog(f,{title:null,modal:!0,resizable:!1,width:320,items:[{type:"container",items:[{type:"html",contents:b()}]}],buttons:[{text:h,click:function(){this.close()}}]}),a.addFinalTask(function(){c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null})}),cafe.pluginManager.add("alignment",[],function(a){function b(b){return function(){a.pluginUtils.deselectItem(),a.execCommand(b)}}function c(b){return function(c){var e,f,g,h,i;if(h=a.pluginUtils.getSelectedCells(),h&&h.length){for(f=h.length,i=[],e=0;e<f;e++)g=h[e],i=i.concat(y.makeArray(g.childNodes));d(b,i)}else d(b,c);return!0}}function d(a,b){var c,d,e,f,g,i=[],k="",l=!0;for(c=0,d=b.length;c<d;c++)e=y(b[c]),g="",e.is(s)&&(i.push(e),f=e.attr("style"),f&&f.indexOf(a.styleName)!==-1&&(g=e.css(a.styleName)),k&&k!==g&&(l=!1),k=g);for(c=0,d=i.length;c<d;c++)e=i[c],d>1?l&&k===a.styleValue?e.css(a.styleName,""):e.css(a.styleName,a.styleValue):(f=e.attr("style"),f&&f.indexOf(a.styleName)!==-1&&e.css(a.styleName)===a.styleValue?(e.css(a.styleName,""),e.attr("style")||e[0].removeAttribute("style")):e.css(a.styleName,a.styleValue)),j(h(e[0]));return!0}function e(b){var c,d,e,f,g=a.selectionManager.getSelectedBlocks(b);for(d=g.length,c=0;c<d;c++)if(e=g[c].style[x],0===c)f=e;else if(f!==e)return!1;return f}function f(a){var b,c,d,e=a.nodeType;if(1===e||3===e){d=1===e?a:a.parentElement,b=d.style,c=b[x];do{if(""!==A(c))break;d=d.parentNode,d&&1===d.nodeType&&"BODY"!==d.nodeName&&(b=d.style,c=b[x])}while(d)}return c}function g(b,c,d){b.option("pressed",d),a.toggleMenuItem(c,d)}function h(a,b){var c;return c=b&&!b.collapsed?e(b):f(a)}function i(a){var b,c=a.range.startContainer.parentNode.style.textAlign,d=a.range.endContainer.parentNode.style.textAlign;return b=a.range.startContainer===a.range.endContainer?a.node.style.textAlign:c===d?c:""}function j(b){var c,d,e,f,h,i;for(c=0,d=k.length;c<d;c++){if(e=k[c],h=l[e].styleValue,f=a.getToolButton(e),!f)return;i=f.option("pressed"),b?i&&h!==b?g(f,e,!1):i||h!==b||g(f,e,!0):g(f,e,!1)}}var k,l,m,n,o,p,q,r,s,t,u,v,w=[],x="text-align",y=a.$,z=a.os.mac?"Command+Shift+":"Ctrl+",A=y.trim;for(v="alignment",u=a.editorManager.editorConstants.CommandTypes.CUSTOM_COMMAND_BLOCK,s="p, h1,h2, h3, h4, h5, h6, td, th, div, ul, ol, li, table, img",k=["alignment.left","alignment.center","alignment.right","alignment.justify"],l={"alignment.left":{icon:"align-left",shortcut:z+"L",styleName:x,styleValue:"left",pressed:!1},"alignment.center":{icon:"align-center",shortcut:z+"E",styleName:x,styleValue:"center",pressed:!1},"alignment.right":{icon:"align-right",shortcut:z+"R",styleName:x,styleValue:"right",pressed:!1},"alignment.justify":{icon:"align-justify",shortcut:z+"J",styleName:x,styleValue:"justify",pressed:!1}},n=0,o=k.length;n<o;n++)m=k[n],p=l[m],q=a.getText(m),r=b(m),t=c(p),a.addButton(m,{label:q,icons:{primary:p.icon},iconOnly:!0,togglable:!1,pressed:p.pressed,click:r}),a.addMenuItem(m,{icon:p.icon,text:q,shortcut:p.shortcut,pressed:m,click:r}),w.push(m),a.addCommand({command:m,type:u,shortcut:p.shortcut,action:t});a.addMenuItem(v,{text:a.getText(v),menuItems:w}),a.addContextMenuItem(v,{text:a.getText(v),menuItems:w}),a.on("selectionchange",function(b,c){var d=c.styles["text-align"];a.pluginUtils.isCharKeyCode(c.keyCode)||("left"===d&&(d=i(c)),j(d))}),a.addFinalTask(function(){k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,A=null,z=null})}),cafe.pluginManager.add("codeview",[],function(a){function b(b){var c;return b=a.selectionManager.getDefaultFilter().filterEventAttributes(b),u.append(b),c=u[0].innerHTML,u.empty(),c=c.replace(/>\n\s{2,}|>\n/g,">"),c=c.replace(/\s{1,}\n<|\n</g,"<"),c.replace(/\n\s*$/g,"")}function c(){var c,d,f,g,h,j,n;if(r===!0&&(c=k.val(),l!==c)){l=c,m&&m.length>0&&(c=c.replace(/src=['"]data:image[^'"]*\...['"]/g,'src="'+a.constants.NoImageData+'"'),c=c.replace(/background=['"]data:image[^'"]*\...['"]/g,""),c=c.replace(/background[^;]*url\(['"]?data:image[^)]*\...\);/g,"")),t?a.setContent(b(c)):a.setContent(c);try{if(m&&m.length>0){if(h=p("[embedded-id]",i),h&&h.length>0)for(f=h.length,d=0;d<f;d++)j=h[d],g=parseInt(j.getAttribute("embedded-id")),n=m[g],n&&("IMG"===n.type?j.src=n.data.src:"BG"===n.type?j.setAttribute("background",n.data.getAttribute("background")):"BGStyle"===n.type&&(j.style.backgroundImage=n.data.style.backgroundImage),j.removeAttribute("embedded-id"));e()}}catch(a){e()}}return!0}function d(){var b,c,d,j,m,q,s,v,w,x,y,z,A,B,C,D,E,F,G;if(!r)return!0;if(e(),c=p(i).clone(),d=p("img",i),s=p("img",c),s&&s.length>0)for(D=s.length,E=0;E<D;E++){w=s[E],m=d[E];try{C=w.src?w.src.substr(0,35):"",C.indexOf("data:image")>=0&&(G=f("IMG",m),w.setAttribute("embedded-id",G),w.removeAttribute("src"))}catch(a){continue}}if(j=p("[style*='background']",i),v=p("[style*='background']",c),v&&v.length>0)for(D=v.length,E=0;E<D;E++)for(x=v[E],q=j[E],z=x.getAttribute("style"),A=z.match(/background[^)]*\)/g),B=A?A.length:0,F=0;F<B;F++)y=/url[('"]+([^'")]*)['")]+/g.exec(A[F]),y&&y.length>1&&(y=y[1],C=y?y.substr(0,35):"",C.indexOf("data:image")>=0&&(G=f("BGStyle",q),x.setAttribute("embedded-id",G),x.style.backgroundImage='url("'+C+'...")'));if(j=p("[background]",i),v=p("[background]",c),v&&v.length>0)for(D=v.length,E=0;E<D;E++)x=v[E],q=j[E],y=x.getAttribute("background"),C=y?y.substr(0,35):"",C.indexOf("data:image")>=0&&(G=f("BG",q),x.setAttribute("embedded-id",G),x.setAttribute("background",C+"..."));return b=a.getContentWithBody(c,"raw"),b=g(b),t&&n&&n.parse?b=n.getTreeBuilder(o.getDefaultRuleSet()).parse(b).toFormatString():(b=u.append(b).html(),u.empty()),l!==b?(k.val(b),h(k[0],0),l=b):k.focus(),!0}function e(){m=[]}function f(a,b){var c=m.length;return m.push({type:a,data:b}),c}function g(a){var b,c,d,e,f;for(c=m.length,b=0;b<c;b++)d=m[b],d&&"IMG"===d.type&&(e='embedded-id="'+b+'"',f=e+' src="'+(d.data.src?d.data.src.substr(0,35):"data:image")+'..."',a=a.replace(e,f));return a}function h(a,b){if(null!==a)if(a.createTextRange){var c=a.createTextRange();c.move("character",b),c.select()}else a.selectionStart?(a.setSelectionRange(b,b),a.focus()):a.focus()}var i,j,k,l,m,n,o,p=a.$,q="codeview",r=!1,s=a.getText("html"),t=a.configs.codeview_indent||!1,u=p("<temp></temp>");a.addPanel(q,{label:s,tag:"textarea",title:"codeview"}),a.addCommand({command:"codeview.updatecontent",type:cafe.editorConstants.CommandTypes.SYSTEM_COMMAND,action:c}),a.one("uicreate",function(){var b=a.uiManager.getWidget("panel_"+q);j||k||!b||(j=b,k=j.element,k.css({"font-size":"9pt","font-family":"Courier, AppleGothic, sans-serif","font-weight":"normal",color:"#555","word-break":"break-all","word-wrap":"break-word",padding:"10px",resize:"none","box-sizing":"border-box"}))}),a.on("editorupdated",function(){d()}),a.one("editorcreate",function(){o=a.selectionManager,n=o.getHtmlParser(),i=a.getBody()}),a.on("tabsactivate",function(b,e){e.newPanelName===q?(a.editorManager.focusedEditor=null,r=!0,d(),a.disableAllHeader()):e.oldPanelName===q&&(c(),r=!1)}),a.addFinalTask(function(){k.remove(),u.remove(),p=null,q=null,r=null,s=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,t=null,u=null})}),cafe.pluginManager.add("colorpicker",[],function(a){function b(b){g=b,e=null,f=null,a.dialog("colorpicker")}function c(a){e=a}function d(a){f=a}var e,f,g,h=a.$,i="colorpicker",j=a.getText(i),k=a.getText("ok"),l=a.getText("cancel");return a.addDialog("colorpicker",{title:j,autoOpen:!1,modal:!0,resizable:!1,width:380,items:[{type:"colorpicker",name:"colorpicker"}],buttons:[{text:k,click:function(a){var b;this.close(a,!0),h.isFunction(e)&&(b=this.getWidget("colorpicker"),e(a,b.color))}},{text:l,click:function(){this.close()}}],open:function(){var b=a.uiManager.getWidget("dialog_colorpicker_colorpicker");g&&b.update(g,"hex")},close:function(a){h.isFunction(f)&&f(a)}}),a.addFinalTask(function(){h=null,i=null,j=null,k=null,l=null,e=null,f=null,g=null}),{open:b,beforeok:c,beforecancel:d}}),cafe.pluginManager.add("copy",[],function(a){function b(){var b,c,e=a.getDoc(),f=a.pluginUtils,g=a.selectionManager;if(e.queryCommandSupported("copy"))if(e.queryCommandSupported("RemoveFormat")){try{if(b=f.getSelectedItem(),b&&f.deselectItem(!0),e.execCommand("copy"))return a.execCommand("copy"),void(b&&(c=g.createRange(),c.setStartAfter(b),c.setEndAfter(b),g.setSingleRange(c)))}catch(a){}a.alert(d)}else a.alert(" Not support : RemoveFormat");else a.alert(" Not support : COPY")}var c="copy",d=a.getText("copy.dialog.message"),e=a.getText(c);a.on("editorinitialized",function(){var b=a.commandManager.getShortcut(c);a.os.mac&&(b=a.uiManager.convertMacSymbol(b)),d=d.replace(/\{0\}/,b)}),a.on("selectionrangechange",function(){var b=a.selectionManager.getRange(),d=b.collapsed;d&&a.pluginUtils.getSelectedItem()&&(d=!1),a.disableMenuItem(c,d)}),a.addMenuItem(c,{icon:"copy",text:e,shortcut:c,disabled:!0,click:b}),a.addContextMenuItem(c,{icon:"copy",text:e,context_disable:"normal table.empty-cell.selected table.single-cell.selected table.multi-cell.selected",click:b}),a.addFinalTask(function(){c=null,d=null,e=null})}),cafe.pluginManager.add("cut",[],function(a){function b(){var b,c=a.getDoc();if(c.queryCommandSupported("cut")){try{if(b=a.pluginUtils.getSelectedItem(),b&&a.pluginUtils.deselectItem(!0),c.execCommand("cut"))return void a.execCommand("cut")}catch(a){}a.alert(f)}else a.alert(" Not support : CUT")}var c="cut",d="cut",e=a.getText("cut"),f=a.getText("cut.dialog.message");a.on("editorinitialized",function(){var b=a.commandManager.getShortcut(c);a.os.mac&&(b=a.uiManager.convertMacSymbol(b)),f=f.replace(/\{0\}/,b)}),a.on("selectionrangechange",function(){var b=a.selectionManager.getRange(),d=b.collapsed;d&&a.pluginUtils.getSelectedItem()&&(d=!1),a.disableMenuItem(c,d),a.disableContextMenuItem(c,d)}),a.addMenuItem(c,{icon:d,text:e,shortcut:c,disabled:!0,click:b}),a.addContextMenuItem(c,{icon:d,text:e,context_disable:"normal table.empty-cell.selected table.single-cell.selected table.multi-cell.selected",click:b}),a.addFinalTask(function(){c=null,d=null,e=null,f=null})}),cafe.pluginManager.add("paste",[],function(a){function b(){var b=a.getDoc();if(b.queryCommandSupported("paste"))try{if(b.execCommand("paste"))return void a.execCommand("paste")}catch(a){}a.alert(f)}var c="paste",d="paste",e=a.getText("paste"),f=a.getText("paste.dialog.message");a.on("editorinitialized",function(){var b=a.commandManager.getShortcut(c);a.os.mac&&(b=a.uiManager.convertMacSymbol(b)),f=f.replace(/\{0\}/,b)}),a.addMenuItem(c,{icon:d,text:e,shortcut:c,click:b}),a.addContextMenuItem(c,{icon:d,text:e,context_disable:"table.single-cell.selected table.multi-cell.selected",click:b}),a.on("tablestatechange",function(b,d){a.disableMenuItem(c,!!d.cells)}),a.addFinalTask(function(){c=null,d=null,e=null,f=null})}),cafe.pluginManager.add("preview",[],function(a){function b(){var b;return!i||(b=a.getContent(),e.open("text/html","replace"),e.write(b),e.close(),e.body.removeAttribute("contenteditable"),!0)}var c,d,e,f=a.$,g="preview",h=a.getText(g),i=!1;return a.addPanel(g,{label:h}),a.one("uicreate",function(){var b=a.uiManager.getWidget("panel_"+g);!d&&b&&(d=b,c=d.element.clone())}),a.on("editorupdated",function(){b()}),a.on("tabsactivate",function(h,j){var k,l,m,n;if(j.newPanelName===g||j.oldPanelName===g)try{k=d.element.contents()[0]}catch(a){l=c.clone(),m=f.extend(!0,{},d.options),n=f.extend(!0,{},d.htmlData),l.insertAfter(d.element),d.element.remove(),d.element=null,d.element=l.one("load",function(){d.options=m,d.htmlData=n,k=d.element.contents()[0]}).attr("src",l.attr("src"))}if(j.newPanelName===g){try{!k||e&&e===k||(e=k)}catch(a){e=k}i=!0,b(),a.disableAllHeader()}else i=!1}),a.addFinalTask(function(){e&&e.body&&e.removeChild(e.body.parentNode),g=null,h=null,c=null,e=null,i=null,d=null,f=null}),{loadContent:b}}),cafe.pluginManager.add("selectall",[],function(a){var b,c="selectall",d="select-all",e=a.getText("selectall.menu.title"),f=a.getText("selectall.toolbar.tooltip");b=function(){a.pluginUtils.deselectItem(),a.pluginUtils.unselectAllTable(),a.selectionManager.selectAll(),a.trigger("selectionrangechange")},a.addButton(c,{label:f,icons:{primary:d},text:!1,iconOnly:!0,tooltip:!0,click:b}),a.addMenuItem(c,{icon:d,text:e,shortcut:c,click:b}),a.addContextMenuItem(c,{icon:d,text:e,click:b}),a.addCommand({command:c,type:cafe.editorConstants.CommandTypes.SYSTEM_COMMAND,shortcut:a.os.mac?"Command+A":"Ctrl+A",action:b}),a.one("editorcreate",function(){var b=a.pluginUtils;b.addInitialWidgetState(c,!1)}),a.addFinalTask(function(){c=null,d=null,e=null,f=null,b=null})}),cafe.pluginManager.add("undo",[],function(a){function b(){return d||(d=a.getToolButton(f)),d}function c(){a.execCommand(f)}var d,e=a.$,f="undo",g="undo",h=a.getText("undo.menu.title"),i=a.getText("undo.toolbar.tooltip");a.one("editorinitialized",function(){var c=b();b()&&(a.on("historychanged historyadded",function(){var b=a.pluginUtils,d=!a.historyManager.canUndo();b.isEditTab()&&(c.option("disabled",d),a.disableMenuItem(f,d))}),a.on("tabsactivate",function(){var b=a.pluginUtils,d=a.uiManager.getContainer(),e=!a.historyManager.canUndo();b.isEditTab()&&(c.element.data("cui-prev-disabled",e),d.find("li[data-cui-name='undo']").data("cui-prev-disabled",e))}),e(a.getBody()).on("keyup",function(b){var d,e=b.ctrlKey||b.altKey||b.metaKey;!e&&c.option("disabled")&&(d=!a.historyManager.canUndo(),d&&!a.isEmpty()&&(c.option("disabled",!1),a.disableMenuItem(f,!1)))}))}),a.addButton(f,{label:i,icons:{primary:g},iconOnly:!0,tooltip:!0,togglable:!1,disabled:!0,click:c}),a.addMenuItem(f,{icon:g,text:h,shortcut:f,disabled:!0,click:c}),a.addFinalTask(function(){e=null,f=null,g=null,h=null,i=null,d=null})}),cafe.pluginManager.add("redo",[],function(a){function b(){return d||(d=a.getToolButton(e)),d}function c(){a.execCommand(e)}var d,e="redo",f="redo",g=a.getText("redo.menu.title"),h=a.getText("redo.toolbar.tooltip");a.one("editorinitialized",function(){var c=b();c&&(a.on("historychanged historyadded",function(){var b=a.pluginUtils,d=!a.historyManager.canRedo();b.isEditTab()&&(c.option("disabled",d),a.disableMenuItem(e,d))}),a.on("tabsactivate",function(){var b=a.pluginUtils,d=a.uiManager.getContainer(),e=!a.historyManager.canRedo();b.isEditTab()&&(c.element.data("cui-prev-disabled",e),d.find("li[data-cui-name='redo']").data("cui-prev-disabled",e))}))}),a.addButton(e,{label:h,icons:{primary:f},iconOnly:!0,tooltip:!0,togglable:!1,disabled:!0,click:c}),a.addMenuItem(e,{icon:f,text:g,shortcut:e,disabled:!0,click:c}),a.addFinalTask(function(){e=null,f=null,g=null,h=null,d=null})}),cafe.pluginManager.add("indent",[],function(a){function b(){a.pluginUtils.deselectItem(),a.execCommand("indent")}function c(){a.pluginUtils.deselectItem(),a.execCommand("outdent")}function d(a,b){var c,d,e=parseInt(m,10);return!!a&&(c=o(a).css(n),c=parseInt(c,10),d=b?c+e:c-e,d=d<0?0:d,o(a).css(n,d+"px"),!0)}function e(b,c){var d,e,f,g,i;if(!c)return!1;if(g=a.pluginUtils.getSelectedCells(),g&&g.length)for(e=g.length,d=0;d<e;d++)f=g[d],i=o.makeArray(f.childNodes),"indent"===c.command?h(i,!0):"outdent"===c.command&&h(i,!1);else"indent"===c.command?h(b,!0):"outdent"===c.command&&h(b,!1);return!0}function f(a){var b,c,d;return"LI"===a.nodeName&&(c=o(a).parents("ul, ol"),b=c.length,d=b?c[c.length-1]:null),d}function g(a){var b;return b=f(a),b?b:null}function h(b,c){var e,f,h,i,k;if(i=b.length){for(e=0;e<i;e++){if(f=b[e],h=g(f),j&&"LI"===f.nodeName&&h&&!k)return a.trigger("changeListByIndent",{isShift:!c}),a.selectionChange.contentChanged(),!0;k=h||k,"LI"===f.nodeName&&(f=h?h:null),d(f,c)}return!0}return!1}function i(d){var e,f,g=a.selectionManager;d.keyCode===o.ui.keyCode.TAB&&(a.isSpellcheckMode&&a.isSpellcheckMode()||(e=g.getRange(),f=g.getClosest(e.startContainer,"td, th, li"),f||(d.shiftKey?c():b(),d.preventDefault(),d.stopPropagation())))}var j,k=a.getText("indent"),l=a.getText("outdent"),m=cafe.editorConstants.INDENT_MARGIN,n=cafe.editorConstants.INDENT_STYLE,o=a.$;a.addCommand({command:"indent",type:cafe.editorConstants.CommandTypes.CUSTOM_COMMAND_BLOCK,action:e}),a.addCommand({command:"outdent",type:cafe.editorConstants.CommandTypes.CUSTOM_COMMAND_BLOCK,action:e}),a.addButton("indent",{label:k,tooltip:!0,icons:{primary:"increase-indent"},iconOnly:!0,click:b}),a.addButton("outdent",{label:l,tooltip:!0,icons:{primary:"decrease-indent"},iconOnly:!0,click:c}),a.addMenuItem("indent",{icon:"increase-indent",text:k,click:b}),a.addMenuItem("outdent",{icon:"decrease-indent",text:l,click:c}),a.one("editorcreate",function(){o(a.getDoc()).on("keydown",i),j=!!a.isPluginLoaded("lists")}),a.addFinalTask(function(){k=null,l=null,m=null,n=null,o=null,j=null})}),d("plugins/SpanStyle",["utilities/NodeTracker","utilities/EditorConstants"],function(a,b){cafe.pluginManager.add("spanstyle",["commonformat"],function(c,d){function e(a,b){var d,e,f,g,h,i,j;if("backgroundColor"===a&&b)for(i="transparent"===b?"":c.colorUtils.toRGBString(b),d=c.selectionUtils.getSelectedElements(!0,!0),h=d.length,g=0;g<h;g++)e=d[g],f=L(e),3===e.nodeType&&(j=f.closest("span, font"),j.css(a,i))}function f(a,b){var c,d,e=R.length;for(c=0;c<e;c++)if(d=R[c],b.nodeName===d&&a.nodeName!==d)return!0;return!1}function g(a){var b,d=a.startContainer,e=a.endContainer;return!a.collapsed&&f(d,e)&&(b=a.endOffset-1,e=e.childNodes[b<0?0:b],c.selectionManager.getClosest(d,e.nodeName)===e)?e:null}function h(a,b){var d,e;return d=b&&b.range?b.range:a&&c.lastRange?c.lastRange:c.selectionUtils.reRangeByShiftEnd(),c.browser.ie&&(e=g(d),e&&1===e.nodeType&&(d.setEndAfter(e.lastChild),c.selectionManager.setSingleRange(d))),d}function i(a){return"fontcolor"===a||"fontbgcolor"===a}function j(a){var b,d;if("fontSize"===a){if(b=c.selectionManager.getCursorPosition(),d=!b||3!==b.node.nodeType&&1!==b.node.nodeType?null:L(b.node).closest('span[style*="background-color"], font[style*="background-color"]'),d&&1===d.length)return d.css(M);d=null}return d}function k(a,b,c){a&&"fontSize"===b&&c&&L(a).css(M,c)}function l(){return!!(O.ie&&O.version<11)}function m(a){return!(0!==a.childNodes.length||!l())}function n(a,b,d,e,f){var g,h,i,j=c.contentUtils;for(h=a.childNodes.length,g=0;g<h;g++)i=a.childNodes[g],j.isLineNode(i)?m(i)?(b=b.parentNode?s(d,e,f):b,L(i).append(b)):L(L(i).contents()).wrapAll(b):"SPAN"===i.nodeName?(L(i).css(d,e),k(i,d,f)):L(i).wrapAll(b)}function o(a,b,c,d,e){var f,g,h;for(f=a.find("td, th"),h=f.length,g=0;g<h;g++)n(f.get(g),b,c,d,e)}function p(a){return"UL"===a||"OL"===a||"LI"===a}function q(b,d,e,f){var g,h,i,j,k,l,m,n=b[0],o=[],p=[];for(g=new a(n,c.contentUtils.getLeafNode(n,!1)),h=n;h;)j=h.nodeName,"UL"===j||"OL"===j||"LI"===j||L(h).find("ul, ol, li").length?o.length&&(p.push(o.slice(0)),o=[]):(m=o.length?o[o.length-1]:null,m&&L(m).find(h).length||o.push(h)),h=g.next();for(o.length&&p.push(o),l=p.length,k=0;k<l;k++)o=p[k],i=o[0],1===o.length&&"SPAN"===i.nodeName?i.style[e]=f:L(o).wrapAll(d)}function r(a){var b=a.parentNode;2===b.childNodes.length&&(b.firstChild===a&&"BR"===b.lastChild.nodeName?b.removeChild(b.lastChild):b.lastChild===a&&"BR"===b.firstChild.nodeName&&b.removeChild(b.firstChild))}function s(a,b,d){var e=c.getDoc().createElement("span");return e.style[a]=b,k(e,a,d),e}function t(a){var b;if(a&&""===a.textContent){for(b=a;1===b.childNodes.length;)b=b.firstChild;if(3===b.nodeType&&""===b.textContent||1===b.nodeType&&0===b.childNodes.length&&"BR"!==b.nodeName)return!0}return!1}function u(a){return!("SPAN"!==a.nodeName||!t(a))}function v(a,b,d){var e,f,g,h,i,j,k=c.styleUtils;if(a){if(a.normalize(),h=a.nodeName,0===a.childNodes.length&&!/^<p><br><\/p>$/i.test(a.outerHTML)&&a.nodeName===b.nodeName)return a.parentNode.removeChild(a),null;if(t(a))g=L(a),g.empty(),(P[h]||"SPAN"===h)&&(e=k.getStyleObject(a),delete e[Q[d]],f=k.getStyleObject(b),delete f[Q[d]],e.toString()===f.toString()&&g.remove());else if(S[h])for(j=a.childNodes.length;j--;)i=a.childNodes[j],t(i)&&v(i,b,d)}return a}function w(a){var b,c,d,e="";return b=a.getAttribute("style"),b||(b=P[a.nodeName],"FONT"===b&&(c=a.getAttribute("color"),d=a.getAttribute("face"),c&&(e=P.color+c),d&&(e+=P.face+d),b=e)),b}function x(a,b,c,d){var e,f;if(a&&a.parentNode)if("SPAN"===b.nodeName&&L(b).css(c)!==L(a).css(c))d?L(a).append(b):L(a).prepend(b);else if(1===a.childNodes.length&&u(a.firstChild)&&1===b.childNodes.length&&"SPAN"===b.firstChild.nodeName&&L(a).empty(),d||"LI"!==a.nodeName||"LI"!==b.nodeName?(L(a)[d?"append":"prepend"](L(b).contents()),e=b.parentNode,d&&"LI"===b.nodeName&&("OL"===e.nodeName||"UL"===e.nodeName)&&e.childNodes.length>1&&L(a).after(L(b).nextAll())):(f=a,a=b,b=f,L(a).append(L(b).contents())),"LI"===a.nodeName&&"LI"===b.nodeName)for(;p(b.nodeName)&&a!==b;){
if(b.childNodes.length>1||""!==L.trim(b.textContent)){if(b.nodeName!==a.nodeName||"LI"!==b.firstChild.nodeName)break;if(b.querySelector(b.nodeName)===a)break;L(a).append(b.childNodes)}a=a.parentNode,e=b.parentNode,e.removeChild(b),b=e}else b.parentNode.removeChild(b)}function y(b,d,e,f,g,h){var i,j,k,l,m,n,o,p=function(a){return a.startContainer===a.endContainer};if(e&&(l=e.style,m=l.length,e.normalize(),"SPAN"===e.nodeName&&"SPAN"===b.nodeName&&"SPAN"===d.nodeName)){if(1===e.childNodes.length&&e.firstChild===b&&1===m&&""!==N(l[f]))L(b).unwrap();else{if(e.firstChild!==b)if(i=h.cloneRange(),i.setStartBefore(e.firstChild),i.setEndBefore(b),p(i))i.surroundContents(L(e).clone().empty()[0]);else for(k=new a(e,b),j=e;j&&j!==b;)3===j.nodeType&&L(j).wrap(L(e).clone().empty()[0]),j=k.next();if(e.lastChild!==d&&d.nextSibling)if(i=h.cloneRange(),i.setStartBefore(d.nextSibling),i.setEndAfter(e.lastChild),p(i))i.surroundContents(L(e).clone().empty()[0]);else for(k=new a(d,e),j=k.next();j&&j!==e;)3===j.nodeType&&L(j).wrap(L(e).clone().empty()[0]),j=k.next();if(b===d){o=c.styleUtils.getStyleObject(b),b.setAttribute("style",w(e));for(n in o)b.style[n]=o[n];"transparent"===g&&(b.style[f]="")}else i=h.cloneRange(),i.setStartBefore(b),i.setEndAfter(d),p(i)&&i.surroundContents(L(e).clone().empty()[0]);L(e.childNodes).unwrap()}h.setStartBefore(b),h.setEndAfter(d)}}function z(a,b,d,e,f,g){if("transparent"===f)for(d=a.parentNode;d&&"BODY"!==d.nodeName&&!c.contentUtils.isLineNode(d);)""!==d.style[e]&&y(a,b,d,e,f,g),d=d.parentNode}function A(a,b,d,e,f,g){var h,i,j,k,l,m,n=c.contentUtils,o=function(a){return!!(a&&("UL"===a.nodeName||"OL"===a.nodeName)&&a.childNodes.length>0&&p(a.firstChild.nodeName))},q=function(a,b){for(var c=a,d=b?"firstChild":"lastChild";c&&c.childNodes.length&&p(c.nodeName);)c=c[d];return c&&"LI"!==c.nodeName&&(c=c.parentNode),c},r=function(a){var b,c,d,e,f,g=a.commonAncestorContainer;if(g)for(b=L(g).parents("ul, ol"),f=b.length?b[0]:g,b=L(f).find("ul","ol"),e=b.length,d=0;d<e;d++)c=b[d],c.childNodes.length||c.parentNode.removeChild(c)},s=function(a){var b,c;return b=a.firstChild,"LI"===b.nodeName&&b.firstChild&&b.firstChild.childNodes.length&&(c=b.firstChild,"UL"===c.nodeName||"OL"===c.nodeName)?(L(b.childNodes).unwrap(),c):a},t=function(a,b,c){c?b?f.setStartAfter(b):f.setStartBefore(n.getLeafNode(a.lastChild,!0)||a):a&&(a.parentNode?f.setEndAfter(n.getLeafNode(a.firstChild,!1)||a):b&&f.setEndAfter(n.getLeafNode(b,!1)))},u=function(a,b,c){a&&1===b.nodeType&&b.nodeName===a.nodeName&&(n.isLineNode(a)?("LI"===a.nodeName&&"LI"===b.nodeName&&(a=q(a,!c),b=q(b,c)),j=!0):o(a)&&o(b)&&(a=s(a),a=c?a.lastChild:a.firstChild,a=q(a,!c),b=c?b.firstChild:b.lastChild,b=q(b,c),j=!0),j&&(l=c?"LI"===a.nodeName?a.lastChild:null:"LI"===b.nodeName?b.lastChild:null,x(a,b,d,c),r(f),t(a,l,c)))};h=v(a.previousSibling,a,d),i=v(b.nextSibling,b,d),a!==b&&(u(h,a,!0),k=c.selectionManager.getSelectedBlocks(f,S).length,g!==k&&u(i,b,!1)),j||(m=a.parentNode,y(a,b,m,d,e,f),z(a,b,m,d,e,f))}function B(a,b,c){var d,e,f,g,h,i;if(e=a.childNodes.length,e>1){for(d=0;d<e;d++){if(f=a.childNodes[d],g=f.style,"SPAN"!==f.nodeName||0!==f.attributes.length&&(1!==f.attributes.length||1!==g.length||g[b]!==c)){h=!1;break}h=!0}if(h){for(d=0;d<e;d++)f=a.childNodes[d],L(f.childNodes).unwrap();i=s(b,c),L(L(a).contents()).wrapAll(i)}}return a}function C(a,b,c,d,e){var f,g;a=B(a,b,c),f=a.firstChild,g=a.lastChild,d.insertNode(a),A(f,g,b,c,d,e)}function D(a,b){for(var c,d,e,f,g=a?a.childNodes[0]:null,h=[],i=[];g&&g!==a;)if(e=L(g),"SPAN"===g.nodeName?g.childNodes.length||!g.nextSibling&&!g.previousSibling?(f=g.style,c=f.length,1===c&&""!==N(f[b])&&1===g.attributes.length?h.push(g.childNodes):e.css(b,"")):i.push(g):1===g.nodeType&&g.style.length&&e.css(b,""),g.hasChildNodes())g=g.firstChild;else{for(;g&&null===g.nextSibling&&g!==a;)g=g.parentNode;g!==a&&(g=g.nextSibling)}for(c=h.length,d=0;d<c;d++)L(h[d]).unwrap();for(c=i.length,d=0;d<c;d++)L(i[d]).remove();return a}function E(a,b,c,d){var e,f,g,h,i,j,l,m,n,r=s(b,c,d);for(e=a.childNodes.length,g=0;g<e;g++)if(f=a.childNodes[g],f.normalize(),i=L(f),h=f.nodeName,j=f.parentNode,j&&"SPAN"===j.nodeName)L(j).css(b,c),k(j,b,d);else if("SPAN"===h)i.css(b,c),k(i[0],b,d);else if(3===f.nodeType&&""!==f.textContent)L(i).wrapAll(r);else if("TABLE"===h)o(i,r,b,c,d);else if(p(h))q(i,r,b,c);else{if(8===f.nodeType)continue;m=0===f.childNodes.length&&O.ie,m&&(r=r.parentNode?s(b,c,d):r),l=L(r),d=f.style[M],1===e&&"fontSize"===b&&"transparent"===l.css(M)&&d&&l.css(M,d),m?L(f).append(r):(n=f.firstChild,1===f.childNodes.length&&"SPAN"===n.nodeName?n.style[b]=c:L(i.contents()).wrapAll(r))}return a}function F(a,b,d,e){var f,g,h,i,j,k,l=s(a,b,e),m="class",n=c.selectionManager,o=c.zwsUtils;l.innerHTML=T,o.taggingZeroWidthSpace(l.firstChild),d=n.evadeVoidElement(d),f=l,g=l,d.insertNode(l),r(f),h=f.parentNode,y(f,g,h,a,b,d),z(f,g,h,a,b,d),d.setStart(l.firstChild,1),d.collapse(!0),n.setSingleRange(d),o.taggingZeroWidthSpace(l.firstChild),i=l.previousSibling,i&&"SPAN"===i.nodeName&&(i.textContent===T?i.parentNode.removeChild(i):(/cui\-zws/i.test(j=i.getAttribute(m))&&(j=j.replace(/cui\-zws/i,""),0!==j.length?i.setAttribute(m,j):i.removeAttribute(m)),k=i.firstChild,k&&3===k.nodeType&&/^\u200B/.test(k.textContent)&&(k.textContent=k.textContent.substring(1))))}function G(a,b,d){var e,f;f=c.selectionManager.getSelectedBlocks(a,S).length,e=a.extractContents(),e.normalize(),e=D(e,b),e=E(e,b,d,j(b)),C(e,b,d,a,f)}function H(a,c,d){return a.nodeType===b.NodeTypes.ELEM_NODE&&(a.setAttribute(c+"Offset",d),!0)}function I(a){var b,c,d,e;for(b=a.querySelectorAll("font"),c=b.length;c--;){for(d=b[c],e=document.createElement("span"),e.style.color=d.color,e.style.fontFamily=d.face,d.hasAttribute("startOffset")&&e.setAttribute("startOffset",d.getAttribute("startOffset")),d.hasAttribute("endOffset")&&e.setAttribute("endOffset",d.getAttribute("endOffset"));d.childNodes.length;)e.appendChild(d.childNodes[0]);d.parentNode.replaceChild(e,d)}}function J(a,d){var e,f,g=a.commonAncestorContainer,h=a.startContainer,i=a.startOffset,j=a.endContainer,k=a.endOffset;return g.nodeType===b.NodeTypes.TEXT_NODE&&(g=c.selectionManager.getClosest(g,b.LineElementsStr)),g.querySelector("font")?(d||(e=H(h,"start",i),f=H(j,"end",k)),I(g),d?a:(e&&(h=g.querySelector("[startOffset]"),i=parseInt(h.getAttribute("startOffset"),10),h.removeAttribute("startOffset")),f&&(j=g.querySelector("[endOffset]"),k=parseInt(j.getAttribute("endOffset"),10),j.removeAttribute("endOffset")),c.selectionManager.setRange(h,i,j,k))):a}var K=this,L=c.$,M="backgroundColor",N=L.trim,O=c.browser,P={STRONG:"font-weight: bold;",B:"font-weight: bold;",I:"font-style: italic;",EM:"font-style: italic;",U:"text-decoration: underline;",STRIKE:"text-decoration: line-through;",FONT:"FONT",SUB:"SUB",SUP:"SUP",color:"color: ",face:"font-family: "},Q={fontSize:"font-size",fontFamily:"font-family",color:"color",backgroundColor:"background-color"},R=["BODY","UL","OL","TD"],S={P:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,LI:!0},T=c.editorManager.editorConstants.UNICODE_CHAR_CODE.ZERO_WIDTH_SPACE;K.commandFormatStyle=function(a,b){var f,g,k,l,m,n,o,p,q,r=a&&a.backupCursorInfo?a.backupCursorInfo:null,s=c.selectionManager;if(!O.ie&&c.isEmpty()&&c.focus(),n=b.command||b,o=a,a&&a.color){switch(n){case"fontcolor":n="color";break;case"fontbgcolor":n="backgroundColor"}o=a.color,o="transparent"!==o?"#"+o:o}if(q=i(n),m=h(q,r),g=c.pluginUtils.getSelectedCells(),c.pluginUtils.fillEmptyCellsInRange(m),g&&g.length){for(p=s.getCursorPosition(),l=g.length,k=0;k<l;k++)f=g[k],m=d.reRangeByCell(f),m=J(m,!0),G(m,n,o),e(n,o);p=p?{node:c.contentUtils.getLeafNode(m.startContainer,!0),line:p.line,offset:0}:null}else{if(p=d.getCursor(m),p&&(m=c.contentUtils.selectWordRange(m),m.collapsed))return m=J(m),F(n,o,m,j(n)),c.selectionChange.refreshLastRange(),!0;m=J(m),G(m,n,o),s.setSingleRange(m),e(n,o)}return p&&s.setCursorPosition(p),c.selectionChange.refreshLastRange(),!0},c.addFinalTask(function(){K.commandFormatStyle=null,K=null,L=null,M=null,N=null,O=null,P=null,Q=null,R=null,S=null,T=null})})}),d("plugins/CommonFormat",["utilities/NodeTracker","utilities/StyleParser","utilities/EditorConstants"],function(a,b,c){cafe.pluginManager.add("commonformat",[],function(b){function d(a){return b.getToolButton(a)}function e(a,c){var d,e,f=b.selectionManager,g=/\bmargin\b/gi;if(a&&(c===Z.BACKSPACE&&!a.previousSibling||c===Z.DELETE&&!a.nextSibling)){if(Y.ie&&"P"===a.nodeName&&!a.getAttribute("style")&&"<br>"===a.innerHTML)return!1;if("P"===a.nodeName&&g.test(a.getAttribute("style")))return!1;if(e=a.previousSibling,!e||f.isDummyLine(e))return d=b.createEmptyLine(),X(a).replaceWith(d),f.setRange(d,0,d,0),!0}return!1}function f(a){return!(!b.browser.ie||a.keyCode!==X.ui.keyCode.ENTER||!W.getEmptyLineWithCursor(a.cursor))}function g(a,b){var c;return c=/line\-through/i.test(b)?"strikethrough":/underline/i.test(b)?"underline":/sub/i.test(b)?"subscript":/super/i.test(b)?"superscript":da[a].styleName}function h(a){var b,c,d=T.length;for(b=0;b<d;b++)if(c=new RegExp("^"+T[b]+"$","i"),c.test(a))return b;return-1}function i(a){var c,e,f,i,j,k,l,m,n,o=function(a,b){k=g(a,b),k&&!/^font\S/i.test(k)&&(j=ba[k],j&&(l=j.reg.test(b),W.pressWidget(k,l)))},p=function(a,b){var c=d(a);c&&(b!==-1?c.index(b):c.option("label",fa[a].label))},q=function(a,c){return c?"transparent"!==c&&(c=b.colorUtils.toHEX(c)):"color"===a?c="000000":"backgroundColor"===a&&(c="transparent"),c};X.map(da,function(b,d){switch(f=d,i=a[f],f){case"text-align":return;case"line-height":n=U.indexOf(i),p(b.styleName,n);break;case"fontSize":n=R.indexOf(W.parseFontSize(i)),p(b.styleName,n);break;case"fontFamily":i&&(i=X.trim(i.split(",")[0]),i=W.removeQuotation(i)),n=h(i),p(b.styleName,n);break;case"color":case"backgroundColor":W.setWidgetColor(b.styleName,null,q(f,i));break;case"textDecoration":if(!i||/^none/.test(i))W.pressWidget("strikethrough",!1),W.pressWidget("underline",!1);else{for(m=i.split(" "),c=0,e=m.length;c<e;c++)o(f,m[c]);1===e&&(/line\-through/i.test(i)?W.pressWidget("underline",!1):W.pressWidget("strikethrough",!1))}break;case"verticalAlign":!i||/baseline/i.test(i)?(W.pressWidget("subscript",!1),W.pressWidget("superscript",!1)):/sub/i.test(i)?(W.pressWidget("subscript",!0),W.pressWidget("superscript",!1)):/super/i.test(i)&&(W.pressWidget("subscript",!1),W.pressWidget("superscript",!0));break;default:o(f,i)}})}function j(a,b){var c=b.textNodes,d=b.styles;!c.length&&f(b)||i(d)}function k(a){return"fontcolor"===a||"fontbgcolor"===a}function l(a){b.selectionManager.setSingleRange(a)}function m(a,c){var d;return d=c&&c.range?c.range:a&&b.lastRange?b.lastRange:b.selectionManager.getRange()}function n(a){return/^(subscript|superscript)$/.test(a)}function o(a,b){return!(!n(b)||!a)}function p(a,c){var d,e,f,g,h;for(h="subscript"===c?ba.superscript:ba.subscript,d=b.selectionManager.getAncestors(a),e=0,f=d.length;e<f;e++)g=d[e],1===g.nodeType&&(g.nodeName===h.tag[0]?(q(g,a,c),X(g).contents().unwrap()):h.reg.test(g.style.verticalAlign)&&(q(g,a,c),X(g).css("vertical-align","")))}function q(a,b,c){var d,e,f,g;for(d=a.childNodes,e=0,f=d.length;e<f;e++)g=d[e],3===g.nodeType&&""!==g.data&&g.data!==b.data&&X(g).wrap(ba[c].otherWrap)}function r(a){var c,d,e,f,g;for(c=b.selectionManager.getSelectedElements(),e=0,d=c.length;e<d;e++)f=c[e],3===f.nodeType&&""!==f.data&&(g||(g={startContainer:f,startOffset:0}),g.endContainer=f,g.endOffset=f.length,p(f,a));return g}function s(a){var b=a.lineElement,c=b.childNodes.length;return 0===a.offset&&0===a.col&&(0===c||1===c&&0===b.textContent.length)}function t(c,d){var e,f,g=b.contentUtils.getLeafNode(c,!0);for(f=new a(g,c);g;){if(g.nodeName===d){e=g;break}g=f.next()}return e}function u(a,c){var d,e,f,g=c.startContainer,h=n(a)?ba[a]:null,i=[],j=b.contentUtils;if(Y.ie&&h&&c.collapsed&&3===g.nodeType&&c.startOffset===g.length&&(d=X(g).closest(h.otherTag)[0],d&&g===j.getLeafNode(d))){for(;g;)g=g.parentNode,g!==d?i.push(g.cloneNode()):g=null;if(f=i.length-1,f>-1){for(e=i[f],X(d).after(e),f--;f>-1;)e.appendChild(i[f]),e=e.lastChild,f--;c.setStart(e,0),c.setEnd(e,0)}else f===-1&&(c.setStartAfter(d),c.setEndAfter(d));b.selectionManager.setSingleRange(c)}return c}function v(a){var c,d,e,f,g,h={},i=function(){c&&(a.setStart(c,0),b.selectionManager.setSingleRange(a),h.isSelectAllAtChrome=!0)};if(a&&Y.webkit&&(c=a.startContainer,"BODY"===c.nodeName&&0===a.startOffset&&"BODY"===a.commonAncestorContainer.nodeName)){for(d=a.endContainer,e=c.lastChild;e;){if(d===e){f=!0;break}e=e.lastChild}if(c=c.firstChild,c&&f&&(1===d.nodeType?g=1===d.childNodes.length&&"BR"===d.firstChild.nodeName?0:d.childNodes.length:3===d.nodeType&&(g=d.length),a.endOffset===g)){if("HR"===c.nodeName){for(;"HR"===c.nodeName&&c.nextSibling;)c=c.nextSibling;i()}if("TABLE"===c.nodeName){for(c=X(c).find("th, td")[0];c&&c.firstChild&&"TABLE"===c.firstChild.nodeName;)c=X(c.firstChild).find("th, td")[0];i()}}}return h.range=a,h}function w(a,c){var d,e,f,g,h,i,j,n,o,p={},q=c&&c.backupCursorInfo?c.backupCursorInfo:null,r=k(a),s=b.selectionManager,t=b.zwsUtils;return d=m(r,q),p=v(d),d=p.range,d=u(a,d),f=b.pluginUtils.getSelectedCells(),b.pluginUtils.fillEmptyCellsInRange(d),f&&f.length?(p.cells=f,p):(e=W.getCursor(d,q),e?(d=b.contentUtils.selectWordRange(d),d.collapsed?(i=e.line,e=null,Y.ie&&Y.version<11&&W.getEmptyLineWithCursor()&&1!==i||(h=t.getZeroWidthSpace(d),t.removeTaggingZeroWidthSpace(h?h.parentNode:null),s.selectElement(h),e={node:h,offset:1})):g=!0):(g=!0,Y.ie&&(j=s.getSelectedBlocks(d,$),c&&c.color&&(o=c.color,o="transparent"!==o?"#"+o:o),""===d.toString()&&(n=t.insertZWSInEmptyLines(j,a,o)))),r&&!e&&l(d),p.cursor=e,p.isSelected=g,p.zwsNode=h,n&&(p.isAllEmptyLines=n.isAllEmptyLines,p.pEmptyLines=n.pEmptyLines),p)}function x(a){var c,d,e,f,g,h,i,j,k,l,m,n=b.selectionManager.getRange(),o=[];if(a&&n){if(i={bold:["strong","b"],italic:["i","em"],underline:["u"],strikethrough:["strike","s"],superscript:["sup"],subscript:["sub"]},c=n.commonAncestorContainer,l=i[a],!l)return null;for(e=l.length,g=0;g<e;g++)for(d=X(c).find(l[g]+">span"),f=d.length,h=0;h<f;h++)k=d[h],j=k.parentNode,(j.previousSibling&&"SPAN"===j.previousSibling.nodeName||j.nextSibling&&"SPAN"===j.nextSibling.nodeName)&&(m=b.zwsUtils.createZeroWidthSpaceNode(),X(j).before(m),o.push(m));return o}}function y(a){var b,c;if(a&&a.length)for(c=a.length,b=0;b<c;b++)X(a[b]).remove()}function z(a,c){var d,e,f,g=b.getDoc();Y.ie&&(f=x(a)),c&&c.color?(d=c.color,a=ba[a].commandName,e="transparent"!==d?"#"+d:d):e=c,g.queryCommandSupported("styleWithCSS")&&(/subscript|superscript/.test(a)?g.execCommand("styleWithCSS",!1,!1):g.execCommand("styleWithCSS",!0,!0)),Y.ie&&"BackColor"===a&&"transparent"===e?g.execCommand("removeFormat",!1,"BackColor"):g.execCommand(a,!1,e),f&&f.length&&y(f)}function A(a){var c,e,f,g,h,i,j,k,l=b.selectionManager,m=function(){g.setStart(f,0),g.setEnd(f,f.length),l.setSingleRange(g)};return c=d(a),!!(c&&c.option("pressed")&&(e=W.getEmptyLineWithCursor()))&&(f=b.zwsUtils.createZeroWidthSpaceNode(),X(e).prepend(f),g=l.getRange(),m(),h=W.getFormatWidgetInfos(),X.map(h,function(a,c){i=a.value,i&&("fontsize"===c?(k=f.parentNode,"SPAN"===k.nodeName?k.style.fontSize=i:(j=b.getDoc().createElement("span"),j.style[c]=i,X(f).wrap(j),m())):(z(ba[c].commandName||c,i),m()))}),g.setStartAfter(f),g.setEndAfter(f),l.setSingleRange(g),!0)}function B(a,c){function d(a){var b,c,d,f,g,h="text-decoration",j=h+"-line";if(e&&e.range&&e.range.commonAncestorContainer)for(a?f=a:(d=e.range.commonAncestorContainer,d=3===d.nodeType?d.parentNode:d,f=d),b=X(f).find("[style*='"+j+"']"),/text-decoration-line/i.test(X(d).attr("style"))?b.push(d):0,g=b.length,i=0;i<g;i++)c=b[i].style,c.textDecoration=c.textDecorationLine,c.cssText.replace(j,h)}var e,f,g,h,i,j,k,l,m=b.selectionManager;if(!Y.ie&&(b.isEmpty()&&b.focus(),A(a)))return!0;if(e=w(a,c),e.isAllEmptyLines)return!0;if(f=e.cursor,g=e.cells,k=e.isSelected,g&&g.length){for(f=m.getCursorPosition(),j=g.length,i=0;i<j;i++)h=g[i],W.reRangeByCell(h),z(a,c);f=f?{node:b.contentUtils.getLeafNode(e.range.startContainer,!0),line:f.line,offset:0}:null}else z(a,c);return!Y.ie&&/underline|strikethrough/i.test(a)&&d(g),o(k,a)&&(l=r(a)),e.pEmptyLines&&Y.ie&&11===parseInt(Y.version,10)&&X(e.pEmptyLines).empty(),f?(m.setCursorPosition(f),b.zwsUtils.taggingZeroWidthSpace(e.zwsNode),b.selectionChange.contentChanged()):l&&m.setRange(l.startContainer,l.startOffset,l.endContainer,l.endOffset),e.isSelectAllAtChrome&&setTimeout(function(){W&&m&&m.selectAll()},200),b.selectionChange.refreshLastRange(),!0}function C(){var a=c.DEFAULT_FONT_FAMILY_JS,d=X(b.getBody()).css("fontFamily").split(",");return d.length>0&&(a=X.trim(d[0])),a=W.removeQuotation(a)}function D(){var a,c,d,e=b.configs.font_formats,f=[],g={};if(!e||0===(d=e.length))return _;for(c=0;c<d;c++)a=W.removeQuotation(e[c]),g[a]||(g[a]=!0,f.push(a));return f}function E(){var a=b.configs.font_size_style_values;return a=a||["10pt","12pt","14pt","16pt","20pt"],a=X.isArray(a)?a:X.trim(a).split(/(?:,|\s){1,}/)}function F(){var a=X(b.getBody()).css("fontSize");return a=W.parseFontSize(a)}function G(){var a,c,d,e=[],f=b.configs.line_heights;for(f&&X.isArray(f)||(f=["1","1.2","1.5","1.8","2","3","4","5"]),a=0,c=f.length;a<c;a++)d=f[a],d=parseFloat(d),e.push(d+"");return e}function H(){var a,c;X.map(ba,function(d,e){"fontcolor"===e?W.setWidgetColor(e,null,"000000"):"fontbgcolor"===e?W.setWidgetColor(e,null,"FFFFFF"):"fontfamily"===e?(c=h(S),a=b.getToolButton(e),a&&a.index(c)):"fontsize"===e?(c=R.indexOf(Q),a=b.getToolButton(e),a&&a.index(c)):"paragraphformat"===e?(a=b.getToolButton(e),a&&a.index(0)):"link"!==e&&W.pressWidget(e,!1)})}function I(a){var b=a.keyCode,c=a.metaKey||a.shiftKey;return c&&13===b}function J(a){a.classList.remove("cui-temp-style-node"),0===a.classList.length&&a.removeAttribute("class")}function K(a,d,e){var f,g,h;d=d||b.selectionManager.getRange(),a||(h=d.commonAncestorContainer,a=h.nodeType===c.NodeTypes.TEXT_NODE||c.LineBlockElements[h.nodeName]&&h.nodeName===c.NodeNames.BODY?b.selectionManager.getClosest(h,".cui-temp-style-node"):h.querySelector(".cui-temp-style-node")),a&&(ha?a.textContent.length>=2&&J(a):J(a),b.zwsUtils.startWithZeroWidthSpaceChar(a.textContent)&&!ha&&e!==X.ui.keyCode.COMPOSING&&(f=b.selectionManager.getCursorPosition(),g=f.offset,b.contentUtils.getLeafNode(a).textContent=b.zwsUtils.removeZeroWidthSpaceChar(a.textContent),f.offset=g?g-1:0,b.selectionManager.setCursorPosition(f)))}function L(a){var d,f,g,h,i,j=a.keyCode,k=Y.ie?"Del"===a.originalEvent.key?"Delete":a.originalEvent.key:a.originalEvent.code,l=b.zwsUtils.removeZWSTextNode,m=b.selectionManager;if(h=m.getRange(),Y.ie){if(g=m.getClosest(h.commonAncestorContainer,c.LineElementsStr),ga&&!b.pluginUtils.isCharKeyCode(j)&&(ga=!1,X(g).find("br[cui-ebr]").remove()),j!==Z.ENTER||I(a)){if(j===Z.BACKSPACE&&b.browser.version<11&&(d=h.startContainer,h.collapsed&&!h.startOffset&&!h.endOffset&&"LI"===d.nodeName&&""===h.toString())){for(;1===d.nodeType&&1===d.childNodes.length&&1===d.firstChild.nodeType;)d=d.firstChild;h.setStart(d,0),h.setEnd(d,0),m.setSingleRange(h),b.selectionChange.contentChanged()}}else d=m.getRange().startContainer,"P"===d.nodeName&&(f=t(d,"BR"),f&&l(f.previousSibling));j!==Z.BACKSPACE&&j!==Z.DELETE||(d=h.startContainer,1===d.nodeType&&0!==h.startOffset?l(d.childNodes[h.startOffset-1]):3===d.nodeType&&1===d.textContent.length&&l(d))}else j!==Z.BACKSPACE&&j!==Z.DELETE||(g=W.getEmptyLineWithCursor(),g&&"LI"!==g.nodeName&&!V&&e(g,j));i=b.getBody().querySelector(".cui-temp-style-node"),i?"Backspace"===k||"Delete"===k?(h=m.getRange(),h.collapsed&&i.parentNode&&b.zwsUtils.isZeroWidthSpaceChar(i.parentNode.innerText)&&h.startContainer.parentElement.replaceChild(b.getDoc().createElement(ca.BR),h.startContainer)):K(i,h,j):(h=m.getRange(),h.collapsed&&h.startContainer.nodeName===ca.P&&0===h.startOffset&&0===b.getBody().textContent.length&&m.setSingleRange(h))}function M(a){function d(){var a,d,e,f;if(d=A===Z.BACKSPACE?"firstChild":"lastChild",p=E.getRange(),a=p.startContainer,3===a.nodeType||c.LineBlockElements[a.nodeName])if(p.collapsed){if(A===Z.BACKSPACE&&0===p.startOffset||A===Z.DELETE&&p.startOffset===a.length){if(3===a.nodeType)for(;a.parentNode&&a===a.parentNode[d]&&(a=a.parentNode,!c.LineBlockElements[a.nodeName]););a=A===Z.BACKSPACE?a.previousSibling:a,a&&a.childNodes.length>0&&c.LineBlockElements[a.nodeName]&&(c.StyleElements[a.lastChild.nodeName]||"A"===a.lastChild.nodeName)&&(a.appendChild(F.createZeroWidthSpaceNode()),A===Z.DELETE&&(p.setStartAfter(a.lastChild),p.setEndAfter(a.lastChild),E.setSingleRange(p)))}}else for(;a.parentNode;){if(c.LineBlockElements[a.parentNode.nodeName]){(c.StyleElements[a.nodeName]||"A"===a.nodeName)&&(e=b.getDoc().createRange(),e.setStart(a.parentNode,0),e.setEnd(p.startContainer,p.startOffset),f=e.extractContents(),f.appendChild(F.createZeroWidthSpaceNode()),e.insertNode(f));break}a=a.parentNode}}function f(c){var d,e,f=c.previousSibling,g=c.nextSibling;A===Z.BACKSPACE&&f&&b.contentUtils.isFormattedEmptyLine(f)?(a.preventDefault(),X("br",f).length>0?(d=X("br",f)[0].parentNode,b.selectionManager.setRange(d,0,d,0)):(d=b.contentUtils.getLeafNode(f,!1),3===d.nodeType&&(e=d.textContent.length,b.selectionManager.setRange(d,e,d,e))),X(c).remove()):A===Z.DELETE&&g&&b.contentUtils.isFormattedEmptyLine(g)&&(a.preventDefault(),X(g).remove())}function g(a,d){var e,f,g,h=!1,i=b.selectionManager.getAncestors(a);for(e=0,f=i.length;e<f&&(g=i[e],g!==d);e++)g.nodeName===ca.SPAN&&0===g.attributes.length||c.StyleElements[g.nodeName]&&(h=!0);return h}var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=a.keyCode,B=Y.ie?"Del"===a.originalEvent.key?"Delete":a.originalEvent.key:a.originalEvent.code,C="",D=!1,E=b.selectionManager,F=b.zwsUtils;if(b.browser.ie&&b.browser.version>10&&!a.ctrlKey&&(A>47&&A<58||32===A||13===A||A>64&&A<91||A>95&&A<112||A>185&&A<193||A>218&&A<223||229===A)&&(p=E.getRange(),p.collapsed&&(h=E.getClosest(p.commonAncestorContainer,c.LineElementsStr),n=X(h).text(),(0===n.length||1===n.length&&/\u200B/.test(n))&&1===X(h).find("br[cui-ebr]").length&&(ga=!0))),x=b.getBody().querySelector(".cui-temp-style-node"),x&&1===x.innerText.length&&b.zwsUtils.isZeroWidthSpaceChar(x.innerText)&&("Backspace"===B||"Delete"===B)&&(y=X(x).closest(ea)[0],X(x).remove(),y.innerText.length>0&&(p=E.getRange(),p.setStart(b.contentUtils.getLeafNode(p.startContainer,!0),0),p.setEnd(b.contentUtils.getLeafNode(p.startContainer,!0),0))),("Backspace"===B||"Delete"===B)&&(p=E.getRange(),t=E.getCursorPosition(),u=t.lineElement,v=b.contentUtils.getLeafNode(u,!0),u&&(C=u.nodeName===ca.LI&&u.firstChild.nodeType===c.NodeTypes.TEXT_NODE?u.firstChild.innerText:u.innerText),p.collapsed?"Backspace"===B&&1===t.col?D=!0:"Delete"===B&&(0===t.col&&C.length>0&&"\n"!==C?0===X(u).find(".cui-temp-style-node").length&&b.zwsUtils.isZeroWidthSpaceChar(u.firstChild.innerText)||(D=!0):1===t.col&&b.zwsUtils.startWithZeroWidthSpaceChar(C)&&(D=!0)):(v===p.startContainer||p.startContainer===p.commonAncestorContainer&&0===p.startOffset&&v===b.contentUtils.getLeafNode(p.startContainer,!0))&&0===t.col&&(D=!0),g(v,u)||(D=!1),D)){if($[p.startContainer.parentNode.nodeName])z=b.getDoc().createElement(ca.SPAN),z.appendChild(b.getDoc().createElement(ca.BR));else for(u=v;!$[u.nodeName]&&u.nodeName!==ca.BODY;)u.nodeType===c.NodeTypes.TEXT_NODE||u.nodeName===c.NodeNames.IMG?w=b.getDoc().createElement(ca.BR):(w=u.cloneNode(),w.innerText=""),z&&w.appendChild(z),z=w,u=u.parentNode;if(z)return X(z).find(ca.BR).replaceWith(F.createZeroWidthSpaceNode()),z.classList.add("cui-temp-style-node"),u.insertBefore(z,u.firstChild),b.selectionManager.setRange(z.nextSibling,0,p.endContainer,p.endOffset),!0}if(A===Z.BACKSPACE||A===Z.DELETE){if(h=W.getEmptyLineWithCursor(),s=h?h.nextSibling:null,Y.ie){if(A===Z.DELETE&&h&&"<br>"===h.innerHTML&&s){for(a.preventDefault(),h.childNodes.length>0&&h.removeChild(h.firstChild);s.childNodes.length>0;)h.appendChild(s.firstChild);return i=E.getLeafNode(h,!0),E.setRange(i,0,i,0),X(s).remove(),V=!0,!0}d()}if(e(h,A))return H(),a.preventDefault(),!0;if(Y.webkit&&b.contentUtils.isFormattedEmptyLine(h))return f(h),!0;if(!h||"LI"===h.nodeName||A===Z.DELETE&&s)return V=E.getRange().collapsed,!0}else Y.ie&&A===Z.ENTER&&!I(a)&&(j=E.getRange().startContainer,j&&3===j.nodeType&&(j=j.parentNode),j&&!b.contentUtils.isEmptyLine(j)&&(l=j.firstChild,m=j.lastChild,m&&"BR"===m.nodeName?j.removeChild(m):l&&"BR"===l.nodeName&&(k=F.createZeroWidthSpaceNode(),j.insertBefore(k,l))));if(A===Z.ENTER&&(p=E.getRange(),j=p.endContainer,p.collapsed&&3===j.nodeType)){for(h=j,r=h.nodeName,q=!0;!$[r]&&"BODY"!==r;){if(h.nextSibling){q=!1;break}h=h.parentNode,r=h.nodeName}if(3===h.nodeType&&$[h.parentNode.nodeName]&&(!h.nextSibling||"BR"===h.nextSibling.nodeName))return;q||j.length!==p.endOffset||"BODY"===r||(o=F.createZeroWidthSpaceNode(),p.insertNode(o),p.setStartBefore(o),p.setEndBefore(o),E.setSingleRange(p))}}function N(){Q=F(),R=E(),S=C(),T=D(),U=G()}function O(c,e,f){var g,h,i,j,k,l,m,n,o=b.selectionManager.getRange(),p=b.selectionChange,q=d(c);if(q&&(m=q.option("pressed")),!o.collapsed){if(m)return void W.toggleWidgetState(c);for(l=o.startContainer,h=o.commonAncestorContainer,i=o.endContainer,j=o.startOffset,k=o.endOffset,3!==i.nodeType&&(l===i&&"BODY"===l.nodeName&&(i=b.contentUtils.getLeafNode(l.lastChild,!1),l=l.firstChild),i===h&&(i=p.findLeafNode(i,k),k=0),l===h&&(l=p.findLeafNode(l,j))),3!==l.nodeType&&(l=p.findLeafNode(l,j)),g=new a(l,h),3===l.nodeType&&l.length===j&&(l=g.next());l;){if(3===l.nodeType){if(l===i&&0===k)break;break}if(b.contentUtils.isEmptyLine(l.parentNode,!0)){l=p.getTempTextNode(l);break}if(l===i)break;l=g.next()}for(l&&3===l.nodeType&&(l=l.parentNode);l&&!b.contentUtils.isLineNode(l);){if(l.nodeName===e){W.toggleWidgetState(c);break}if(n=l.getAttribute("style"),f&&n&&n.indexOf(f)>=0)return void W.toggleWidgetState(c);l=l.parentNode}}}function P(a){"compositionstart"===a.type?ha=!0:"compositionend"===a.type&&(ha=!1,K())}var Q,R,S,T,U,V,W=this,X=b.$,Y=b.browser,Z=X.ui.keyCode,$={P:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,LI:!0},_=c.DefaultFontFormats,aa=b.configs.font_size_unit||"pt",ba=c.NodeStyles,ca=c.NodeNames,da=c.ComputedStyles,ea=c.LineElementsStr,fa={fontfamily:{label:b.getText("fontfamily.toolbar.title")},fontsize:{label:b.getText("fontsize.toolbar.title")},lineheight:{label:b.getText("lineheight.toolbar.title")}},ga=!1,ha=!1;W.pressWidget=function(a,c){var e;e=d(a),e&&e.option("pressed",c),b.toggleMenuItem(a,c)},W.setWidgetState=function(a,c){var d,e=a.parents,g=a.textNodes;if(!b.pluginUtils.isCharKeyCode(a.keyCode)){if(g.length)d=b.styleUtils.isStyledNodeWithParents(g,c);else{if(f(a))return;d=b.styleUtils.hasStyle(e,c)}W.pressWidget(c,d)}},W.toggleWidgetState=function(a){var c,e,f=d(a),g=f?!f.option("pressed"):!b.toggleMenuItem(a);n(a)&&(c="subscript"===a?"superscript":"subscript",e=d(c)),f&&f.option("pressed",g),b.toggleMenuItem(a,g),c&&e&&e.option("pressed")&&(e.option("pressed",!1),b.toggleMenuItem(c,!1))},W.getCursor=function(a,c){var d;return a.collapsed&&(d=c&&c.cursor?c.cursor:b.selectionManager.getCursorPosition(),d={line:d.line,col:d.col}),d},W.getEmptyLineWithCursor=function(a){var c,d,e;return a=a||b.selectionManager.getCursorPosition(),a&&a.collapsed&&(c=a.lineElement,c&&(s(a)||b.zwsUtils.isOnlyZeroWidthSpaceLine(a))&&(d=t(c,"IMG"),e=c.childNodes,0===e.length||1===e.length&&0===c.textContent.length&&("LI"!==c.nodeName||!d)))?c:null},W.reRangeByCell=function(a){var c,d,e,f,g=b.selectionManager;for(e=a.childNodes.length,d=0;d<e;d++)f=a.childNodes[d],b.contentUtils.isEmptyLine(f)&&(c=g.setRange(f,0,f,0),b.zwsUtils.getZeroWidthSpace(c));return g.setRange(a,0,a,a.childNodes.length)},W.commandFormatStyle=function(a,b){var c=B(a,b);return b&&O(a,b.tag,b.style),c},W.setWidgetColor=function(a,b,c){var e;c&&(e=d(a),e&&e.setColor(b,c))},W.getBackupCursor=function(){var a,c,d=b.selectionManager;return a=d.getRange(),c={range:a},a.collapsed&&(c.cursor=d.getCursorPosition()),c},W.removeQuotation=function(a){return a&&(a=a.replace(/[\"\']/g,"")),a},W.getDefaultFontFamily=function(){return S},W.parseFontSize=function(a){return"pt"===aa&&/px/.test(a)&&(a=Math.round(72*parseFloat(a)/96)+"pt"),a},W.getDefaultFontSize=function(){return Q},W.getFormatWidgetInfos=function(){var a,b,e,f={},g=c.ButtonTypes,h=g.TYPE_TOGGLE,i=g.TYPE_COLOR,j=g.TYPE_MENU;return X.map(ba,function(c,g){if(c.format&&(a=d(g)))switch(b=c.buttonType){case h:f[g]={buttonType:b,value:a.option("pressed")};break;case i:e=a.color,f[g]={buttonType:b,value:"transparent"!==e?"#"+e:e};break;case j:f[g]={buttonType:b,value:a.options.label}}}),f},b.one("editorcreate",function(){X(b.getBody()).on("compositionstart compositionend",P).on("keydown.cafe",M).on("keyup.cafe",L).on("mousedown mouseup",function(a){var c;"mousedown"!==a.type&&"mouseup"!==a.type||(c=b.getBody().querySelector(".cui-temp-style-node"),c&&(c.nextSibling?K():0===c.textContent.length&&0===c.children.length&&X(c).replaceWith(b.getDoc().createElement("BR"))))}),N(),b.on("selectionchange",b.zwsUtils.removeZWS),b.on("selectionchange",j)}),b.addFinalTask(function(){W=null,X=null,Y=null,Z=null,Q=null,R=null,$=null,S=null,T=null,U=null,_=null,aa=null,V=null,ba=null,da=null,fa=null})})}),cafe.pluginManager.add("blockformat",[],function(a){function b(a,b){return a&&1===a.nodeType&&a.nodeName===b.toUpperCase()}function c(a){return a.previousSibling&&"TABLE"===a.previousSibling.nodeName}function d(d){var h,i,m,n,o,p,q,r,s,t=g.getRange(),u=d.keyCode;h=g.getClosest(t.startContainer,"blockquote"),i=g.getClosest(t.endContainer,"blockquote"),(h||i)&&(u===l.ENTER?t.collapsed&&(m=g.getClosest(t.startContainer,j),b(m,"P")&&!m.nextSibling&&(e.isEmptyLine(m)?(n=a.createEmptyLine(),o=h.parentNode,h.nextSibling?o.insertBefore(n,h.nextSibling):o.appendChild(n),g.setRange(n,0,n,0),k(m).remove(),d.preventDefault()):e.isFormattedEmptyLine(m)&&(n=a.createEmptyLine(),o=h.parentNode,h.nextSibling?o.insertBefore(n,h.nextSibling):o.appendChild(n),n.innerHTML=m.innerHTML,p=e.getLeafNode(n),3===p.nodeType?q=p.textContent.length:1===p.nodeType&&(q=0,"BR"===p.nodeName&&(p=p.parentNode)),g.setRange(p,q,p,q),k(m).remove(),d.preventDefault()))):u===l.BACKSPACE&&t.collapsed&&(m=g.getClosest(t.startContainer,j),b(m,"P")&&!m.previousSibling&&(r=t.startContainer,s=t.startOffset,!(f.isEndOfLine(r,s,m,!0)||r.isSameNode(m)&&0===s)||h.previousSibling&&!c(h)||(n=a.createEmptyLine(),o=h.parentNode,o.insertBefore(n,h),n.innerHTML=m.innerHTML,p=e.getLeafNode(n,!0),b(p,"BR")&&(p=p.parentNode),g.setRange(p,0,p,0),k(m).remove(),h.children.length||k(h).remove(),d.preventDefault()))))}var e,f,g,h,i,j,k=a.$,l=k.ui.keyCode;a.one("editorcreate",function(){e=a.contentUtils,f=a.pluginUtils,g=a.selectionManager,h=a.editorManager.editorConstants,i=h.LineBlockElements,j=h.keys(i).join(", "),k(a.getBody()).on("keydown",d)}),a.addFinalTask(function(){})}),a.Cafe&&!a.Cafe.getModules&&(a.Cafe.getModules=function(){return e})}(this);