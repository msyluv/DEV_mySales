/*! cafe note v2.3.28.2 | Copyright 2014, S-Core, Inc. All Right Reserved. */
cafe.pluginManager.add("lists",[],function(a){function b(a){var b,c,d,e,f,g=a.length,h=[];for(b=0;b<g;b++)if(f=a[b],f.tagName===ba)if(e=h.length,0===e)h.push(f.parentNode);else{for(d=!1,c=0;c<e;c++)h[c]===f.parentNode&&(d=!0);d||h.push(f.parentNode)}else f.tagName!==_&&f.tagName!==aa||h.push(f);return h}function c(a){return a.tagName===ba}function d(b,c,d){var e,f,g,h=a.getDoc().createElement(c);if(o(b,h),d)for(g=d.length,f=0;f<g;f++)e=d[f],h.appendChild(e);else for(;e=b.firstChild;)h.appendChild(e);return h}function e(a){return!(!a||a.childNodes.length||/<p[^>]*><br><\/p>/gi.test(a.outerHTML)||R.ie&&11!==parseInt(R.version,10))&&(Q(a).remove(),!0)}function f(b,c,d){return!(!Y&&!(Y=a.getToolButton("numberedlist")))&&(!(!X&&!(X=a.getToolButton("bulletedlist")))&&(c===d&&(b&&Y.option("pressed")||!b&&X.option("pressed"))))}function g(c,g,h){var i,j,k,l,m,n,o,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=a.getDoc(),H=g?aa:_,I=function(){0!==i||parseInt(F.css(ca),10)||F.css(ca,E.css(ca)),Q(t).css(ca,""),t.style.length||t.removeAttribute("style")};if(!c||0===c.length)return!1;if(h||(h=g?"decimal":"disc"),m=P.getRange(),n=m.startContainer,r=m.startOffset,1===n.nodeType&&r>=0&&r<n.childNodes.length&&(n=p(n.childNodes[r]),r=-1),o=m.endContainer,s=m.endOffset,1===o.nodeType&&s>0&&s<=o.childNodes.length&&(o=q(o.childNodes[s-1]),s=-1),c=K(c,m),w=b(c),u=c.filter(function(a){return a.nodeName===ba}).length,w.length>0&&c.length===u)if(f(g,Q(c[0]).css("list-style-type"),h))a.execCommand("releaselist");else for(j=w.length,i=0;i<j;i++)if(x=w[i],z=Q(x),x.tagName!==H){for(x===n?n=y:x===o&&(o=y),y=G.createElement(H),Q(y).css(ca,Q(x).css(ca));x.firstChild;)y.appendChild(x.firstChild);x.parentNode.insertBefore(y,x),z.remove(),Q(y).css("list-style-type",h)}else z.css("list-style-type",h);else{if(v=c[0],y=G.createElement(H),F=Q(y),A=c[0].previousSibling,l=c[0].parentNode,A&&A.tagName===H&&Q(A).css("list-style-type")===h)for(F.css(ca,Q(A).css(ca));A.firstChild;)y.appendChild(A.firstChild);else l&&(l.previousSibling||"TD"===l.nodeName||"TH"===l.nodeName?(A=l.previousSibling,A&&A.tagName!==H&&(A=void 0)):"OL"!==l.nodeName&&"UL"!==l.nodeName||(A=l,v=l));for(k=A?A.parentNode:l,k.insertBefore(y,v),A&&A.tagName===H&&Q(A).css("list-style-type")===h&&Q(A).remove(),F.css("list-style-type",h),i=0;i<c.length;i++)C=c[i],E=Q(C),e(C)||(t=d(C,"li"),I(),D=C.previousSibling,D&&"TABLE"===D.nodeName&&(y=G.createElement(H),Q(y).css("list-style-type",h),Q(D).after(y)),n===C&&(n=t),o===C&&(o=t),Q(C).remove(),y.appendChild(t));if(B=y.nextSibling,B&&B.tagName===H){for(;B.firstChild;)y.appendChild(B.firstChild);Q(B).remove()}Q(y).css("list-style-type",h)}return P.setRange(n,r,o,s),!0}function h(a){var b,c,d,e,f=[],g=[];for(c=a.length,b=0;b<c;b++)d=a[b],e=Q(d).closest("td, th")[0],e?g.push(d):f.push(d);return{newBlockElements:f,tdChildElements:g}}function i(b,c,d){var e,f,g,i,j,k,m,n,o,p,q,r,s;if(i=a.pluginUtils.getSelectedCells(),i&&i.length){for(k=P.getCursorPosition(),f=i.length,e=0;e<f;e++)g=i[e],j=Q.makeArray(g.childNodes),l(j,c,d,!0);k=k?{node:a.contentUtils.getLeafNode(i[0],!0),line:k.line,offset:0}:null,k&&P.setCursorPosition(k)}else{if(p=P.getRange().collapsed,q=h(b),m=b[0],Q(m).closest("td, th")[0]&&(n=!0),m=b[b.length-1],Q(m).closest("td, th")[0]&&(o=!0),r=q.newBlockElements,s=q.tdChildElements)for(f=s.length,e=0;e<f;e++)l([s[e]],c,d,p);l(r,c,d,p)}return a.selectionChange.contentChanged(),!0}function j(a){var b,c,d,e,f,g,h,i=[],j=[];for(c=a.length,b=0;b<c;b++)d=a[b],e=Q(d),f=e.closest("ul, ol")[0],f&&(h=i.indexOf(f),h===-1?(i.push(f),g=[d],j.push(g)):(g=j[h],g?g.push(d):(g=[d],j.push(g))));return j}function k(a,b){var c,d,e;for(e=j(a),d=e.length,c=0;c<d;c++)a=e[c],b&&1===a.length&&/UL|OL/i.test(a[0].nodeName)&&(a=Q.makeArray(a[0].childNodes)),r(a)}function l(a,b,c,d){return!!b&&void("bulletedlist"===b.command?m(a,c):"numberedlist"===b.command?n(a,c):"releaselist"===b.command&&k(a,d))}function m(a,b){return g(a,!1,b)}function n(a,b){return g(a,!0,b)}function o(a,b){var c=Q(a).prop("attributes");Q.each(c,function(){Q(b).attr(this.name,this.value)})}function p(a){var b=a;return 1===a.nodeType&&a.childNodes&&a.childNodes.length>0&&(b=p(a.childNodes[0])),b}function q(a){var b=a;return 1===a.nodeType&&a.childNodes&&a.childNodes.length>0&&(b=q(a.childNodes[a.childNodes.length-1])),b}function r(b){var e,f,g,h,i,j,k,l,m,n,r,s,t,u,v,w,x,y,z=[],A=[];if(b&&0!==b.length){for(i=P.getRange(),j=i.startContainer,k=i.startOffset,1===j.nodeType&&k>=0&&k<j.childNodes.length&&(j=p(j.childNodes[k]),k=-1),l=i.endContainer,m=i.endOffset,1===l.nodeType&&m>0&&m<=l.childNodes.length&&(l=q(l.childNodes[m-1]),m=-1),b=K(b,i),n=b[0].parentNode,g=n.parentNode,r=n.childNodes,x=0,e=0;e<r.length;e++)0!==x&&z.push(r[e]),r[e]===b[0]&&(x=e+b.length,e=x-1);for(z.length>0&&(y=d(n,n.tagName,z)),e=b.length-1;e>=0;e--)if(s=b[e],c(s)&&s.parentNode.tagName===n.tagName){for(t=s.childNodes,u=t.length,w=0===u?a.createEmptyLine():a.getDoc().createElement("p"),o(s,w),A.push(w),f=0;f<u;f++)v=t[0],w.appendChild(v);j===s&&(j=w),l===s&&(l=w),Q(s).remove()}if(h=n.nextSibling,y&&(g.insertBefore(y,h),h=y),g&&g.parentNode)for(e=A.length;e>0;e--)g.insertBefore(A.pop(),h);return 0===n.childNodes.length&&Q(n).remove(),P.setRange(j,k,l,m),!0}}function s(){X=a.getToolButton("bulletedlist"),X&&(a.pluginUtils.deselectItem(),a.execCommand("bulletedlist"))}function t(){Y=a.getToolButton("numberedlist"),Y&&(a.pluginUtils.deselectItem(),a.execCommand("numberedlist"))}function u(b){var c=a.getToolButton("bulletedlist");c&&c.option("pressed",b)}function v(b){var c=a.getToolButton("numberedlist");c&&c.option("pressed",b)}function w(){var a,c,d,e,f,g,h;if(g=P.getSelectedBlocks(),g=K(g),u(!1),v(!1),0!==g.length){for(c=g.length,a=0;a<c;a++)f=g[a],f.nodeName!==ba||(h=!0);if(h&&(d=b(g),0!==d.length))for(c=d.length,a=0;a<c;a++)e=d[a],e&&(e.tagName===_&&u(!0),e.tagName===aa&&v(!0))}}function x(a){var b,d,e,f;if(!a||!a.length)return!1;for(d=a.length,e=a[0].parentNode,b=0;b<d;b++){if(f=a[b],!c(f))return!1;if(f.parentNode!==e)return!1}return!0}function y(a){var b=Q(a).prev();return b.length>0?b.get(0):null}function z(a){var b,c=Q(a).find("ol, ul");return c.length>0?b=c.first():(b=Q("<"+a.parentNode.tagName+">"),Q(a).append(b)),b}function A(a,b){var c,d,e,f,g,h,i,j,k=z(a),l=a.parentNode;for(l.nodeName===_&&(i=l.style.listStyleType,j=Z.indexOf(i)+1,j=j>=3?0:j,k[0].style.listStyleType=Z[j]),h=b.length,g=0;g<h;g++){for(f=b[g],d=[],e=[],f.style.marginLeft="",c=f.firstChild;c;)c.nodeName!==aa&&c.nodeName!==_||(d.push(c.childNodes),e.push(c)),c=c.nextSibling;Q(e).remove(),k.append(f),k.append(d)}}function B(a,b){var c,d=b[b.length-1],e=Q(d).parent(),f=Q(b).last().nextAll();Q(b).insertAfter(a),f.length>0&&(c=Q("<"+d.parentNode.tagName+">"),c.css("list-style-type",e.css("list-style-type")),Q(d).append(c),c.append(f)),0===e.children().length&&e.remove()}function C(b,c){var d,e,f,g,h,i,j,k,l,m,n=b.keyCode;if(("keydown"!==b.type||n===Q.ui.keyCode.TAB)&&(!a.isSpellcheckMode||!a.isSpellcheckMode())&&(d=P.getSelectedBlocks(),h=P.getRange(),i=h.startContainer,j=h.startOffset,1===i.nodeType&&j>=0&&j<i.childNodes.length&&(i=p(i.childNodes[j]),j=-1),k=h.endContainer,l=h.endOffset,1===k.nodeType&&l>0&&l<=k.childNodes.length&&(k=q(k.childNodes[l-1]),l=-1),d=K(d,h),d.length&&x(d))){if(n&&(b.preventDefault(),b.stopPropagation()),c&&c.isShift||b.shiftKey)if(f=Q(d[0]).parent(),g=f.parent().get(0).tagName,"BODY"===g)r(d),m=!0;else{if(e=g!==ba?f.prev():f.parent(),0===e.length)return;B(e.get(0),d)}else{if(e=y(d[0]),!e)return;A(e,d)}m?w():P.setRange(i,j,k,l),n&&a.trigger("documentchanged")}}function D(b){var c,d,e,f=b.childNodes.length;for(c=0;c<f;c++)if(d=b.childNodes[c],d&&!/UL|OL/i.test(d.nodeName)&&(e=d.textContent.trim(),""!==e&&!a.zwsUtils.isZeroWidthSpaceChar(e)))return!1;return!0}function E(b){var c;return!!a.contentUtils.isEmptyLine(b)||!(!D(b)||(c=Q(b).find("img, table")[0]))}function F(){var a=P.getCursorPosition();return 0===a.offset&&0===a.col}function G(){return P.getClosest(P.getRange().startContainer,ba)}function H(b){return!(a.browser.ie||!F()||b!==b.BACKSPACE)}function I(){var b=G();return b&&!P.getRange().collapsed&&(a.getDoc().execCommand("Delete",!0,null),b=G()),b}function J(a){return 1===Q(a).parents("ul, ol").length}function K(a,b){var c,d,e,f,g,h,i=[];for(b=b||P.getRange(),e=b.endContainer,f=b.endOffset,e&&1===e.nodeType&&f<e.childNodes.length&&(d=e.childNodes[f],c=a[a.length-1],c===d&&a.pop()),h=a.length,g=0;g<h;g++)S.indexOf(a[g].nodeName)>=0&&a[g].parentNode&&a[g].parentNode.nodeName===ba?i.push(a[g].parentNode):i.push(a[g]);return i}function L(b){var c,d,e,f,g=Q.ui.keyCode,h=!0;return g.ENTER===b.keyCode?(c=I(),c&&(E(c)&&J(c)?(a.execCommand("releaselist"),h=!1):(d=c.firstChild,d&&"SPAN"===d.nodeName&&a.zwsUtils.removeTaggingZeroWidthSpace(d)))):g.BACKSPACE!==b.keyCode&&g.DELETE!==b.keyCode||(c=G(),c&&(f=E(c),f&&(e=c.childNodes.length,e&&(1!==e||3!==c.firstChild.nodeType&&"BR"!==c.firstChild.nodeName?(Q(c).empty(),R.ie&&(c.appendChild(M()),a.selectionManager.setRange(c.firstChild,1,c.firstChild,1)),a.selectionChange.contentChanged()):a.execCommand("releaselist"),h=!1)),h&&(f&&1===c.parentNode.childNodes.length||H(b.keyCode))&&(a.execCommand("releaselist"),h=!1))),h}function M(){var b=a.getDoc().createTextNode("");return b.nodeValue="â€‹",b}function N(a){var b,c,d,e;if(a&&E(a))for(b=a.childNodes,d=b.length,e=0;e<d;e++)c=b[e],c&&"SPAN"===c.nodeName&&(Q(c).empty(),c.appendChild(M()))}function O(b){var c,d=Q.ui.keyCode;d.ENTER===b.keyCode&&(c=G(),c&&(N(c),N(c.previousSibling),a.trigger("documentchanged")))}var P,Q=a.$,R=a.browser,S=["H1","H2","H3","H4","H5","H6"],T=a.getText("lists.label.bulletedlist"),U=a.getText("lists.label.numberedlist"),V="bullet-list",W="numbered-list",X=null,Y=null,Z=["disc","circle","square"],$=cafe.editorConstants,_=$.NodeNames.UL,aa=$.NodeNames.OL,ba=$.NodeNames.LI,ca=$.INDENT_STYLE;return a.one("editorinitialized",function(){P=a.selectionManager}),a.one("editorcreate",function(){Q(a.getDoc()).on("keydown",C),Q(a.getBody()).on("keydown.cafe",L).on("keyup.cafe",O),a.on("selectionchange",w),a.on("changeListByIndent",C)}),a.addCommand({command:"releaselist",type:cafe.editorConstants.CommandTypes.CUSTOM_COMMAND_BLOCK,validTags:["li"],action:i}),a.addCommand({command:"bulletedlist",type:cafe.editorConstants.CommandTypes.CUSTOM_COMMAND_BLOCK,action:i}),a.addCommand({command:"numberedlist",type:cafe.editorConstants.CommandTypes.CUSTOM_COMMAND_BLOCK,action:i}),a.addButton("bulletedlist",{label:T,icons:{primary:V},iconOnly:!0,click:s}),a.addButton("numberedlist",{label:U,icons:{primary:W},iconOnly:!0,click:t}),a.addMenuItem("bulletedlist",{icon:V,text:T,click:s}),a.addMenuItem("numberedlist",{icon:W,text:U,click:t}),a.addFinalTask(function(){Q=null,R=null,P=null,S=null,T=null,U=null,V=null,W=null,ca=null,Z=null,$=null,_=null,aa=null,ba=null}),{getSelectedLists:b,makeList:g,executeBulleted:s,executeNumbered:t,commandFormatStyle:i}});